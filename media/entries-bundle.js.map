{
  "version": 3,
  "sources": ["../src/webviews/services/App.ts", "../src/webviews/ConsoleManager.ts", "../src/bothside/StringUtils.ts", "../src/webviews/services/SelectionManager.ts", "../src/webviews/ClientItem.ts", "../src/bothside/RpcChannel.ts", "../src/webviews/RpcClient.ts", "../src/webviews/services/HelpManager.ts", "../src/webviews/services/DomUtils.ts", "../src/webviews/services/VimLikeManager.ts", "../src/bothside/class_extensions.ts", "../src/webviews/PanelClient.ts", "../src/webviews/services/AccessTable.ts", "../src/bothside/UConstants.ts", "../src/webviews/services/ComplexRpc.ts", "../src/webviews/services/FormManager.ts", "../src/webviews/models/EntryForm.ts", "../src/webviews/services/TextFormater.ts", "../src/webviews/services/AutoCompletion.ts", "../src/webviews/models/Entry.ts"],
  "sourcesContent": ["import { RpcChannel } from \"../../bothside/RpcChannel\";\n\nexport class App {\n  /**\n   * Les m\u00E9thodes suivantes peuvent s'appeler en tapant simplement leur\n   * nom en console (bas des panneaux \u2014 'c' pour rejoindre la console)\n   */\n\n  private static async openSupport() {\n    console.log(\"-> openSupport\");\n    App.rpc.notify('open-support-folder');\n    return \"Ouverture du dossier Support\";\n  }\n\n  private static async exportAllData(){\n    console.log(\"-> exportAllData\");\n    App.rpc.notify('export-all-data');\n    return \"Exportation des donn\u00E9es demand\u00E9e.\";\n  }\n\n  private static get rpc(): RpcChannel {return (window as any).RpcEntry; }\n\n  /**\n   * \n   * M\u00E9thode fonctionnelles\n   * \n   * @param code Code \u00E0 \u00E9valuer\n   * @returns True si tout s'est bien pass\u00E9 (le code \u00E0 pu \u00EAtre \u00E9valu\u00E9), False sinon\n   * \n   */\n  static eval(code: string){\n    const ok = this.tryEval(code) || this.tryEval('this.' + code) || this.tryEval(code + '()') || this.tryEval('this.' + code + '()') || console.warn(\"Code non \u00E9valuable dans App : %s\", code)\n      ;\n    if ( ok ) { return true ; }\n    else { return false; }\n  }\n  private static tryEval(code: string){\n    console.log(\"Code \u00E0 \u00E9valuer dans App.tryEval\", code);\n    try {\n      // eval(code);\n      const result = new Function('return ' + code).call(this);\n      if (undefined === result) { throw new Error(\"Code qui ne renvoie rien\");}\n      if ( 'function' === typeof result) { result(); }\n      return true;\n    } catch(erreur) {\n      // console.warn(erreur);\n      return false;\n    }\n  }\n\n}", "import { PanelClient } from \"./PanelClient\";\nimport { App } from \"./services/App\";\n\n/**\n * Pour g\u00E9rer les consoles de chaque panneau\n */\nexport class ConsoleManager {\n  private console: HTMLInputElement;\n  private history: string[] = [];\n  private ihistory: number = 0;\n\n  constructor(private panel: PanelClient<any>) {\n    this.console = panel.consoleInput as HTMLInputElement;\n  }\n  runCode() {\n    // Il vaut \u00E9valuer l'expression\n    const code = this.console.value;\n    try {\n      const result = (0, eval)(code);\n      this.history.push(code);\n      this.ihistory = this.history.length; // oui, vraiment\n      this.console.value = '';\n    } catch (error) {\n      if ( false === App.eval(code)) {\n        this.panel.flash(\"Ce code produit une erreur\u2026\", 'error');\n        console.error(code, error);\n      }\n    }\n  }\n  setCode(){\n    console.log(\"Console.setCode. History. iHistory\", this.history, this.ihistory);\n    this.console.value = this.history[this.ihistory];\n  }\n  backHistory(){\n    if ( this.ihistory === 0) {\n      console.log(\"Fin de l'historique\");\n      this.console.value = '';\n      return;\n    }\n    this.ihistory --;\n    this.setCode();\n  }\n  forwardHistory(){\n    if ( this.ihistory === this.history.length - 1) {\n      console.log(\"Bout de l'historique\");\n      return;\n    }\n    this.ihistory ++;\n    this.setCode();\n  }\n}", "/**\n * Utilitaire pour normaliser les cha\u00EEnes de caract\u00E8res\n * (suppression des accents, minuscules, etc.)\n */\nexport class StringNormalizer {\n  /**\n   * Normalise une cha\u00EEne en minuscules\n   */\n  static toLower(text: string): string {\n    return text.toLowerCase();\n  }\n\n  /**\n   * Normalise une cha\u00EEne en supprimant les accents et diacritiques\n   * TODO: \u00C0 am\u00E9liorer avec une vraie fonction de normalisation\n   */\n  static rationalize(text: string): string {\n    return text\n      .toLowerCase()\n      .normalize('NFD') // D\u00E9compose les caract\u00E8res accentu\u00E9s\n      .replace(/[\\u0300-\\u036f]/g, '') // Supprime les marques diacritiques\n      .replace(/[^a-zA-Z0-9]/g, '');  // note : si c'\u00E9tait avant la ligne pr\u00E9c\u00E9dente, il n'y aurait pas besoin de la ligne pr\u00E9c\u00E9dente\u2026\n  }\n}\n", "import { AnyItemType } from \"../../bothside/types\";\nimport { PanelClient } from \"../PanelClient\";\nimport { AccessTable } from \"./AccessTable\";\n\nconst DEBUGIT = false;\n/**\n * Class principal de la gestion des s\u00E9lections dans les panneaux.\n * Chaque panneau poss\u00E8de son propre manager de s\u00E9lection puisque les\n * panneaux sont totalement ind\u00E9pendants.\n * \n * ATTENTION : Ce n'est pas cette classe qui g\u00E8re l'aspect des\n * \u00E9l\u00E9ments s\u00E9lectionn\u00E9s, c'est l'accessTable (jusqu'\u00E0 nouvel ordre\n * en tout cas...)\n * \n * C'est l'AccessTable de chaque panneau qui poss\u00E8de une instance de cette\n * classe appel\u00E9 selectionManager. Donc <panel>.accessTable.selectionManager.\n * \n * Pour le moment, on part du principe qu'il y a une seule s\u00E9lection \u00E0 la fois et\n * qu'il y a toujours une s\u00E9lection (la pr\u00E9c\u00E9dente ou la premi\u00E8re).\n * \n * On m\u00E9morise l'historique des s\u00E9lections afin de pouvoir y revenir.\n * \n * On ne manipule ici que des identifiants d'item, donc des strings courts.\n */\n\nexport class SelectionManager {\n  // La panneau associ\u00E9 au manager de s\u00E9lection\n  private panel: PanelClient<AnyItemType>;\n\n  private current: string | undefined = undefined;\n  public getCurrent(): string | undefined { return this.current; }\n  private icursor: number = 0;\n  private historique: string[] = [];\n \n  constructor(\n    private accessTable: AccessTable<AnyItemType>,\n  ) {\n    this.panel = accessTable.panel;\n  }\n\n  /**\n   * @api\n   * \n   * S\u00E9lection du prochain item (ou le premier)\n   * \n   */\n  public selectNextVisibleItem(){\n    let nextId: string | undefined = undefined;\n    // Avant toute chose, on cherche le suivant\n    if (this.current) {\n      nextId = (this.accessTable.getNextVisible(this.current) as AnyItemType).id;\n    }\n    nextId = nextId || (this.accessTable.getFirstVisible() as AnyItemType).id;\n    \n    this.debugit('Affectation de l\u2019item', nextId);\n\n    // On s\u00E9lectionne l'item suivant (ou le premier)\n    this.setAsCurrentSelected(nextId);\n\n    // On l'ajoute \u00E0 l'historique\n    this.add(nextId);\n  }\n\n  /**\n   * @papi\n   * \n   * S\u00E9lection de l'item visible pr\u00E9c\u00E9dent.\n   * \n   */\n  public selectPreviousVisibleItem(){\n    let prevId: string | undefined = undefined;\n    if (this.current){\n      prevId = (this.accessTable.getPrevVisible(this.current) as AnyItemType).id;\n    }\n    prevId = prevId || (this.accessTable.getFirstVisible() as AnyItemType).id;\n    // Et on s\u00E9lectionne l'item pr\u00E9c\u00E9dent (ou le premier)\n    this.setAsCurrentSelected(prevId);\n    \n    // On l'ajoute \u00E0 l'historique\n    this.add(prevId);\n\n  }\n  /**\n   * @api\n   * \n   * M\u00E9thode pour d\u00E9selectionner la s\u00E9lection courante.\n   * \n   * Elle doit \u00EAtre publique car elle sert par exemple en cas de\n   * filtrage de la liste.\n   * \n   */\n  public deselectCurrent(){\n    this.current && this.accessTable.setSelectState(this.current, false);\n    this.current = undefined; \n  }\n \n  /**\n   * @api\n   * \n   * (Re)s\u00E9lectionne l'item pr\u00E9c\u00E9dent.\n   * \n   * Le \"re\" de \"reselectionne\" n'est l\u00E0 que pour indiquer qu'on fait\n   * cette op\u00E9ration est par une s\u00E9lection \"classique\". Elle est\n   * utilis\u00E9e en cas de filtrage de liste, quand l'itemp qui \u00E9t\u00E9 s\u00E9-\n   * lectionn\u00E9 et encore visible. Mais this.current a \u00E9t\u00E9 mis \u00E0 rien\n   * au d\u00E9but du filtrage.\n   * \n   * Note : on ne l'ajoute pas \u00E0 l'historique puisqu'il s'y trouve \n   * d\u00E9j\u00E0.\n   */\n  reselectItem(itemId: string){\n    this.setAsCurrentSelected(itemId);\n  }\n\n  /**\n   * @api Par exemple s\u00E9lection demand\u00E9e depuis un autre panneau\n   * \n   * @param itemId Identifiant de l'item \u00E0 s\u00E9lectionner\n   */\n  selectItem(itemId: string){\n    this.setAsCurrentSelected(itemId);\n    this.add(itemId);\n  }\n\n  /**\n    * Pour revenir \u00E0 l'item pr\u00E9c\u00E9dent\n    */\n  public historyBack() {\n    this.debugit('back');\n    this.ensurePrevCursor();\n    this.setAsCurrentSelected(this.historique[this.icursor]);\n  }\n  /**\n   * Pour passer \u00E0 l'\u00E9l\u00E9ment suivant\n   */\n  public historyNext() {\n    this.debugit('next');\n    this.ensureNextCursor();\n    this.setAsCurrentSelected(this.historique[this.icursor]);\n  }\n\n  /**\n   * Pour retirer l'item courant de l'historique des s\u00E9lections\n   */\n  public removeCurrentFromHistory() {\n    if (this.size === 1) {\n      this.panel.flash(\"On ne peut pas retirer le dernier item d\u2019historique s\u00E9lectionn\u00E9.\", 'warn');\n    } else {\n      this.historique.splice(this.icursor);\n      this.historyBack();\n    }\n  }\n\n\n\n  /**\n   * M\u00E9thode qui s'occupe de mettre l'\u00E9l\u00E9ment +itemId+ en item \n   * courant en s'assurant de s\u00E9lectionner l'item qui serait\n   * actuellement s\u00E9lectionn\u00E9.\n   * \n   * @param itemId Identifiant de l'\u00E9l\u00E9ment \u00E0 mettre en courant\n   */\n  private setAsCurrentSelected(itemId: string){\n     // S'il y avait un s\u00E9lectionn\u00E9, on le d\u00E9selectionne\n    this.current && this.deselectCurrent();\n    // On met le nouveau courant\n    this.current = String(itemId);\n    // On s\u00E9lectionne l'item\n    this.select();\n    // Et on scrolle jusqu'\u00E0 lui\n    this.panel.scrollTo(this.current);\n  }\n  \n\n  private select() {\n    this.current && this.accessTable.setSelectState(this.current, true);\n  }\n\n  private add(itemId: string) {\n    this.debugit('add');\n    this.historique.push(itemId);\n    this.icursor = this.lastIndex;\n  }\n  private ensurePrevCursor() {\n    this.icursor--;\n    if (this.icursor < 0) { this.icursor = this.lastIndex; }\n  }\n  private ensureNextCursor() {\n    this.icursor++;\n    if (this.icursor > this.lastIndex) { this.icursor = 0; }\n  }\n\n  private get lastIndex() { return this.size - 1; }\n  private get size() { return this.historique.length; }\n\n  // Pour d\u00E9bugger la classe\n  private debugit(where: string, id: string | undefined = undefined) {\n    if (!DEBUGIT) { return; }\n    console.log(`\n      [${where}]\n      icursor = %i\n      current = '%s'\n      id fourni = '%s'\n      `, this.icursor, (this.current ? `'${this.current}'` : 'undefined'), id, this.historique);\n  }\n\n\n}\n", "import { EntryType, OeuvreType, ExempleType, AnyItemType } from \"../bothside/types\";\nimport { SelectionManager } from \"./services/SelectionManager\";\nimport { PanelClient } from \"./PanelClient\";\n\ntype ItemDataType = EntryType | OeuvreType | ExempleType;\n\n/**\n * Class abstraite pour tous les Items (Entry, Oeuvre, Exemple)\n */\nexport abstract class ClientItem<Tdt extends ItemDataType> {\n  static klass: any;\n  public static get accessTable(){ return this.klass._accessTable;}\n  public static panel: PanelClient<any>;\n\n  // protected static _accessTable: AccessTable<any>;\n  private static _selector: SelectionManager;\n  public static get Selector(){ \n    return this._selector || (this._selector = new SelectionManager(this.klass));\n  }\n\n  // Raccourcis vers l'accessTable, pour obtenir des informations\n  // sur les items ou les items eux-m\u00EAme\n  static get(itemId: string): AnyItemType | undefined {\n    return this.accessTable.get(itemId);\n  } \n  static getObj(itemId: string): HTMLDivElement {\n    return this.accessTable.getObj(itemId);\n  }\n  static each(method:(item: AnyItemType) => void){ this.accessTable.each(method);}\n\n  static isVisible(id: string): boolean { return this.accessTable.isVisible(id); }\n  static setVisible(id: string) { this.accessTable.setVisibility(id, true); }\n  static setInvisible(id: string) { this.accessTable.setVisibility(id, false); }\n\n  static selectFirstItem() { this.panel.select(this.accessTable.firstItem);}\n\n  static editItem(itemId: string): void { this.panel.form.editItem(this.get(itemId)); }\n  static createNewItem(){ \n    // Cr\u00E9er un objet DB vide pour nouveau item\n    const emptyDbData = { id: '' }; // Les autres champs seront initialis\u00E9s dans le formulaire\n    this.panel.form.editItem(new this.klass(emptyDbData)); \n  }\n\n  // toRow(){ return {};}\n  /**\n   * M\u00E9thode qui re\u00E7oit les items s\u00E9rialis\u00E9s depuis l'extension et va les\n   * consigner dans le panneau, dans une AccessTable qui permettra de \n   * parcourrir les \u00E9l\u00E9ments. \n   */\n  static deserializeItems(items: string[]): void {\n    const allItems: AnyItemType[] = items.map( (item: string) => JSON.parse(item) as AnyItemType);\n    // console.log(\"Tous les items\", allItems);\n    this.setAccessTableWithItems(allItems);\n  }\n  /* Surclass\u00E9e */ static setAccessTableWithItems(items: any){};\n\n  public get id(): string {return this.item.id;}\n\n  constructor(\n    public item: Tdt\n  ){ } \n\n  // Pour obtenir l'AccKey (ak) de l'item\n  static getAccKey(id: string) { return this.accessTable.getAccKey(id) ; }\n}", "/**\n * Canal RPC pour communiquer entre extension et webview.\n * Les deux c\u00F4t\u00E9s chargent ce module.\n */\ntype Request = {\n  id: number;\n  method: string;\n  params: any;\n};\n\ntype Response = {\n  id: number;\n  result: any;\n};\n\ntype Notification = {\n  method: string;\n  params: any;\n};\n\nexport class RpcChannel {\n  private counter = 0;\n  private pending = new Map<number, (value: any) => void>();\n  private handlers = new Map<string, (params: any) => any>();\n\n  constructor(\n    private sender: (msg: any) => void,\n    private receiver: (cb: (msg: any) => void) => void\n  ) {\n    this.receiver(this.handleMessage.bind(this));\n  }\n\n  private handleMessage(msg: any) {\n    if (\"id\" in msg && \"method\" in msg) {\n      // C\u2019est une requ\u00EAte (ask c\u00F4t\u00E9 oppos\u00E9)\n      const handler = this.handlers.get(msg.method);\n      if (handler) {\n        Promise.resolve(handler(msg.params)).then((result) => {\n          this.sender({ id: msg.id, result });\n        });\n      }\n    } else if (\"id\" in msg && \"result\" in msg) {\n      // R\u00E9ponse\n      const cb = this.pending.get(msg.id);\n      if (cb) {\n        cb(msg.result);\n        this.pending.delete(msg.id);\n      }\n    } else if (\"method\" in msg) {\n      // Notification (notify c\u00F4t\u00E9 oppos\u00E9)\n      const handler = this.handlers.get(msg.method);\n      if (handler) {\n        handler(msg.params);\n      }\n    }\n  }\n\n  ask(method: string, params?: any): Promise<any> {\n    const id = this.counter++;\n    const req: Request = { id, method, params };\n    this.sender(req);\n    return new Promise((resolve) => {\n      this.pending.set(id, resolve);\n    });\n  }\n\n  notify(method: string, params?: any) {\n    // console.log(\"Message re\u00E7u dans le 'notify' du RpcChannel\", method, params);\n    const notif: Notification = { method, params };\n    this.sender(notif);\n  }\n\n  on(method: string, handler: (params: any) => any) {\n    // console.log(\"Message re\u00E7u dans le 'on' du RpcChannel\", method, handler);\n    this.handlers.set(method, handler);\n  }\n}\n", "import { RpcChannel } from \"../bothside/RpcChannel\";\n\ndeclare function acquireVsCodeApi(): {\n  postMessage: (msg: any) => void;\n};\n\nexport function createRpcClient() {\n  const vscode = acquireVsCodeApi();\n\n  return new RpcChannel(\n    // sender : envoie vers l'extension\n    (msg) => vscode.postMessage(msg),\n    // receiver : re\u00E7oit les messages de l'extension\n    (cb) => window.addEventListener(\"message\", (event) => cb(event.data))\n  );\n}", "import { PanelClient } from \"../PanelClient\";\nimport { App } from \"./App\";\n\nexport class Help {\n  /**\n   * D\u00E9finitions des aides contextuelles.\n   * Soit un simple string (si pas de raccourcis clavier)\n   * Soit un array [aide, {lettre: methode-string}] \n   */\n  static get(keyHelp: string): string |undefined {\n    switch(keyHelp){\n\n      // FEN\u00CATRE DE D\u00C9MARRAGE\n      case 'start': return `\n      ## D\u00E9marrage de l'extension\n\n      Pour commencer, activer le premier panneau (entr\u00E9es) avec \u23181.\n\n      \u00C0 tout moment, vous pouvez obtenir de l'aide contextuelle en tapant \"?\" (donc \"\u21E7,\").\n      \n      Les raccourcis de base, utilisable dans les trois panneaux, sont les suivants :\n\n      ${this.buildShortcutsTable([\n        {s: 's', m: 'NORMAL', d: 'Pour se placer dans le champ de filtre et filtrer la liste.'},\n        {s: 'n', m: 'NORMAL', d:'Pour cr\u00E9er un nouvel \u00E9l\u00E9ment.'},\n        {s: 'j', m: 'NORMAL', d: 'Pour s\u00E9lectionner l\u2019\u00E9l\u00E9ment suivant ou le premier.'},\n        {s: 'k', m: 'NORMAL', d: 'Pour remonter \u00E0 l\u2019\u00E9l\u00E9ment pr\u00E9c\u00E9dent'},\n        {s: 'b', m: 'NORMAL', d: '(comme \u00AB\u00A0back\u00A0\u00BB) Pour s\u00E9lectionner l\u2019\u00E9l\u00E9ment pr\u00E9c\u00E9demment s\u00E9lectionn\u00E9'},\n        {s: 'f', m: 'NORMAL', d: 'Pour repasser \u00E0 l\u2019\u00E9l\u00E9ment suivant de l\u2019historique des s\u00E9lections'},\n        {s: 'r', m: 'NORMAL', d: 'Pour retirer la s\u00E9lection de l\u2019historique des s\u00E9lections'},\n        {s: 'e', m: 'NORMAL', d: 'Pour mettre en \u00E9dition l\u2019\u00E9l\u00E9ment s\u00E9lectionn\u00E9.'},\n        {s: 'm', m: 'NORMAL', d: '(comme \u00AB mise en forme\u00A0\u00BB) pour mettre en forme le texte.'},\n        {s: 'Tab', m: 'NORMAL', d: 'pour passer de lien en lien (d\u00E9finition et exemple)'},\n        {s: '\u21E7Tab', m: 'NORMAL', d: 'Passer de lien en lien en remontant'},\n        {s: 'g', m: 'NORMAL', d: 'Rejoindre la cible du lien'},\n        {s: 'c', m: 'NORMAL', d: 'Pour se placer dans la console et jouer une commande.'},\n        {s: 'C (\u21E7c)', m: 'NORMAL', d: 'Choisir l\u2019entr\u00E9e s\u00E9lectionn\u00E9e pour le nouvel exemple d\u00E9j\u00E0 en \u00E9dition.'},\n        {s: 'E (\u21E7e)', m: 'NORMAL', d: 'Cr\u00E9er un nouvel exemple pour l\u2019entr\u00E9e.'},\n      ])}\n      \n      \u00C0 tout moment, taper **?** pour afficher l'aide contextuelle.\n      \n      ## Commandes\n\n      ${this.buildCommandsTable([\n        {c: 'openSupport', d:'\u2026 pour ouvrir le dossier support dans le Finder, qui contient la base et tous les backups.' },\n        {c: 'exportAllData', d: '\u2026 pour faire un export des donn\u00E9es dans quatre formats, JSON, YAML, CSV et Simple Text.'},\n      ])}\n\n      ## \u00C9dition de la d\u00E9finition\n\n      ## Autocompl\u00E9tion\n\n      ${this.buildShortcutsTable([\n        {s: 'tt\u21E5', m:'EDIT', d: 'Ajouter un mot technique index\u00E9'},\n        {s: '->(\u21E5', m:'EDIT', d: 'Ajouter un mot technique avec num\u00E9ro de page'},\n        {s: 'ttp\u21E5', m:'EDIT', d: 'Ajouter la page d\u2019un mot technique'}\n      ])}\n      `\n      ;\n\n      // CR\u00C9ATION D'UN \u00C9L\u00C9MENT QUELCONQUE\n      case 'create-element': return `\n      ## Cr\u00E9ation d'un \u00E9l\u00E9ment\n      \n      Vous pouvez vous d\u00E9placer de champ en champ avec les touches \n      <shortcut>a</shortcut>, <shortcut>b</shortcut>, etc. ou la touche \n      tabulation.`;\n\n      // CR\u00C9ATION D'UNE OEUVRE\n      case 'create-oeuvre': return `\n      ## Cr\u00E9ation d'une \u0153uvre\n\n      Jouer la touche <shortcut>n</shortcut> pour cr\u00E9er le nouvel \u00E9l\u00E9ment.\n\n      Une fois le titre rentr\u00E9, gr\u00E2ce \u00E0 la touche <shortcut>i</shortcut>, vous \n      pouvez obtenir les infos qu'on peut trouver sur le net. En pr\u00E9cisant l'ann\u00E9e \n      (approximative), la langue et/ou le pays, vous pouvez \u00EAtre presque certain \n      de trouver l'\u0153uvre du premier coup.\n\n      L'ann\u00E9e (approximative \u00E0 10 ans pr\u00E8s) se met dans le champs d\u00E9die, la langue \n      et le pays peuvent s'indiquer dans le champs 'notes' sous la forme JSON. Par \n      exemple <code>{\"langue\": \"en\", \"pays\": \"us\"}</code>.\n\n      Ensuite, TMDB renvoie la liste de toutes les \u0153uvres correspondantes qu'il a \n      trouv\u00E9 et les passe en revue pour choisir laquelle garder. \u00C7a se fait en deux \n      temps\u00A0:\n\n      - rel\u00E8ve de toutes les \u0153uvres, d'un coup, avec infos minimales,\n      - on fait un tri par rapport \u00E0 celles-ci,\n      - TMDB rel\u00E8ve les informations compl\u00E8tes (principalement les cr\u00E9dits),\n      - On choisit celle qui correspond vraiment.\n      `;\n\n      // \u00C9DITION D'UN \u00C9L\u00C9MENT\n      case 'edit-element': return `\n      ## \u00C9dition d'un \u00E9l\u00E9ment\n      \n      Vous pouvez aller de champ en champ avec les touches etc.`;\n\n      // \u00C9DITION D'UNE OEUVRE\n      case 'edit-oeuvre': return `\n      ## \u00C9dition d'une \u0153uvre\n\n      D\u00E9placez-vous de champ en champ avec la touche tabulation ou en jouant \n      les lettres en regard des champs.\n      `;\n    }\n  }\n  /**\n   * Pour construire une table de commande \n   * \n   * @param shortcuts D\u00E9finition des commandes\n   * @returns  La table HTML\n   */\n  private static buildCommandsTable(commands: {c: string, d: string}[]): string{\n    const rows: string[] = [];\n    rows.push('<tr><td>Commande</td><td>Effet</td></tr>');\n    commands.forEach(sc => rows.push(`<tr><td>${sc.c}</td><td>${sc.d}</td></tr>`));\n    return '<table class=\"commands\">' + rows.join('') + '</table>';\n  }\n\n  /**\n   * Pour construire une table de raccourcis-clavier\n   * \n   * @param shortcuts D\u00E9finition des raccourcis\n   * @returns  La table HTML\n   */\n  private static buildShortcutsTable(shortcuts: {s: string, m: string, d: string}[]): string{\n    const rows: string[] = [];\n    rows.push('<tr><td>Racc.</td><td>MODE</td><td>Effet</td></tr>');\n    shortcuts.forEach(sc => rows.push(`<tr><td><shortcut>${sc.s}</shortcut></td><td>${sc.m}</td><td>${sc.d}</td></tr>`));\n    return '<table class=\"shortcuts\">' + rows.join('') + '</table>';\n  }\n\n\n  constructor(private panel: PanelClient<any>) {\n  }\n  /**\n   * API\n   * M\u00E9thode activant l'aide circonstantielle.\n   * (voir le manuel)\n   */\n  public activateContextualHelp(){\n    const context = this.panel.context;\n    const extraParams = this.affineContexte(context);\n    const [content, KbBypass] = this.defineCHelp(context, extraParams);\n    this.showCHelp(content);\n    this.panel.keyManager.keyboardBypass = KbBypass;\n  }\n\n  private affineContexte(context: string): Record<string, any> | undefined {\n    switch(context) {\n      case 'create-new-element': \n        // il faut voir si l'user est au d\u00E9but ou \u00E0 la fin\n        return {};\n      default: return;\n    }\n  }\n\n  private defineCHelp(context:string, params: Record<string, any> | undefined): [string, Map<string, any>] {\n    const kbb = new Map();\n    kbb.set('q', this.closeCHelp.bind(this));\n    let bypass: {[x:string]: any};\n    let content: string = Help.get(context) as string;\n    return [this.formate(content as string) as string, kbb];\n  }\n\n  formate(str: string): string {\n    console.log(\"-> formate (formatage du texte d'aide\", str);\n   return str\n      // Pour \"compacter\" les codes HTML de paragraphe, table, etc.\n      .trim()\n      .replace(/^\\s+/gm, '')\n      .replace(/>\\n+/g, '>')\n      .replace(/\\n+<\\//g, '</')\n      .replace(/\\*\\*(.+?)\\*\\*/g, '<b>$1</b>')\n      .replace(/\\*(.+?)\\*/g, '<em>$1</em>')\n      .replace(/^### (.+)$/mg, '<h3>$1</h3>')\n      .replace(/^## (.+)$/mg, '<h2>$1</h2>')\n      .replace(/^# (.+)$/mg, '<h1>$1</h1>')\n      .split(\"\\n\\n\")\n      .map(s => {\n        // console.log(\"Segment: \", s);\n        if (s.startsWith('<')){return s;}\n        else {return `<p>${s}</p>`;}\n      })\n      .join('');\n  }\n  /**\n   * Affichage du texte d'aide contextuelle et mise en attente\n   * \n   * (note : le \"C\" de \"Chelp\" pour \"contextual\")\n   * \n   * @param content Le contenu textuel \u00E0 afficher\n   */\n  private showCHelp(content: string) {\n    this.CHbuilt || this.CHbuild();\n    this.CHObj.classList.remove('hidden');\n    const divCont = (this.CHObj.querySelector('.content') as HTMLElement);\n    divCont.innerHTML = content;\n  }\n  private CHObj!: HTMLDivElement;\n  private CHbuilt: boolean = false;\n\n  public closeCHelp(){\n    this.CHObj.classList.add('hidden');\n  }\n  \n  // Construction du div de l'aide contextuelle\n  CHbuild(){\n    let o = document.createElement('div');\n    o.className = \"aide-contextuelle hidden\";\n    let cont = document.createElement('div');\n    cont.className = 'content';\n    o.appendChild(cont);\n    let btns = document.createElement('div');\n    btns.className = 'buttons';\n    btns.innerHTML = 'q: quitter l\u2019aide';\n    o.appendChild(btns);\n    document.body.appendChild(o);\n    this.CHObj = o;\n    this.CHbuilt = true;\n  }\n}", "export const listen = function(element: HTMLElement, evType: keyof HTMLElementEventMap, method: (this: HTMLElement, ev: HTMLElementEventMap[typeof evType]) => any): void {\n element.addEventListener(evType, method); \n};\n\nexport const stopEvent = function(ev: any): false {\n  ev.preventDefault();\n  ev.stopImmediatePropagation();\n  return false;\n};", "import { AnyDbType, AnyItemType } from \"../../bothside/types\";\nimport { Entry } from \"../models/Entry\";\nimport { PanelClient } from \"../PanelClient\";\nimport { AccessTable } from \"./AccessTable\";\nimport { stopEvent } from \"./DomUtils\";\nimport { FormManager } from \"./FormManager\";\nimport { SelectionManager } from \"./SelectionManager\";\n\ntype MODES = 'normal' | 'edit' | 'null' | 'form' | 'console' ;\n\nexport class VimLikeManager {\n  // \n  /**\n   * MODE DU PANNEAU\n   * \n   * Pour le moment, le panneau peut \u00EAtre dans deux \u00E9tats, en\n   * fonction du fait que le curseur se trouve dans un champ\n   * \u00E9ditable ou non.\n   */\n  protected _keylistener: (ev: KeyboardEvent) => true | false | undefined | void;\n  protected _mode: MODES = 'normal' ; \n  protected get mode() { return this._mode ; }\n  private form: FormManager<AnyItemType, AnyDbType>;\n  public setMode(mode: MODES) { this.mode = mode; }\n  protected set mode(mode: MODES) { // de l'ext\u00E9rieur, utiliser la m\u00E9thode setMode \n    // console.info(\"[VimLikeManager mode] Mise du mode \u00E0 '%s')\", mode);\n    this._mode = mode ;\n    // Le mode d\u00E9termine le capteur d'\u00E9v\u00E8nement\n    switch(mode) {\n      case 'console':\n        this._keylistener = this.onKeyDownModeConsole.bind(this);\n        break;\n      case 'edit':\n        // console.log(\"[VimLikeManager.mode] Passage du mode clavier au mode edit\");\n        this._keylistener = this.onKeyDownModeEdit.bind(this);\n        break;\n      case 'normal':\n        // console.log(\"[VimLikeManager.mode] Passer le mode clavier en mode NORMAL\");\n        this._keylistener = this.onKeyDownModeNormal.bind(this);\n        break;\n      case 'null':\n        // console.log('Le panneau est en mode NULL (sans action');\n        this._keylistener = this.onKeyDownModeNull.bind(this);\n        break;\n      case 'form':\n        // console.log(\"Panneau en mode FORMulaire\");\n        this._keylistener = this.onKeyDownModeForm.bind(this);\n        break;\n    }\n    // Indiquer dans l'interface le mode\n    this.root.dataset.mode = `mode-${mode}` ;\n    \n    if (this.root.querySelector('span#mode-name')){\n      const spanName = this.root.querySelector('span#mode-name') as HTMLSpanElement;\n      spanName.innerHTML = mode.toLocaleUpperCase();\n    } else {\n      console.warn(\"Bizarrement, le span #mode-name affichant le mode du panneau est introuvable.\");\n    }\n  }\n\n  readonly searchInput: HTMLInputElement;\n  readonly consoleInput: HTMLInputElement;\n\n  constructor(\n    private root: HTMLBodyElement, \n    private panel: PanelClient<AnyItemType>, \n    private klass: any,\n  ) {\n    this.mode = 'null';\n    this.loadConsoleManager(); // Promise\n    // @DEPRECATED Il faut \u00EAtre plus pr\u00E9cis. Si on fait \u00E7a, dans le formulaire\n    // le mode est toujours remis au mode normal et edit\n    // this.root.addEventListener('focusin', this.onFocusIn.bind(this));\n    // this.root.addEventListener('focusout', this.onFocusOut.bind(this));\n\n    this.form = this.panel.form; // cached\n\n    // Pour placer une capture \"universelle\", c'est-\u00E0-dire qui capture les keydown\n    // quel que soit le mode courant\n    this.root.addEventListener('keydown', this.universelKeyboardCapture.bind(this), true);\n    // La m\u00E9thode qui capture les touches et les renvoie vers la m\u00E9thode appropri\u00E9e\n    // en fonction du mode.\n    this.root.addEventListener('keydown', this.onKeyDown.bind(this));\n    this._keylistener = this.onKeyDownModeNull.bind(this);\n    this.searchInput = this.root.querySelector('input#search-input') as HTMLInputElement;\n    this.consoleInput = this.root.querySelector('input#panel-console') as HTMLInputElement;\n    this.searchInput.addEventListener('focus', this.onFocusEditField.bind(this, this.searchInput));\n    this.searchInput.addEventListener('blur', this.onBlurEditField.bind(this, this.searchInput));\n    this.consoleInput.addEventListener('focus', this.onFocusConsole.bind(this, this.consoleInput));\n    this.consoleInput.addEventListener('blur', this.onBlurConsole.bind(this, this.consoleInput));\n  }\n\n  onFocusConsole(field: HTMLInputElement, ev: FocusEvent) {\n    this.setMode('console');\n  }\n  onBlurConsole(field: HTMLInputElement, ev: FocusEvent){\n    this.setMode('normal');\n  }\n  onFocusEditField(field: HTMLInputElement, ev: FocusEvent) {\n    this.setMode('edit');\n  }\n  onBlurEditField(field: HTMLInputElement, ev: FocusEvent ) {\n    // console.log(\"-> onBlurEditField\");\n    this.setMode('normal');\n    // console.log(\"<- onBlurEditField\");\n  }\n  keyboardBypass:Map<string, Function> | undefined;\n  // La m\u00E9thode qui choppe normalement toutes les touches, quel que soit le mode\n  /**\n   * Capteur Universel de Touche clavier\n   * \n   * Quel que soit le mode, cette m\u00E9thode re\u00E7oit les touches clavier\n   * avant tout le monde.\n\n   * Cela permet : \n   *    - d'impl\u00E9menter un syst\u00E8me de \"coupe-circuit\" qui est\n   *      utilis\u00E9 par exemple pour les messages de type \"action \n   *      demand\u00E9e\". (voir le manuel pour le d\u00E9tail). \n   *    - d'impl\u00E9menter la gestion de touche \"?\" qui permet, quelle\n   *      que soit la situation, d'obtenir de l'aide.\n   */\n  universelKeyboardCapture(ev: KeyboardEvent) {\n    // Pour voir toutes les touches qui sont press\u00E9es, toutes\n    // console.log(\"[universel capture (mode %s)] Key up = \", this.mode, ev.key, ev);\n\n    if ( ev.key === '?' ) {\n      // <= L'user a tap\u00E9 la touche '?'\n      // => On doit afficher l'aide circonstantielle (voir le manuel)\n      //    (m\u00EAme quand on est dans l'ide circonstantielle)\n      this.panel.activateContextualHelp();\n      return stopEvent(ev); \n    } else if ((ev.target as HTMLElement).tagName.toLowerCase() === 'select') {\n      const select = ev.target as HTMLSelectElement;\n      switch(ev.key) {\n        case 'j':\n        case 'ArrowDown': // Sur les menus <select>\n          select.selectedIndex += 1;\n          break;\n        case 'k':\n        case 'ArrowUp': // Sur les menus <select>\n          select.selectedIndex -= 1;\n          break;\n      }\n      return true;\n    } else if (this.keyboardBypass) {\n      // <= Un bypass existe (bloquant toutes les touches)\n      // => Il faut voir si la touche est connue\n      if (this.keyboardBypass.has(ev.key)) {\n        /* Ici, c'est un peu compliqu\u00E9, car il faut d\u00E9truire le bypass\n         * avant de jouer la m\u00E9thode car cette m\u00E9thode pourrait\n         * red\u00E9finir un autre coupe-circuit \u00E0 prendre en compte\n         */\n        const methodBypass = (this.keyboardBypass as Map<string, any>).get(ev.key);\n        // console.log('methodBypass dans VimLike', methodBypass);\n        delete this.keyboardBypass;\n        // Attention, ci-dessous, j'ai peut-\u00EAtre un souci de niveau\n        // du \"effacer avant de jouer la m\u00E9thode bypass ou effacer\n        // apr\u00E8s ?\" Si j'ai plusieurs flashAction qui se suivent, il\n        // faut effacer avant. V\u00E9rifier si dans d'autres cas, c'est\n        // le contraire et voir comment on peut faire.\n        this.panel.cleanFlash();\n        this.panel.cleanFooterShortcuts(); // Les raccourcis ont pu y \u00EAtre affich\u00E9s\n        methodBypass(); \n      }\n      // Dans tous les cas on bloque la touche et on supprime le\n      // coupe-circuit clavier\n      return ev && stopEvent(ev);\n    }\n    return true;\n  }\n\n  /**\n   * API\n   * M\u00E9thode de discrimination dans l'objet +obj+. Tous les champs qu'il contient\n   * qui sont des champs d'\u00E9dition textuels vont faire basculer dans le mode :editMode\n   * quand ils sont focusser et le mode :normalMode (souvent 'normal') quand on va\n   * les blurer \n   * \n   * @param obj {HTMLElement} Bloc contenant les champs d'\u00E9dition\n   * @param modes {Hash} Table d\u00E9finisssant :edit et :normal pour savoir le nom des\n   * modes \u00E0 utiliser en \u00E9dition (dans un champ \u00E9ditable) et hors \u00E9dition.\n   */\n  discrimineFieldsForModeIn(obj: HTMLElement, modes: {edit: MODES, normal: MODES}) {\n    const selectors = 'input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], textarea, [contenteditable]';\n    obj.querySelectorAll(selectors).forEach(field => {\n      // console.log(\"Discrimination du champ \", field);\n      field.addEventListener('focus', this.setMode.bind(this, modes.edit));\n      field.addEventListener('blur', this.setMode.bind(this, modes.normal));\n    });\n  }\n\n  // Sera remplac\u00E9 par la bonne m\u00E9thode suivant le mode.\n  onKeyDown(ev: KeyboardEvent) { \n    return this._keylistener(ev);\n  }\n\n  /**\n   * ============ TOUS LES MODES DE CLAVIER ================\n   */\n\n  // Quand la touche meta est press\u00E9e, on passe toujours par l\u00E0\n  onKeyDownWithMeta(ev: KeyboardEvent) {\n    switch(ev.key) {\n      case 'q': case 'Q':\n        stopEvent(ev);\n        console.log(\"On ne peut pas quitter comme \u00E7a\u2026\");\n        break;\n      case 's': case 'S':\n        stopEvent(ev);\n        console.log(\"Demande de sauvegarde forc\u00E9e.\");\n        break;\n    }\n  }\n  private get accessTable(): AccessTable<AnyItemType>{\n    return this._accesstable || (this._accesstable = this.klass.accessTable);\n  }\n  private get selectionManager(): SelectionManager {\n    return this._selmanager || (this._selmanager = this.accessTable.selectionManager);\n  } \n  private _accesstable!: AccessTable<AnyItemType>;\n  private _selmanager!: SelectionManager;\n  \n  onKeyDownModeNormal(ev: KeyboardEvent) {\n    // console.log(\"-> VimLikeManager.onKeyDownModeNormal\", ev.key, ev);\n    if (ev.metaKey) { return this.onKeyDownWithMeta(ev); }\n    stopEvent(ev);\n    switch (ev.key) {\n      case 's': // focus dans champ de filtre\n        this.searchInput.focus(); break;\n      case 'j': // S\u00E9lection item apr\u00E8s\n        this.selectionManager.selectNextVisibleItem(); break;\n      case 'k': // S\u00E9lection item avant\n        this.selectionManager.selectPreviousVisibleItem(); break;\n      case 'b': // back to s\u00E9lection pr\u00E9c\u00E9dente\n        this.selectionManager.historyBack(); break;\n      case 'f': // forward to s\u00E9lection pr\u00E9c\u00E9dentes\n        this.selectionManager.historyNext();break;\n      case 'r': // remove courante s\u00E9lection from historique s\u00E9lections\n      this.selectionManager.removeCurrentFromHistory();break;\n      case 'c': // focus dans console\n        this.consoleInput.focus(); break;\n      case 'e':\n        if ( this.panel.getSelection() ) {\n          this.klass.editItem(this.panel.getSelection() as string);\n        } else { console.log(\"Pas de s\u00E9lection \u00E0 \u00E9diter\");}\n        break;\n      case 'n':\n        this.klass.createNewItem();\n        break;\n      case 'Tab':\n        this.panel.nextLinkSelection(ev.shiftKey);\n        break;\n      case 'g': \n        this.panel.activeLinkSelection();\n        break;\n      default: \n         // Le panneau peut aussi d\u00E9finir sa propre table\n        if (this.panel.tableKeys[ev.key]) {this.panel.tableKeys[ev.key].fn.call(null);}\n        else {\n          console.log(\"Pour le moment, je ne fais rien de '%s'\", ev.key);\n        }\n    }\n    return false;\n  }\n\n  /**\n   * Gestionnaire des touches de clavier en mode EDIT (dans un\n   * champ d'\u00E9dition) \n   */\n  onKeyDownModeEdit(ev: KeyboardEvent) {\n    if ( ev.metaKey ) { return this.onKeyDownWithMeta(ev) ; }\n    switch(ev.key) {\n      case 'Tab': \n      //*\n        switch(this.threelast.join('')){\n          case 'dim':\n            ev.stopPropagation();\n            return this.klass.autocompleteDim(ev);\n        }\n        \n        switch(this.twolast.join('')){\n          case '>(':\n            ev.stopPropagation();\n            return this.klass.autoCompleteBaliseTerm('->', ev);\n          case 'tp': \n            ev.stopPropagation();\n            return this.klass.autoCompleteBaliseTerm('ttp', ev);\n          case 'tt':\n            ev.stopPropagation();\n            return this.klass.autoCompleteBaliseTerm('tt', ev);\n        }\n            //*/\n        (ev.target as HTMLElement).blur();\n        return stopEvent(ev);\n      default:\n        console.log(\"Touche non trait\u00E9e : %s\", ev.key);\n    }\n    // Pour toujours conserver les trois derni\u00E8res lettres\n    this.threelast.shift();\n    this.threelast.push(ev.key);\n    // Pour toujours conserver les deux derni\u00E8res touches\n    this.twolast.shift();\n    this.twolast.push(ev.key);\n    console.log(\"Deux derni\u00E8res lettres = '%s'\", this.twolast.join(''));\n    return true;\n\n  }\n  private twolast: [string, string] = ['', ''];\n  private threelast: [string, string, string] = ['', '', ''];\n\n  // Mode clavier pour la console\n  private consoleManager!: any; // Instance ConsoleManager;\n  onKeyDownModeConsole(ev: KeyboardEvent){\n    switch(ev.key) {\n      case 'Enter':\n        this.consoleManager.runCode();\n        break;\n      case 'ArrowDown':\n        this.consoleManager.forwardHistory();\n        break;\n      case 'ArrowUp':\n        this.consoleManager.backHistory();\n        break;\n      default:\n        console.log(\"Console. Lettre %s\", ev.key);\n    }\n  }\n  async loadConsoleManager(){\n    const module = await import('../ConsoleManager');\n    this.consoleManager = new module.ConsoleManager(this.panel);\n  }\n\n  // Mode clavier pour le formulaire\n  onKeyDownModeForm(ev: KeyboardEvent) {\n    // console.log(\"-> onKeyDownModeForm\", ev);\n    // Pour emp\u00EAcher toute action pendant la sauvegarde\n    if ( this.form.saving === true ) { return; }\n    if (ev.metaKey) { return this.onKeyDownWithMeta(ev); }\n    switch (ev.key) {\n      case 'a': // focusser dans premier champ (avec shortcut)\n        this.form.focusField(1); break;\n      case 'b': // focusser dans le second champ\n        this.form.focusField(2); break;\n      case 'c': // focusser dans le 3e champ\n        this.form.focusField(3); break;\n      case 'd': // focusser dans le 4e champ\n        this.form.focusField(4); break;\n      case 'e': // focusser dans le 5e champ\n        this.form.focusField(5); break;\n       case 'f': // focusser dans le 6e champ\n        this.form.focusField(6); break;\n      case 'g':\n        this.form.focusField(7); break;\n      case 'l': // Bloquer/d\u00E9bloquer le verrouillage de l'id\n        this.form.toggleIdLock(); break;\n      case 's': // Sauvegarder\n        this.form.saveItem(false); break;\n      case 'w': // \n        this.form.saveItem(true); break;\n      case 'q': // Annuler\n        this.form.cancelEdit(); break;\n     default:\n        // Le formulaire peut d\u00E9finir une table `tableKeys' pour\n        // d\u00E9finir les fonctions \u00E0 appeler par touche\n        if (this.form.tableKeys[ev.key]) {this.form.tableKeys[ev.key].fn.call(null);}\n    }\n    // On annule l'\u00E9v\u00E8nement\n    return stopEvent(ev);\n  }\n  \n  onKeyDownModeNull(ev: KeyboardEvent) {\n    console.error(\"Il faut activer un mode de clavier\");\n    return stopEvent(ev);\n  }\n\n  // @return true si la cible de l'\u00E9v\u00E8nement +ev+ est un champ \u00E9ditable\n  targetEventIsEditable(ev: any) : boolean {\n    return (ev.target as HTMLElement).matches('input, textarea, [contenteditable]');\n  }\n}", "declare global {\n  interface Map<K, V> {\n    firstValue(): this,\n  }\n}\n\nMap.prototype.firstValue = function(){\n  for(var v of this.values()){ return v; }\n};\n\nexport {};", "import { Entry } from \"./models/Entry\";\nimport { Exemple } from \"./models/Exemple\";\nimport { Oeuvre } from \"./models/Oeuvre\";\nimport { AccedableItem, AccessTable } from \"./services/AccessTable\";\nimport { FormManager } from \"./services/FormManager\";\nimport { Help } from \"./services/HelpManager\";\nimport { VimLikeManager } from \"./services/VimLikeManager\";\nimport \"../bothside/class_extensions\";\nimport { AnyItemType } from \"../bothside/types\";\nimport { stopEvent } from \"./services/DomUtils\";\n\n\nexport type FlashMessageType = 'notice' | 'warn' | 'error' | 'action';\n\ninterface PanelConstructorData {\n  minName: string;\n  titName: string;\n  klass: typeof Entry | typeof Oeuvre | typeof Exemple;\n  form: any; // gestionnaire de formulaire\n}\n\nexport class PanelClient<T extends AnyItemType> {\n  \n  // ========== A P I ================\n\n  public tableKeys: Record<string, {lab: string, fn: Function}> = {}; // shortcuts propres aux panneaux\n  public context: string = 'start';\n  public form!: FormManager<any, any>;\n  public get isActif(): boolean { return this._actif === true ; }\n  public get isInactif(): boolean { return this._actif === false ; }\n  public get keyManager(){ return this._keyManager; }\n  // Pour marquer le panneau actif ou inactif\n  public activate() { \n    this.setPanelFocus(true); \n    // Si un formulaire \u00E9tait actif, il faut repasser en mode 'form'\n    if (this.form.isActive()) {\n      this.form.__onFocusOnForm(undefined);\n    }\n  }\n  public desactivate() { this.setPanelFocus(false); }\n\n  /**\n   * M\u00E9thode puissante permettant d'attendre une r\u00E9action de l'utilisateur en affichant un \n   * message. Typiquement, c'est le \"Pour faire \u00E7a, tapez 1, pour faire \u00E7a, tapez 2\".\n   * \n   * Noter que \u00E7a n'est pas une m\u00E9thode asynchrone. Si on l'utilise, c'est \u00E0 l'ancienne, en\n   * arr\u00EAtant le flux apr\u00E8s elle.\n   * \n   * @param msg Le message \u00E0 afficher\n   * @param buttons La table des raccourcis/fonctions qui doivent court-circuiter le fonctionnement\n   *    Ils peuvent avoir deux formes : \n   *    - seulement la fonction buttons.set('<touche>', this.<fonction>.bind(this))\n   *    - le message et la fonction : buttons.set('<touche>', ['le message', this.<fonction>.bind(this)])\n   *      Dans ce dernier cas, le message sera affich\u00E9 au-dessus et les boutons sous la console, dans la\n   *      partie des outils du panneau.\n   */\n  public flashAction(msg: string, buttons: Map<string, any>) {\n    let realButtons = buttons;\n    this.flash(msg, 'action');\n    if (Array.isArray(buttons.firstValue())) {\n      realButtons = new Map();\n      const outils: string[] = [];\n      buttons.forEach((ary: any, lettre: string ) => {\n        const [ordre, fonction] = ary;\n        outils.push(`<shortcut>${lettre}</shortcut> ${ordre}`);\n        realButtons.set(lettre, fonction);\n      });\n      // console.log(\"outils\", outils);\n      // On \u00E9crit les raccourcis dans le pied de page\n      const o = document.createElement('div');\n      o.id = 'footer-shortcuts';\n      o.innerHTML = outils.join('&nbsp;&nbsp;');\n      this.footer.appendChild(o); \n    } \n    // On donne les boutons au manager de clavier\n    this.keyManager.keyboardBypass = realButtons;\n  }\n\n\n  /**\n   * Affichage d'un message en haut du panneau.\n   * \n   * @param msg Le message\n   * @param type Le type de message\n   */\n  public flash(msg:string, type: FlashMessageType) {\n    const o = document.createElement('div');\n    o.className = type;\n    o.innerHTML = msg;\n    this.messageBox.appendChild(o);\n    this.messageBox.style.zIndex = '10';\n    if ( type === 'notice' ) {\n      // Temporiser le message\n      setTimeout(() => { this.cleanFlash.call(this); }, 10 * 1000);\n    } else if ( type === 'action' ) {\n      // Bloquer le message avec quelques lettres possibles seulement\n    } else {\n      // Sinon, on clique le message pour le fermer\n      o.addEventListener('click', (ev: MouseEvent) => { this.cleanFlash(); });\n    }\n  }\n  public cleanFlash(){ \n    const msgbox = this.messageBox;\n    msgbox.innerHTML = '';\n    msgbox.style.zIndex = '-1';\n  }\n  public cleanFooterShortcuts(){\n    if ( this.footer.querySelector('div#footer-shortcuts')){\n      (this.footer.querySelector('div#footer-shortcuts') as HTMLElement).remove();\n    }\n  }\n\n  public activateContextualHelp() {\n    this.help.activateContextualHelp();\n  }\n  \n  // ========== M\u00C9THODES D'\u00C9L\u00C9MENT =============\n\n  public getSelection(){ return this.accessTable.getSelection() ; }\n\n  /**\n   * Permet de s\u00E9lectionner avec les tabulations les liens se trouvant \n   * dans le texte (d\u00E9finition pour les entr\u00E9es et content pour les\n   * exemples). Pour permettre de faire Tab+Tab+Tab+Entr\u00E9e pour \n   * rejoindre un lien\n   * \n   * On tient \u00E0 jour une table qui permet de conserver l'indice du \n   * lien derni\u00E8rement s\u00E9lectionn\u00E9.\n   * \n   * @param withMaj Pour savoir si la touche est press\u00E9e (pour remonter les liens)\n   * \n   */\n  public nextLinkSelection(withMaj: boolean){\n    const itemId: string | undefined = this.getSelection();\n    if (itemId === undefined) { return ;}\n    const obj = this.accessTable.getObj(itemId);\n    const ak = this.accessTable.getAccKey(itemId);\n    const links = obj.querySelectorAll('a');\n    if (links.length === 0){ return this.flash('Aucun lien dans cet \u00E9l\u00E9ment\u2026', 'notice'); }\n    let nextSelLink = ak.lastSelectedLink || 0;\n    nextSelLink += withMaj ? -1 : +1;\n    if (nextSelLink === -1) { nextSelLink = links.length; } \n    else if (nextSelLink < 0){ nextSelLink = links.length;} // simple s\u00E9curit\u00E9\n    else if (nextSelLink > links.length) { nextSelLink = 1;}\n    // On d\u00E9selectionne \u00E9ventuellement le dernier lien s\u00E9lectionn\u00E9\n    if (ak.lastSelectedLink){ links[ak.lastSelectedLink -1].classList.remove('current');}\n    const link = links[nextSelLink -1]; \n    link.classList.add('current');\n    ak.lastSelectedLink = nextSelLink;\n    this.flash('Presser \"g\" (comme \"go\") pour rejoindre le lien s\u00E9lectionn\u00E9.', 'notice');\n  }\n  \n  /**\n   * Pour activer le lien s\u00E9lectionn\u00E9 (simuler donc un clique de souris)\n   * (note : \u00E7a se fait avec la touche 'g' comme 'go')\n   */\n  activeLinkSelection(){\n    const itemId: string | undefined = this.getSelection();\n    if (itemId === undefined) { return this.flash('Aucune s\u00E9lection => aucun lien \u00E0 activer\u2026', 'notice'); }\n    const obj = this.accessTable.getObj(itemId);\n    const ak = this.accessTable.getAccKey(itemId);\n    const links = obj.querySelectorAll('a');\n    if (links.length === 0){ return this.flash('Aucun lien dans cet \u00E9l\u00E9ment\u2026', 'notice'); }\n    if (!ak.lastSelectedLink){ return this.flash('Aucun lien n\u2019a \u00E9t\u00E9 s\u00E9lectionn\u00E9\u2026', 'warn');}\n    const selLink = ak.lastSelectedLink ;\n    const alink = links[selLink -1];\n    this.onClickALink(alink);\n  }\n\n  // Re\u00E7oit le click de souris sur un lien dans le texte ou peut \u00EAtre directement \n  // appel\u00E9e pour simuler ce clic.\n  public onClickALink(alink: HTMLElement, ev: KeyboardEvent | undefined = undefined) {\n    console.log(\"Link cliqu\u00E9 depuis texte format\u00E9\", ev);\n    const method: string = String(alink.dataset.method);\n    const id: string = String(alink.dataset.id);\n    (this as any)[method](id);\n\n    ev && stopEvent(ev);\n  }\n\n\n  /**\n   * \n   * M\u00E9thode s\u00E9lectionnant un \u00E9l\u00E9ment. L'op\u00E9ration est complexe car\n   * elle met non seulement en forme l'\u00E9l\u00E9ment dans le DOM, mais elle\n   * conserve en plus l'\u00E9tat de l'\u00E9l\u00E9ment dans l'accessTable et g\u00E8re\n   * la s\u00E9lection (s\u00E9lection qui le moment est simple).\n   */\n  select(itemId: string) {\n    this.accessTable.selectionManager.selectItem(itemId);\n  }\n\n  // Scroll jusqu'\u00E0 l'\u00E9l\u00E9ment et le s\u00E9lectionne\n  scrollToAndSelect(itemId: string){\n    const klass = this._klass;\n    const item = klass.get(itemId);\n    if ( ! item ) { return ; }\n    klass.isVisible(itemId) || klass.setVisible(itemId) ; \n    const ak = klass.getAccKey(itemId) ;\n    this.select(itemId);\n  }\n  public scrollTo(obj: HTMLElement | string) {\n    if ('string' === typeof obj){ obj = this._klass.getObj(obj); }\n    obj.scrollIntoView({behavior: 'auto', block: 'center'});\n  }\n\n  // Pour cr\u00E9er le nouvel \u00E9l\u00E9ment \n  public insertInDom(item: T, before: T | undefined) {\n    const clone = this.cloneItemTemplate() as DocumentFragment;\n    const mainElement = clone.querySelector('.' + this.minName);\n    if (mainElement) {\n      mainElement.setAttribute('data-id', item.id);\n    }\n    // Et on l'ajoute au conteneur\n    if (before) {\n      let beforeObj = this.accessTable.getObj(before.id);\n      if (this.minName === 'exemple') { beforeObj = (beforeObj.previousSibling as HTMLDivElement); }\n      this.container.insertBefore(clone, beforeObj);\n    } else {\n      this.container.appendChild(clone);\n    }\n    // On actualise ou on renseigne ses valeurs\n    this.updateInDom(item);\n  }\n\n  // Pour actualiser les valeurs dans le DOM\n  public updateInDom(item: T): boolean {\n    const obj = this.accessTable.getObj(item.id); // || throwError('item-obj-unfound');\n    if (!obj){\n      this.flash(`Impossible de trouver l'objet DOM de ${item.id}\u2026 Je ne peux pas actualiser l'affichage.`, 'error');\n      return false;\n    }\n    // R\u00E9gler les props\n    // (maintenant, elles peuvent se trouver dans dbData, qui \n    // contient les donn\u00E9es persistantes, ou dans cachedData, qui\n    // contient les donn\u00E9es format\u00E9es)\n    Object.keys(item.dbData).forEach((prop: string) => {\n      let value = ((item.dbData as unknown) as Record<string, string>)[prop] as string;\n      // console.log(\"Actualisation de prop '%s' avec valeur '%s'\", prop, value);\n      this.setPropValue(obj, item, prop, value);\n    });\n    Object.keys(item.cachedData).forEach((prop: string) => {\n      let value = ((item.cachedData as unknown) as Record<string, string>)[prop] as string;\n      this.setPropValue(obj, item, prop, value);\n    });\n    return true;\n  }\n\n  // Pour peupler le panneau\n  public populate(accessTable: AccessTable<any>): void {\n    const container = this.container;\n    container.innerHTML = '';\n    accessTable.each((item: AnyItemType) => { this.insertInDom(item as T, undefined); });\n\n    // Pour op\u00E9rer apr\u00E8s le peuplement du panneau. Par exemple, pour \n    // les exemples, on va ajouter les titres des \u0153uvres.\n    this.afterDisplayItems(accessTable);\n\n    // Pour observer le panneau (les boutons, le champ de filtre, etc.)\n    this.observePanel();\n  }\n\n  private setPropValue(obj: HTMLElement, item: Record<string, any>, prop: string, value: string | number) {\n    // value = String(value);\n    value = this.formateProp(item, prop, value);\n    obj\n      .querySelectorAll(`[data-prop=\"${prop}\"]`)\n      .forEach(element => {\n        if (value.startsWith('<')) {\n          element.innerHTML = value;\n        } else {\n          element.textContent = value;\n        }\n      });\n  }\n\n  // ========== PRIVATE METHODS ==============\n\n  // Pour conserver les s\u00E9lections pr\u00E9c\u00E9dentes et y revenir\n  private previousSelections: string[] = [];\n\n  // Pour la propri\u00E9t\u00E9 public keyManager\n  initKeyManager() {\n    this._keyManager = new VimLikeManager(document.body as HTMLBodyElement, this, this._klass);\n  }\n\n  private cloneItemTemplate(): DocumentFragment {\n    return this.itemTemplate.content.cloneNode(true) as DocumentFragment;\n  }\n  // M\u00E9thode \u00E0 surclasser pour traitement particulier de certaines valeurs\n  // \u00E0 afficher. Mais normalement, elles sont surtout trait\u00E9es lors de la\n  // mise en cache\n  /* surclassed */ protected formateProp(item: any, prop: string, value: string | number | boolean) { return String(value); }\n  /* surclassed */protected afterDisplayItems(accessTable: AccessTable<any>):void {}\n  /* surclassed */ protected searchMatchingItems(searched: string): T[] { return []; }\n  protected observePanel(): void {\n    // \u00C9couter le champ de filtre\n    const field = this.searchInput;\n    field.addEventListener('input', this.filterItems.bind(this));\n    field.addEventListener('keyup', this.filterItems.bind(this));\n  };\n  // M\u00E9thode g\u00E9n\u00E9rique de filtrage des items du panneau\n\n  /**\n   *  M\u00E9thode de filtrage des \u00E9l\u00E9ments affich\u00E9s.\n   */\n  private filterItems(ev: Event ) {\n    // On supprime toujours la s\u00E9lection courante pour\n    // pouvoir chercher \u00E0 partir du premier visible\n    const selectedItemId = this.getSelection();\n    this.accessTable.selectionManager.deselectCurrent();\n    const searched = this.searchInput.value.trim();\n    const matchingItems: T[] = this.searchMatchingItems(searched);\n    const matchingCount = matchingItems.length;\n    console.log('[CLIENT %s] Filtrage %s - %i founds / %i \u00E9l\u00E9ment', this.titName, searched, matchingCount, this.accessTable.size);\n    const matchingIds = new Set(matchingItems.map((item: T) => item.id));\n    // Avant, on bouclait sur les items (dans accessTable). Mais maintenant,\n    // l'\u00E9tat des \u00E9l\u00E9ments n'\u00E9tant pas consign\u00E9 dans leur item, on boucle\n    // sur leur 'accKey'\n    this.accessTable.eachAccKey((ak: AccedableItem) => {\n      const visible = matchingIds.has(ak.id);\n      const display = visible ? 'block' : 'none';\n      if ( ak.display !== display ) {\n        // Pour le moment, on prend le parti de ne d\u00E9finir l'obj qu'au besoin,\n        // plut\u00F4t que de faire une boucle pour tous les traiter.\n        if (ak.obj === undefined) { ak.obj = this.accessTable.DOMElementOf(ak.id); }\n        ak.obj.style.display = display;\n        ak.display = display ;\n        ak.visible = visible; \n      }\n    });\n    // Si l'item qui \u00E9tait s\u00E9lectionn\u00E9 est toujours visible, on le\n    // res\u00E9lectionne. \n    if (selectedItemId) {\n      const selectedAK: AccedableItem = this.accessTable.getAccKey(selectedItemId);\n      if ( selectedAK.visible === true ) {\n        this.accessTable.selectionManager.reselectItem(selectedItemId);\n      }\n    }\n  }\n\n  /**\n   *  M\u00E9thode fonctionnelle pour retourner une liste d'items filtr\u00E9s\n   * \n   * Note : Cette fonction n'a rien \u00E0 voir avec la m\u00E9thode qui filtre\n   * les items \u00E0 l'affichage (cf. ci-dessus).\n   */\n  filter(accessTable: AccessTable<any>, fnFiltre: (item: AnyItemType) => boolean): AnyItemType[] {\n    return accessTable.findAll(\n      (item: AnyItemType) => { return fnFiltre(item); },\n      {}\n    );\n  }\n\n  // ========== PRIVATE PROPERTIES ===========\n  protected get container(){ return this._container || (this._container = document.querySelector('main#items') as HTMLDivElement);}\n  private get itemTemplate(){ return this._itemTemplate || (this._itemTemplate = document.querySelector('template#item-template') as HTMLTemplateElement);}\n  private get searchInput(){ return this._searchInput || (this._searchInput = document.querySelector('input#search-input') as HTMLInputElement);}\n  public get consoleInput(){return this._consInput || (this._consInput = document.querySelector('input#panel-console') as HTMLInputElement);}\n  private get messageBox(){ return document.querySelector('div#message') as HTMLDivElement;}\n  private get footer(){return document.querySelector('footer') as HTMLElement; }\n  private get help(){return this._help || (this._help = new Help(this));}\n\n  public minName:string;\n  public titName: string;\n  private _klass: typeof Entry | typeof Oeuvre | typeof Exemple;\n  public get accessTable(): AccessTable<any> { return {} as AccessTable<any>; };\n  private _actif: boolean = false;\n  private _container!: HTMLDivElement;\n  private _itemTemplate!: HTMLTemplateElement;\n  private _searchInput!: HTMLInputElement;\n  private _consInput!: HTMLInputElement;\n  protected _keyManager!: VimLikeManager;\n  private consoleManager!: any; // type ConsoleManager\n  private _help!: Help;\n  \n  constructor(data: PanelConstructorData) {\n    this.minName = data.minName;\n    this.titName = data.titName;\n    this._klass = data.klass;\n    this.form = data.form;\n  }\n\n  private setPanelFocus(actif: boolean) {\n    // console.log(\"[setPanelFocus] Focus mis sur le panneau %s\", this.titName);\n    document.body.classList[actif ?'add':'remove']('actif');\n    this._actif = actif ;\n    this.keyManager.setMode('normal');\n  }\n}", "/**\n * Grande classe qui permet de parcourir tr\u00E8s vite les \u00E9l\u00E9ments en\n * sachant s'ils sont visibles, s\u00E9lectionn\u00E9s, etc.\n */\nimport { StringNormalizer } from \"../../bothside/StringUtils\";\nimport { EntryType, OeuvreType, ExempleType, AnyItemType } from \"../../bothside/types\";\nimport { PanelClient } from \"../PanelClient\";\nimport { SelectionManager } from \"./SelectionManager\";\n\n/**\n * Le type propre aux donn\u00E9es enregistr\u00E9es dans les AccessTables de chaque \u00E9l\u00E9ment.\n */\nexport interface AccedableItem {\n  readonly type: 'accedable-item';\n  id: string;         // Identifiant absolu de l'\u00E9l\u00E9ment, quel qu'il soit\n  index: number;      // Index pr\u00E9cis dans l'Array\n  obj: HTMLDivElement | undefined ;        // L'objet HTML de l'\u00E9l\u00E9ment, dans le listing\n  next:  string | undefined ;      // Id de l'\u00E9l\u00E9ment suivant dans l'Array (pas forc\u00E9ment contigu)\n  prev:  string | undefined ;      // Id de l'\u00E9l\u00E9ment pr\u00E9c\u00E9dent dans l'Array (idem)\n  visible: boolean;   // Pour savoir si l'\u00E9l\u00E9ment est visible\n  display: 'block' | 'none';  // Le display actuel de l'\u00E9l\u00E9ment\n  selected: boolean;  // Pour savoir si l'\u00E9l\u00E9ment est s\u00E9lectionn\u00E9\n  modified: boolean;  // Pour savoir si l'item a \u00E9t\u00E9 modifi\u00E9\n  lastSelectedLink?: number | undefined; // L'indice 1-start du dernier lien s\u00E9lectionn\u00E9 dans la d\u00E9finition ou le content de l'exemple (pour s\u00E9lection avec Tab)\n // On pourra ajouter ici d'autres donn\u00E9es volatiles\n}\n\nexport class AccessTable<T extends EntryType | OeuvreType | ExempleType> {\n  // Table des pointeurs de donn\u00E9es\n  keysMap: Map<string, AccedableItem> = new Map();\n  // Table de toutes les donn\u00E9es des items, dans un ordre\n  // d'arriv\u00E9e jamais chang\u00E9.\n  arrayItems: T[] = [];\n  // Table de la table (pour v\u00E9rification)\n  _size!: number | null ;\n  // Le premier item, qui doit forc\u00E9ment \u00EAtre le premier charg\u00E9\n  _firstItem!: T;\n  public get firstItem(){ return this._firstItem || (this._firstItem = this.arrayItems[0]); }\n\n  getSelection() { return this.selectionManager.getCurrent(); }\n \n  constructor(\n    public panel: PanelClient<T>,\n    items: T[]\n  ) {\n    this.populateInTable(items);\n  }\n\n  public get selectionManager(){\n    return this._selmanager || (this._selmanager = new SelectionManager(this));\n  }\n  private _selmanager!: SelectionManager;\n  \n  // apr\u00E8s un ajout ou une suppression, par exemple\n  reset(){\n    this._size = null;\n  }\n\n  /**\n   * La fonction g\u00E8re l'\u00E9tat DOM de l'\u00E9l\u00E9ment s\u00E9lectionn\u00E9 ou d\u00E9selectionn\u00E9,\n   * \u00E0 savoir :\n   * - la classe 'selected' de son objet DOM\n   * - la propri\u00E9t\u00E9 @selected de son accKey\n   * \n   * @param id Identifiant de l'\u00E9l\u00E9ment (AnyItemType)\n   * @param state Son nouvel \u00E9tat (true = s\u00E9lectionn\u00E9, false = d\u00E9s\u00E9lectionn\u00E9)\n   */\n  setSelectState(id: string, state: boolean) {\n    // console.log(\"[setSelectState\u00B0 Mettre l'\u00E9tat de l'item '%s' \u00E0 %s\", id, state ? 'true' :'false');\n    const itemAK = this.getAccKey(id);\n    const obj = itemAK.obj || this.getObj(id); // Le d\u00E9finit s'il n'existe pas\n    itemAK.selected = state;\n    obj.classList[state?'add':'remove']('selected');\n  }\n\n  get size(){ return this._size || (this._size = this.keysMap.size);}\n\n  isVisible(id: string) { return this.getAccKey(id).visible === true ;}\n  setVisibility(id: string, state: boolean) {\n    const ak = this.getAccKey(id);\n    if ( ak.visible !== state ) {\n      // <= L'\u00E9tat change => Il faut le changer dans la donn\u00E9e et le DOM\n      ak.visible = state;\n      if ( ak.obj === undefined ) { ak.obj = this.DOMElementOf(id) ; }\n      const display = state ? 'block' : 'none';\n      ak.display = display ;\n      ak.obj.style.display = display ;\n    }\n  }\n\n  // Retourne le premier \u00E9l\u00E9ment visible\n  getFirstVisible(): T | undefined {\n    return this.find((item: T) => this.getAccKey(item.id).visible === true);\n  }\n\n  getNextVisible(refId: string): T | undefined {\n    let ak: AccedableItem | undefined;\n    while (ak = this.getNextAccKey(refId)) {\n      if (ak.visible) {return this.get(ak.id);}\n    }\n  }\n  getPrevVisible(refId: string): AnyItemType | undefined {\n    let ak: AccedableItem | undefined;\n    while (ak = this.getPrevAccKey(refId)) {\n      if (ak.visible) {return this.get(ak.id);}\n    }\n  }\n  \n  // @return true si l'\u00E9l\u00E9ment d'identifiant +id+ existe.\n  exists(id: string): boolean { return this.keysMap.has(id); }\n\n  get(id: string): T { return this.arrayItems[(this.keysMap.get(id) as AccedableItem).index]; }\n  getByAccKey(ak: AccedableItem): T { return this.get(ak.id); }\n\n  /**\n   * Retourne l'objet DOM de l'item en s'assurant qu'il est d\u00E9fini\n   * dans l'AccKey (ce qui n'est pas fait par d\u00E9faut)\n   */\n  getObj(id: string): HTMLDivElement {\n    const ak = this.getAccKey(id);\n    if ( ! ak ) {\n      console.error(\"Impossible d'obtenir l'AK de l'id '%s'\u2026\", id, this.arrayItems);\n    }\n    ak.obj || Object.assign(ak, { obj: this.DOMElementOf(id)});\n    if ( ! ak.obj ) {\n      console.error(\"Impossible d'obtenir l'objet de l'item '%'\u2026\", id);\n    }\n    return ak.obj as HTMLDivElement;\n  }\n  \n  getAccKey(itemId: string): AccedableItem { return this.keysMap.get(itemId) as AccedableItem ; }\n\n  /**\n   * Actualise ou Cr\u00E9e le nouvel item Item apr\u00E8s son enregistrement.\n   * \n   * Pour savoir si c'est une cr\u00E9ation ou une actualisation, il\n   * suffit de voir si l'identifiant est connu de la table (noter\n   * que pour les exemples, il n'y a pas d'identifiant autre que\n   * volatile).\n   * \n   * Noter que ce sont toujours les donn\u00E9es compol\u00E8tes qui sont\n   * remont\u00E9es, m\u00EAme pour une actualisation. Car l'actualisation\n   * a pu modifier des donn\u00E9es qui servent pour le tri, le formatage,\n   * etc.\n   * \n   * @returns [<item>, <next item>] Pour soit updater les donn\u00E9es pour une\n   * update soit ins\u00E9rer le nouvel \u00E9l\u00E9ment dans le DOM pour une cr\u00E9ation\n   * Note : c'est le panneau qui s'en charge.\n   */\n  public upsert(item: AnyItemType): [T, T | undefined] {\n    // console.log(\"Item re\u00E7u par upsert\", item);\n    const checkedId: string = item.id; \n    let cachedItem;\n    if ( this.exists(checkedId)) {\n      // Update\n      const accKey: AccedableItem = this.getAccKey(checkedId);\n      // console.log(\"Ancienne valeur de l'\u0153uvre\", structuredClone(this.arrayItems[accKey.index]));\n      this.arrayItems[accKey.index] = item as T;\n      // console.log(\"Nouvelle valeur de l'\u0153uvre\", this.arrayItems[accKey.index]);\n      // Pour l'update dans le DOM\n      return [item as T, undefined];\n    } else {\n      // Create\n      // (retour) Pour l'affichage des informations\n      return this.createNewAccedableItem(item as T);\n    }\n  }\n\n  private createNewAccedableItem(newItem: T): [T, T | undefined] {\n    // On cherche sa place en fonction de son identifiant\n    let nextItem: T | undefined = this.find((compItem: T) => { return compItem.id > newItem.id; });\n    // console.log(\"Item apr\u00E8s\", nextItem);\n    let nextItemId: string | undefined, prevItemId: string | undefined, prevItem: T | undefined;\n    let nextAccKey: AccedableItem | undefined;\n    if (nextItem)  {\n      nextItemId = nextItem.id;\n      nextAccKey = this.getAccKey(nextItemId);\n      const prevAccKey: AccedableItem = this.getAccKey(nextAccKey.prev as string);\n      prevItemId = nextAccKey.prev;\n      if (prevItemId) {\n        // Un \u00E9l\u00E9ment pr\u00E9c\u00E9dent existait, il faut d\u00E9crocher le pr\u00E9c\u00E9dent\n        // et le suivant pour ins\u00E9rer le nouvel item\n        Object.assign(prevAccKey, {next: newItem.id});\n        Object.assign(nextAccKey, {prev: newItem.id});\n        // console.log(\"Item avant le nouveau\", this.get(prevItemId), prevAccKey);\n      }\n    }\n    const arrayIndex = this.arrayItems.length; // car l'item n'a pas encore \u00E9t\u00E9 ins\u00E9r\u00E9\n    const newAccKey: AccedableItem = this.addInTable(newItem, arrayIndex, nextItemId, prevItemId); \n    // console.log(\"Item nouveau\", newItem, newAccKey);\n    // console.log(\"Item apr\u00E8s le nouveau\", nextItem, nextAccKey);\n    // TODO il faut l'ajouter dans le DOM\n    return [newItem, nextItem];\n  }\n  \n  getNextItem(id: string): T | undefined {\n    const nextAK = this.getNextAccKey(id);\n    return nextAK ? this.get(nextAK.id) : undefined ;\n  }\n  \n  getNextItemByAccKey(ak: AccedableItem) : T | undefined {\n    return ak.next ? this.get(ak.next) : undefined ;\n  }\n\n getPrevItem(id: string): T | undefined {\n    const prevAK = this.getPrevAccKey(id);\n    return prevAK ? this.get(prevAK.id) : undefined ;\n  }\n  getPrevItemByAccKey(ak: AccedableItem) : T | undefined {\n    return ak.prev ? this.get(ak.prev) : undefined ;\n  }\n  \n getNextAccKey(id: string): AccedableItem | undefined {\n    const ak = this.getAccKey(id);\n    return ak.next ? this.getAccKey(ak.next) : undefined;\n  }\n getNextAccKeyByAccKey(ak: AccedableItem): AccedableItem | undefined {\n    return ak.next ? this.getNextAccKey(ak.next) : undefined ;\n  }\n \n getPrevAccKey(id: string): AccedableItem | undefined {\n    const ak = this.getAccKey(id);\n    return ak.prev ? this.getAccKey(ak.prev) : undefined;\n  }\n getPrevAccKeyByAccKey(ak: AccedableItem): AccedableItem | undefined {\n    return ak.prev ? this.getPrevAccKey(ak.prev) : undefined ;\n  }\n\n\n  // Boucle sur tous les \u00E9l\u00E9ments (sans retour)\n  each(traverseMethod: (item: T) => void){\n    this.eachSince(traverseMethod, this.firstItem.id);\n  }\n\n  // Boucle depuis l'\u00E9l\u00E9ment d'identifiant +id+\n  eachSince(\n    traverseMethod: (item: T) => any,\n    id: string \n  ){\n    let item: T | undefined = this.get(id);\n    do {\n      if ( item ) {\n        traverseMethod(item);\n        item = this.getNextItem(item.id);\n      } else { break ;}\n    } while ( item ); \n  }\n\n  /**\n   * Boucle sur toutes les AcceedableItem (AccKey/ak)\n   */\n  eachAccKey(fnEach: (ak: AccedableItem) => void ) {\n    this.keysMap.forEach(fnEach);\n  }\n\n  /**\n   * Boucle sur tous les items \u00E0 partir de l'item d'id +id+ en\n   * collectant une donn\u00E9e quelconque.\n   */\n  mapSince(\n    traverseMethod: (item: T) => any,\n    id: string \n  ): any[] {\n    const collected = [];\n    let item: T | undefined = this.get(id);\n    do {\n      if ( item ) {\n        let retour: any = traverseMethod(item);\n        collected.push(retour);\n        item = this.getNextItem(item.id);\n      } else { break ;}\n    } while ( item );\n    return collected;\n  }\n  // Boucle sur TOUTES les donn\u00E9es en collectant une donn\u00E9e\n  map(\n    traverseMethod: (item: T) => any\n  ): any[] {\n    return this.mapSince(traverseMethod, this.firstItem.id);\n  }\n\n  /**\n   * M\u00E9thode qui boucle sur tous les \u00E9l\u00E9ments depuis l'\u00E9l\u00E9ment d'id\n   * +itemId+ et retourne une Map avec en cl\u00E9 l'identifiant de\n   * l'item et en valeur la valeur retourn\u00E9e par la m\u00E9thode\n   * +traverseMethod+\n   */\n  collectSince(\n    traverseMethod: (item: T) => any,\n    itemId: string \n  ): Map<string, any> {\n    const collected: Map<string, any> = new Map() ;\n    let item: T | undefined = this.get(itemId);\n    do {\n      if ( item ) {\n        let retour: any = traverseMethod(item);\n        collected.set(item.id, retour);\n        item = this.getNextItem(item.id);\n      } else { break ;}\n    } while ( item );\n    return collected;\n  }\n  // Boucle sur tous les \u00E9l\u00E9ments en r\u00E9coltant une valeur qu'on met\n  // dans une Map qui a en cl\u00E9 l'identifiant de l'item\n  collect(traverseMethod: (item: T) => any): Map<string, any> {\n    return this.collectSince(traverseMethod, this.firstItem.id);\n  }\n \n /**\n  * Boucle sur les items, depuis l'item d'identifiant +id+ ou depuis le premier et \n  * retourne le premier qui r\u00E9pond \u00E0 la condition +condition+\n  */ \n  find(\n    condition: (item: T) => boolean, \n  ): T | undefined {\n    return this.findAfter(condition, undefined);\n  }\n  \n  findAfter(\n    condition: (item: T) => boolean,\n    id: string | undefined\n  ): T | undefined {\n    let item: T | undefined ;\n    if ( id === undefined ) {\n      item = this.firstItem ;\n    } else {\n      item = this.getNextItem(id);\n    }\n    let found: T | undefined ;\n    do {\n      if ( item ) {\n        if (condition(item) === true ) { \n          found = item;\n          break ;\n        }\n        item = this.getNextItem(item.id);\n      }\n    } while ( item ); \n    return found ; \n  }\n  \n  /**\n   * Recherche dans l'ordre tous les \u00E9l\u00E9ments r\u00E9pondant \u00E0 la condition +condition+\n   * \n   * @param condition Methode qui doit retourner true pour que l'item soit retenu\n   * @param options   Table d'options {count: nombre attendu} \n   * @returns \n   */\n  findAll(condition: (item: T) => boolean, options: {[k:string]: any}){\n    return this.findAllAfter(condition, undefined, options);\n  }\n\n  // Idem que pr\u00E9c\u00E9dente mais permet de sp\u00E9cifier le premier \u00E9l\u00E9ment\n  findAllAfter(\n    condition: (item: T) => boolean,\n    id: string | undefined,\n    options: {[k:string]: any}\n  ) {\n    const collected: T[] = [];\n    let collected_count = 0;\n\n    let item: T | undefined ;\n    if ( id === undefined ) {\n      item = this.firstItem;\n    } else {\n      item = this.getNextItem(id);\n    }\n    do {\n      if ( item ) {\n        if (condition(item) === true ) { \n          collected.push(item);\n          collected_count ++ ;\n          if ( options.count && collected_count === options.count) { break ;}\n        }\n        item = this.getNextItem(item.id);\n      }\n    } while ( item ); \n    return collected ; \n  }\n\n  /**\n   * Peuplement de la table d'acc\u00E8s avec cr\u00E9ation des 'chainedItem'\n   * \n   * @param items Les \u00E9l\u00E9ments transmis, tels que relev\u00E9s dans les tables (Entry, Oeuvre, Exemple);\n   */\n  // M\u00E9thode qui \"initie\" la table d'acc\u00E8s en transformant chaque\n  // item (Entry, Oeuvre, Exemple) en un AccedableItem, en prenant\n  // son index et son index suivant pour les mettres dans la Map\n  // qui consignes les valeurs d'acc\u00E8s\n  populateInTable(items: T[]) {\n    this.keysMap = new Map();\n    this.arrayItems = [];\n    for (let i: number = 0, len = items.length; i < len; ++i) {\n      const item = items[i];\n      const nextItemId: string | undefined = items[i + 1]?.id || undefined;\n      const prevItemId: string | undefined = items[i - 1]?.id || undefined;\n      this.addInTable(item, i, nextItemId, prevItemId);\n    }\n  }\n\n  // Insertion s\u00E9par\u00E9e pour pouvoir ajouter en cours de travail\n  addInTable(\n    item: T, \n    arrayIndex:number, \n    nextItemId: string | undefined, \n    prevItemId: string | undefined\n  ): AccedableItem {\n    const chained: AccedableItem = {\n      type: 'accedable-item',\n      id: item.id,\n      obj: undefined,\n      index: arrayIndex,\n      next: nextItemId,\n      prev: prevItemId,\n      visible: true,\n      display: 'block',\n      selected: false,\n      modified: false\n    };\n     // console.log(\"[POPULATE ACCESSTABLE] ak = \", chained);\n    this.keysMap.set(item.id, chained);\n    this.arrayItems.push(item);\n    return chained;\n  }\n\n  DOMElementOf(id: string) {\n    return document.querySelector(`main#items > div[data-id=\"${id}\"]`) as HTMLDivElement;\n  }\n\n\n  /**\n   * \n   * \n   * ========== FONCTIONS SP\u00C9CIALIS\u00C9ES ==========\n   * \n   * \n   * \n   */\n  private get wordset(){\n    return this._wordset || (this._wordset = this.getListMotsForAutocomplete());\n  }\n  private _wordset?: {key: string, value: string, min: string}[];\n\n  /**\n   * @api\n   * \n   * M\u00E9thode filtrage des mots, pour l'autocompletion\n   * \n   * @param text Le texte recherch\u00E9 dans les entr\u00E9es\n   */\n  public filterWithText(text: string){\n    text = StringNormalizer.rationalize(text);\n    return this.wordset.filter((item: any) => item.min.startsWith(text));\n  }\n\n  /**\n   * Pour l'autocompl\u00E9tion dans le champ d\u00E9finition (et peut-\u00EAtre\n   * exemple, mais plus compliqu\u00E9) on a besoin de la liste des mots\n   * pr\u00E9par\u00E9es\n   * \n   */\n  getListMotsForAutocomplete(){\n    if ( this.firstItem.cachedData.itemType !== 'entry' ) { return [];}\n    /*\n    // Pour des essais simples\n    return [\n      {key: 'abandon', value: 'Abandon'},\n      {key: 'abime', value: 'Ab\u00EEme'},\n      {key: '\u00E7a', value: 'le \u00C7a'},\n      {key: '\u00E9t\u00E9', value: 'L\u2019\u00E9t\u00E9'}, \n      {key: 'eternel', value: \"\u00C9ternel\"}\n    ];\n    //*/\n    return this.map((item) => { \n      return {\n        key: item.id, \n        value: (item as EntryType).dbData.entree,\n        min: (item as EntryType).cachedData.entree_min_ra\n      } ;\n    });\n  }\n}", "export class Constants {\n  static readonly ENTRIES_GENRES: Record<string, string> = {\n    'nm': 'n.m.',\n    'nmp': 'n.m.pl.',\n    'nf': 'n.f.',\n    'np': 'n.pl.',\n    'vb': 'verbe',\n    'adj': 'adj.',\n    'adv': 'adv.',\n    'la': 'loc.adv.'\n  }; \n  static genreNotExists(genre: string): boolean {\n    return !this.ENTRIES_GENRES[genre];\n  }\n  static getGenre(genreId: string): string {\n    return this.ENTRIES_GENRES[genreId] || 'inconnu';\n  }\n\n  /**\n   * Les pr\u00E9fixes/marques qui introduisent des index dans les d\u00E9finitions\n   * principalement. Permet, par exemple dans le check des valeurs des\n   * d\u00E9finitions, de v\u00E9rifier l'existence des mots r\u00E9f\u00E9renc\u00E9s.\n   * \n   * Leur forme canonique est :\n   * \n   *  <mark>(<id entr\u00E9e>) ou <mark>(<texte \u00E9crit>|<id entr\u00E9e>)\n   */\n  static readonly MARK_ENTRIES = {\n    '->': {name: \"Envoi simple\"},\n    'index': {name: 'Simple indexation'},\n    'tt': {name: 'simple terme technique (sans page)'}\n  };\n}", "/**\n * ComplexRpc\n * \n * Cette classe est amen\u00E9e \u00E0 g\u00E9rer des traitements complexes car :\n *  - asynchrone\n *  - en Rpc\n * \n * Il a \u00E9t\u00E9 inaugur\u00E9 pour faire \u00E7a : \n * Au cours du test de l'enregistrement d'une Entr\u00E9e, on doit v\u00E9rifier si toutes les\n * oeuvres cit\u00E9es existent et produire une erreur le cas \u00E9ch\u00E9ant. La m\u00E9thode de\n * check doit en m\u00EAme temps attendre et envoyer une chaine de notifications \n * panneau -> extension -> panneau complexe.\n * \n * Pour g\u00E9rer \u00E7a, on fait une Promise en gardant dans l'instance ComplexRpc (rep\u00E9r\u00E9e\n * par un identifiant)) le 'resolve' pour ne le jouer que lorsque tout est fini.\n * \n * Fonctionnement :\n * \n *    Dans le flux\n *    ------------\n *    const params = {...};\n *    const comp = new ComplexRpc({call: this.maFonctionInitiale.bind(this, params)});\n *    const res = await comp.run();\n * \n *    Quelque part\n *    ------------\n *    maFonctionInitiale(liste: string[], compRpcId: string): void {\n *      // Ici on fait l'appel qu'on doit faire, en transmettant l'identifiant\n *      // Par exemple :\n *      RpcEntry.notify('check-oeuvres', {CRId: compRpcId, oeuvres: liste})\n *    }\n * \n *    // Et dans la fonction finale qui re\u00E7oit le r\u00E9sultat du check\n *    RpcEntry.on('check-oeuvres-resultat', (params) => {\n *      ComplexRpc.resolveRequest(params.CRId, params.resultat);\n *      // Bien s\u00FBr, il faut s'assurer que CRId a bien \u00E9t\u00E9 transmis\n *      // partout, \u00E0 toutes les fonctions\n *    });\n * \n */\n\nexport class ComplexRpc {\n  static requestTable: Map<string, ComplexRpc> = new Map();\n  \n  static addRequest(req: ComplexRpc) {\n    this.requestTable.set(req.id, req);\n  }\n  \n  // \u00C0 appeler \u00E0 la fin, pour r\u00E9soudre\n  static resolveRequest(requestId: string, params: any) {\n    (this.requestTable.get(requestId) as ComplexRpc).resolve(params);\n  }\n\n  public id: string;\n  private call: Function; // Fonction qui va lancer l'appel (re\u00E7oit en DERNIER argument l'identifiant de cette instance \u2014 pour le transmettre)\n  private ok!: Function; // le 'resolve' de new Promise((resolve, reject) => {})\n  private ko!: Function; // le reject de new Promise((resolve,reject) => {})\n\n  constructor(param: {\n    call: Function,\n  }) {\n    this.id = crypto.randomUUID();\n    this.call = param.call;\n    ComplexRpc.addRequest(this);\n  }\n\n  run() { \n    return new Promise( (ok, ko) => {\n      this.ok = ok;\n      this.ko = ko;\n      setTimeout(this.ko.bind(this, 'timeout-20'), 10 * 10000);\n      this.call(this.id);\n    });\n  }\n\n  resolve(params: any){\n    this.ok(params);\n  }\n}", "import { PanelClient } from \"../PanelClient\";\nimport { EntryType, OeuvreType, ExempleType, AnyDbType, AnyItemType, DBEntryType, DBOeuvreType, DBExempleType } from \"../../bothside/types\";\n\n// Type pour la d\u00E9finition d'une propri\u00E9t\u00E9\nexport interface FormProperty {\n  propName: string;\n  type: typeof String | typeof Number | typeof Boolean;\n  required: boolean;\n  no_shortcut?: boolean;\n  fieldType: 'text' | 'select' | 'textarea' | 'checkbox' | 'radio';\n  field?: any; // renseign\u00E9 \u00E0 la v\u00E9rificatiaon\n  values?: string[][];\n  default?: any;\n  locked?: boolean; // si true, le champ est verrouill\u00E9\n  onChange?(): void; // la fonction optionnelle \u00E0 appeler en cas de changement de cette propri\u00E9t\u00E9\n}\n\ntype FieldType = HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n\nexport interface ChangeSetType {\n  [x: string]: any;\n  isNew: boolean;\n  size: number;\n}\n\ninterface EditedEntryType /* pour \"Type de l'item \u00E9dit\u00E9 */ extends DBEntryType {\n  // Pour mettre les changements effectu\u00E9s\n  changeset: ChangeSetType;\n  // Pour mettre les donn\u00E9es initiales de l'item\n  original: DBEntryType;\n  data2save?: DBEntryType;\n}\ninterface EditedOeuvreType extends DBOeuvreType {\n  changeset : ChangeSetType;\n  original: DBOeuvreType;\n  data2save?: DBOeuvreType;\n}\ninterface EditedExempleType extends DBExempleType {\n  changeset: ChangeSetType;\n  original: DBExempleType;\n  data2save?: DBExempleType;\n}\ntype EditedIType = EditedEntryType | EditedOeuvreType | EditedExempleType; \n\n/**\n * Classe pour \u00E9tendre le formulaire de chaque \u00E9l\u00E9ment\n */\n\nexport abstract class FormManager<T extends AnyItemType, Tdb extends AnyDbType> {\n\n  abstract formId: string; // Identifiant unique du formulaire\n  abstract prefix: string; // utilis\u00E9 pour nommer les champs\n  abstract properties: FormProperty[];\n  abstract tableKeys: Record<string, {lab: string, fn: Function}>; // table des raccourcis propres\n  private tablePropertiesByPropName!: Map<string, FormProperty>;\n  abstract afterEdit(): void; // \u00E0 faire apr\u00E8s l'\u00E9dition d'un \u00E9l\u00E9ment\n  abstract onSaveEditedItem(data: Tdb): Promise<boolean>; // Fonction pour sauver (appel\u00E9e quand on sauve la donn\u00E9e)\n  async checkEditedItem(): Promise<string | undefined> { return undefined ; }; // Pour checker les donn\u00E9es \n  onCancel?(): void; // Fonction appel\u00E9e en cas d'annulation\n  abstract observeForm(): void; // fonction d'observation propre du formulaire\n  onFocusForm?(ev: FocusEvent | undefined): any;\n  public panel!: PanelClient<AnyItemType>; // le panneau contenant le formulaire\n  public saving: boolean = false;\n  // Les propri\u00E9t\u00E9s \u00E0 retirer des donn\u00E9es \u00E0 finalement sauver.\n  // Note: les propri\u00E9t\u00E9s isNew et size sont d\u00E9j\u00E0 trait\u00E9es\n  /* surclasser (if any) */ propsToRemove(): string[] {return [];}\n\n  // Pour savoir si une \u00E9dition est en cours\n  // if this.form.isActive()\n  public isActive(){\n    return !this.obj.classList.contains('hidden');\n  }\n \n  // Maintenant c'est celui-ci\n  protected editedItem!: EditedIType;\n  public getEditedItem(){ return this.editedItem;}\n\n  private checked: boolean = false;\n\n  private _obj!: HTMLFormElement; // le formulaire complet\n  get obj(){\n    return this._obj || (this._obj = document.querySelector(`form#${this.formId}`) as HTMLFormElement);\n  }\n\n  // raccourci\n  private setMode(mode: 'form' | 'edit' | 'normal') {\n    this.panel.keyManager.setMode(mode);\n  }\n  /**\n   * @api\n   * Point d'entr\u00E9e de l'\u00E9dition, on envoi l'item \u00E0 \u00E9diter. La manager\n   * affiche ses donn\u00E9es et affiche le formulaire.\n   * \n   * @param item Objet Entry, Oeuvre ou Exemple \u00E0 \u00E9diter/cr\u00E9er\n   */\n  public editItem(item: T): void {\n    // console.log(\"\u00C9dition de l'item\", item);\n    const isNewItem = item.id === '';\n    this.panel.context = isNewItem ? 'create-element' : 'edit-element';\n    const originalData: Tdb = isNewItem ? {} as Tdb : structuredClone(item.dbData) as Tdb;\n    this.editedItem /* EditedIType */ = Object.assign(originalData, {\n      original: structuredClone(originalData),\n      changeset: {size: 0, isNew: isNewItem}\n    }) as any as EditedIType;\n    this.openForm();\n    this.dispatchValues(item);\n    if ( 'function' === typeof this.afterEdit ) { this.afterEdit.call(this); }\n    this.setMode('form');\n  }\n\n  public async saveItem(andQuit: boolean): Promise<void> {\n    const res = await this.itemIsNotSavable();\n    if (res) { return ;}\n    let data2save = structuredClone(this.editedItem.changeset) as any as Tdb;\n    this.editedItem.data2save = data2save;\n    const map = new Map();\n    map.set('o', this.onConfirmSave.bind(this, andQuit));\n    map.set('n', this.cancelEdit.bind(this));\n    this.panel.flashAction(\n      \"<b>\uD83D\uDC4D Donn\u00E9e valid\u00E9e \uD83C\uDF89</b><br />Confirmes-tu la sauvegarde ? (o = oui, n = non)\", map\n    );\n  }\n\n  private async itemIsNotSavable(): Promise<boolean> {\n    this.panel.cleanFlash();\n    this.collectValues(); // maintenant les met dans this.editedItem\n    const item = this.editedItem as Record<string, any>;\n    this.properties.forEach(dproperty => {\n      const prop = dproperty.propName;\n      // console.log(\"Propri\u00E9t\u00E9 '%s' | Original: '%s' | New: '%s'\", prop, item.original[prop], item[prop]);\n      if ( item[prop] !== item.original[prop]) {\n        Object.assign(this.editedItem.changeset, {\n          [prop]: item[prop],\n          size: ++item.changeset.size\n        });\n      }\n    });\n    console.log(\"Item \u00E0 enregistrer\", this.editedItem);\n    if ( this.itemIsEmpty()) {\n      this.panel.flash(\"Aucune donn\u00E9e n'a \u00E9t\u00E9 founie\u2026\", 'error');\n      return true;\n    } \n    if (this.editedItem.changeset.size === 0 ) {\n      this.panel.flash(\"Les donn\u00E9es n'ont pas chang\u00E9\u2026\", 'warn');\n      return true;\n    }\n    let invalidity: string | undefined = await this.checkEditedItem();\n    console.log(\"=== FIN DU CHECK DE L'ITEM ===\");\n    if (invalidity) {\n      this.panel.flash(\"Les donn\u00E9es sont invalides : \" + invalidity, 'error');\n      return true;\n    }\n    return false; // enregistrable\n  }\n\n  /**\n   * M\u00E9thode appel\u00E9e apr\u00E8s confirmation de la sauvegarde.\n   * \n   * Elle finalise la donn\u00E9e finale \u00E0 enregistrer, notamment en \n   * retirant les propri\u00E9t\u00E9s non persistantes.\n   */\n  public async onConfirmSave(andQuit: boolean): Promise<void> {\n    console.log(\"Sauvegarde confirm\u00E9e\");\n    const fakeItem = this.collectValues();\n    // Donn\u00E9es persistantes\n    const data2save: Tdb = structuredClone(this.editedItem.original) as Tdb;\n    Object.assign(data2save, this.editedItem.data2save);\n    // Donn\u00E9es particuli\u00E8res \u00E0 retirer\n    const removedProps = ['isNew','size'];\n    removedProps.push(...this.propsToRemove());\n    console.log(\"Propri\u00E9t\u00E9s \u00E0 remover\", removedProps);\n    const data2saveEpured = {};\n    for(var k in data2save){\n      if (removedProps.includes(k)) { continue; }\n      Object.assign(data2saveEpured, {[k]: data2save[k]});\n    }\n    console.log(\"Donn\u00E9es FINALES \u00E0 sauvegarder\", structuredClone(data2saveEpured));\n    await this.onSaveEditedItem(data2saveEpured as Tdb);\n    this.saving = false;\n    if (andQuit) { this.closeForm(); }\n  }\n\n  private itemIsEmpty(): boolean {\n    var isEmpty = true;\n    const item = this.editedItem as Record<string, any>;\n    this.properties.forEach(dprop => {\n      if (!isEmpty) { return ;}\n      if ( item[dprop.propName] !== '' ) { isEmpty = false; }\n    });\n    return isEmpty;\n  }\n\n  public cancelEdit(): void {\n    console.log(\"Sauvegarde annul\u00E9e\");\n    this.saving = false;\n    this.__onCancel();\n  }\n\n  // Met les donn\u00E9es dans le formulaire\n  dispatchValues(item: T){\n    this.reset();\n    const itemVals = item as {[x: string]: any};\n    this.properties.forEach( dprop => {\n      const prop = dprop.propName;\n      const value = itemVals.dbData && (itemVals.dbData[prop] || itemVals.cachedData[prop]);\n      if ( value ) { \n        // console.log(\"Propri\u00E9t\u00E9 %s mise \u00E0 %s\", prop, data[prop]);\n        this.setValueOf(prop, String(value));\n        // Si le champ doit \u00EAtre verrouill\u00E9\n        if (dprop.locked) { dprop.field.disabled = true; }\n      } else {\n        console.log(\"La valeur de la propri\u00E9t\u00E9 %s n'est pas d\u00E9finie dans \", prop, item);\n      }\n    });\n  }\n\n  // Retourne le champ de la propri\u00E9t\u00E9 +prop+\n  // (note : ces champs ont \u00E9t\u00E9 v\u00E9rifi\u00E9s au d\u00E9but)\n  field(prop: string): FieldType {\n    if ( false === this.domCache.has(prop)) {\n      const sel = `#${this.prefix}-${prop}`;\n      const fld = this.obj.querySelector(sel) as FieldType;\n      fld || console.error(\"Bizarrement, le champ %s est introuvable (%s)\", sel, prop);\n      this.domCache.set(prop, fld);\n    }\n    return this.domCache.get(prop) as FieldType;\n  }\n  domCache: Map<string, HTMLElement> = new Map();\n\n  // R\u00E9cup\u00E8re les donn\u00E9es dans le formulaire et retourne l'item\n  // avec ses nouvelles donn\u00E9es.\n  collectValues() {\n    this.properties.forEach( dprop => {\n      const prop = dprop.propName;\n      const value = this.getValueOf(dprop);\n      Object.assign(this.editedItem, {[prop]: value});\n    });\n  }\n\n  /**\n   * Pendant de la pr\u00E9c\u00E9dente, donne la valeur +value+ \u00E0 la propri\u00E9t\u00E9\n   * +property+\n   */\n  setValueOf(property: string, value: any) {\n    const propData = this.tablePropertiesByPropName.get(property) as FormProperty;\n    switch (propData.fieldType) {\n      case 'checkbox':\n      case 'radio':\n        propData.field.checked = value;\n        break;\n      default:\n        propData.field.value = value;\n    }\n  }\n  /**\n   * Retourne la valeur de la propri\u00E9t\u00E9 +foo+\n   * \n   * @param foo Nom de la propri\u00E9t\u00E9 dont il faut retourne la valeur\n   * @returns Retourne la valeur de la propri\u00E9t\u00E9 en fonction de son type\n   */\n  getValueOf(foo: string | FormProperty): string | number | boolean | null {\n    if ( 'string' === typeof foo ) {\n      return this.getValueOfByPropName(foo);\n    } else {\n      return this.getValueOfByPropData(foo);\n    }\n  }\n\n  getValueOfByPropName(propName: string) {\n    const propData = this.tablePropertiesByPropName.get(propName) as FormProperty;\n    return this.getValueOfByPropData(propData);\n  }\n  getValueOfByPropData(property: FormProperty): string | number | boolean | null {\n    const prop = property.propName;\n    const field = this.field(prop);\n    // R\u00E9cup\u00E9rer la valeur dans le formulaire (en fonction du champ)\n    let value: any = ((ft) => {\n      switch (ft) {\n        case 'checkbox': return (field as HTMLInputElement).checked;\n        case 'radio': return (field as HTMLInputElement).checked;\n        default: return field.value;\n      }\n    })(property.fieldType);\n    // TODO Traiter la valeur en fonction de son type\n    return value ;\n  }\n\n  openForm(){\n    this.checked || this.checkFormManagerValidity();\n    if (this.checked === false) { return; }\n    this.obj.classList.remove('hidden'); \n  }\n  closeForm(){ \n    this.obj.classList.add('hidden'); \n    this.setMode('normal');\n  }\n\n \n  // Tout remettre \u00E0 rien (vider les champs)\n  reset(){\n    this.properties.forEach(dprop => {\n      switch(dprop.fieldType) {\n        case 'checkbox':\n          dprop.field.checked = dprop.default || false;\n          break;\n        case 'textarea':\n          dprop.field.value = '';\n          break;\n        case 'select':\n          dprop.field.selectedIndex = 0;\n          break;\n        default: \n          dprop.field.value = dprop.default || '';\n      }\n    });\n  }\n\n  async __onSaveEditedItem(){\n    return this.saveItem(false);\n  }\n  async __onSaveEditedItemAndQuit(): Promise<void>{\n    await this.saveItem(true);\n  }\n  __onCancel(){\n    this.closeForm();\n  }\n  __onFocusOnForm(ev: FocusEvent | undefined) {\n    if ('function' === typeof this.onFocusForm) { this.onFocusForm.call(this, ev); }\n    (this.panel as PanelClient<AnyItemType>).keyManager.setMode('form');\n  }\n\n  public setPanel(panel: PanelClient<AnyItemType>) {\n    this.panel = panel;\n  }\n  // === M\u00C9THODES DE VALIDATION DES DONN\u00C9ES D'IMPL\u00C9MENTATION ===\n  // (les donn\u00E9es suivantes s'assurent que le formulaire est\n  //  conforme aux attentes)\n  // La m\u00E9thode sert aussi \u00E0 observer les \u00E9l\u00E9ments\n  checkFormManagerValidity(){\n    if ( ! this.obj ) {\n      console.error('Le formulaire form#%s est introuvable.', this.formId);\n      return false;\n    }\n   /**\n     * Check de la conformit\u00E9 des boutons et leurs m\u00E9thodes\n     */\n    if (false === this.checkBoutonsValidity()) { return false; }\n    /**\n     * On inscrit les aides raccourcis clavier dans le footer\n     */\n    this.inscritAideInFooter();\n     /**\n     * Observation des boutons principaux\n     */\n    this.observeButtons();\n    /**\n     * Check de la conformit\u00E9 des propri\u00E9t\u00E9s, on en profite aussi\n     * pour d\u00E9finir des valeurs (container, erreur, etc.)\n     */\n    if ( false === this.checkPropertiesValidity() ) { return false ; }\n\n    // console.info(\"Formulaire %s valide.\", this.formId);\n\n    /**\n     * Observation propre de chaque formulaire (la fonction est \n     * imp\u00E9rativement impl\u00E9ment\u00E9)\n     */\n    this.__observeForm();\n    this.observeForm();\n\n    this.checked = true;\n  }\n  inscritAideInFooter(){\n    let aide = '<shortcut>q</shortcut><span>Renoncer</span><shortcut>s</shortcut><span>Enregistrer</span><shortcut>w</shortcut><span>Enregistrer et finir</span>';\n    (this.obj.querySelector('div#footer') as HTMLElement).innerHTML = aide;\n  }\n  checkBoutonsValidity(): boolean {\n    let ok = true;\n    // Note : les boutons g\u00E9n\u00E9raux (Save, Renoncer, etc. on \u00E9t\u00E9 supprim\u00E9s au profit des raccourcis clavier)\n    return ok;\n  }\n  // Observation du formulaire\n  __observeForm() { \n    // On s\u00E9lectionne toujours le contenu d'un champ (sauf textarea)\n    this.obj.querySelectorAll('text[type=\"text\"]').forEach(o => {\n      o.addEventListener('focus', (ev) => { (o as HTMLInputElement).select(); });\n    });\n\n    // On r\u00E8gle le changement de mode suivant qu'on focusse dans un\n    // champ \u00E9ditable ou qu'on en blure\n    (this.panel as PanelClient<AnyItemType>).keyManager.discrimineFieldsForModeIn(this.obj, {edit: 'edit', normal: 'form'});\n  }\n  \n  focusField(indice: number) {\n    const dproperty = this.properties[indice - 1];\n    let curIndice = 0;\n    let foundProp: FormProperty | undefined = undefined;\n    this.properties.forEach((dprop) => {\n      if (foundProp) {return; /* acc\u00E9l\u00E9rateur\u2026 */}\n      if (dprop.no_shortcut) { return; }\n      curIndice ++;\n      if ( curIndice === indice) { foundProp = dprop; }\n    });\n    if (foundProp) { (foundProp as FormProperty).field.focus(); }\n  }\n\n  // S'il y a un champ d'identifiant, cette fonction permet de le d\u00E9loquer\n  toggleIdLock() {\n    const idField = this.field('id');\n    if (!idField) { return; }\n    let isLocked = idField.dataset.state === 'locked';\n    this.setIdLock(!isLocked);\n  }\n  setIdLock(isLocked: boolean) {\n    const idField = this.field('id');\n    idField.dataset.state = isLocked ? 'locked' : 'unlocked';\n    idField.disabled = isLocked;\n    const btn = this.obj.querySelector('.btn-lock-id');\n    if (btn) { idField.innerHTML = isLocked ? '\uD83D\uDD12' : '\uD83D\uDD13'; }\n  }\n  // Observation des boutons principaux\n  observeButtons(){\n  }\n\n  checkPropertiesValidity(): boolean {\n    let ok = true ;\n    const lettres = 'abcdefghijkl'.split('').reverse();\n    // On va en profiter pour mettre les donn\u00E9es des propri\u00E9t\u00E9s dans\n    // une table pour les r\u00E9cup\u00E9rer facilement\n    this.tablePropertiesByPropName = new Map();\n\n    this.properties.forEach( (dproperty) => {\n      const prop = dproperty.propName;\n      this.tablePropertiesByPropName.set(prop, dproperty);\n      const prefix = this.prefix;\n      const prefprop = `${prefix}-${prop}`;\n      // Chaque propri\u00E9t\u00E9 doit avoir son conteneur de nom '<propName>-container'\n      const container = this.obj.querySelector(`#${prefprop}-container`);\n      if (container) {\n        const label = ((container as HTMLElement).querySelector('label') as HTMLElement);\n        let shortcut: string;\n        if (dproperty.no_shortcut) {\n          shortcut = '';\n        } else {\n          shortcut = '<shortcut>' + lettres.pop() + '</shortcut>\u00A0';\n        }\n        label.innerHTML = shortcut + label.innerHTML;\n        Object.assign(dproperty, { container: container });\n      } else {\n        console.error('La propri\u00E9t\u00E9 \"%s\" devrait \u00EAtre dans un conteneur d\u2019identifiant \"#%s-container\"', prop, prefprop);\n        ok = false;\n      }\n      // Est-ce que chaque propri\u00E9t\u00E9 est bien dans son champ ?\n      let propTag = String(dproperty.fieldType);\n      if ( ['text', 'checkbox', 'radio'].includes(propTag)) { propTag = 'input';}\n      const fieldSelector = `${propTag}#${prefprop}`;\n      let propField = this.obj.querySelector(fieldSelector);\n      if ( propField ) {\n        switch(dproperty.fieldType) {\n          case 'checkbox': propField = propField as HTMLInputElement; break;\n          case 'textarea': propField = propField as HTMLTextAreaElement; break;\n          default: propField = propField as HTMLInputElement;\n        }\n        Object.assign(dproperty, { field: propField });\n\n        /**\n         * S'il faut observer le champ (si par exemple onChange est d\u00E9fini), alors\n         * l'observer\n         */\n        if ( dproperty.onChange ) {\n          propField.addEventListener('change', dproperty.onChange);\n        }\n\n      } else {\n        console.error('Le champ %s pour la propri\u00E9t\u00E9 %s devrait exister.', fieldSelector, prop);\n        ok = false;\n      }\n      // Un champ select doit avoir des valeurs\n      // Et on en profite pour les mettre\n      if ( dproperty.fieldType === 'select' ) {\n        if ( dproperty.values ) {\n          const field = dproperty.field;\n          field.innerHTML = '';\n          dproperty.values.forEach( paire => {\n            let [value, title] = paire;\n            title = title || value;\n            const opt = document.createElement('option');\n            opt.value = value;\n            opt.innerHTML = title;\n            field.appendChild(opt);\n          });\n        } else {\n          console.error('Le champ %s, de type select, devrait d\u00E9finir ses valeurs (values)', prop);\n          ok = false;\n        }\n      }\n      \n\n    });\n    \n    return ok;\n  }\n}", "import { AnyItemType, DBEntryType, EntryType } from '../../bothside/types';\nimport { StringNormalizer } from '../../bothside/StringUtils';\nimport { Constants } from '../../bothside/UConstants';\nimport { ComplexRpc } from '../services/ComplexRpc';\nimport { ChangeSetType, FormManager, FormProperty } from \"../services/FormManager\";\nimport { Entry, RpcEntry } from \"./Entry\";\n\nconst allg: {[x: string]: string} = Constants.ENTRIES_GENRES;\nconst genres = Object.keys(allg).map( key => [key, allg[key]] );\n\nexport class EntryForm extends FormManager<EntryType, DBEntryType> {\n  formId = 'entry-form';\n  prefix = 'entry';\n  properties: FormProperty[] = [\n    {propName: 'entree', type: String, required: true, fieldType: 'text', onChange: this.onChangeEntree.bind(this)},\n    {propName: 'id', type: String, required: true, fieldType: 'text'},\n    {propName: 'genre', type: String, required: true, fieldType: 'select', values: genres},\n    {propName: 'categorie_id', type: String, required: false, fieldType: 'text'},\n    {propName: 'definition', type: String, required: false, fieldType: 'textarea'}\n  ];\n  // Table des raccourcis 'one key' propre au formulaire\n  tableKeys = {\n    // <touche>: {lab: 'label pour info', fn: <fonction bind\u00E9e>}, par exemple\n    // 'i': {lab: 'obtenir des infos', fn: this.showInfo.bind(this)}\n  };\n\n  static readonly REG_SHORT_DEF = /\\b(cf\\.|voir|synonyme|contraire)\\b/;\n  static readonly REGEX_APPELS_ENTRIES = new RegExp(`(?:${Object.keys(Constants.MARK_ENTRIES).join('|')})\\\\(([^)]+)\\\\)`, \"g\");\n  static readonly REG_OEUVRES = /\\boeuvre\\(([^)]+)\\)/g;\n  \n  onChangeEntree() {\n    // console.log(\"Le champ Entr\u00E9e a chang\u00E9\");\n    const itemIsNew = this.getValueOf('id') === '';\n    if ( itemIsNew ) {\n      let proposId = this.getValueOf('entree') as string;\n      if ( proposId !== '') {\n        proposId = StringNormalizer.rationalize(proposId);\n        this.setValueOf('id', proposId);\n      }\n    }\n  }\n\n  // \u00C0 faire juste apr\u00E8s la mise en \u00E9dition d'une Entr\u00E9e\n  afterEdit(): void {\n    const id = this.getValueOf('id');\n    const isNew = id === '' ;\n    // Pour un nouvel item, il faut d\u00E9bloquer l'identifiant\n    if (isNew) { this.setIdLock(false); }\n    this.panel.context = isNew ? 'create-entry' : 'edit-entry';\n  }\n\n  /**\n   * Grande m\u00E9thode de check de la validit\u00E9 de l'item. On ne l'envoie\n   * en enregistrement que s'il est parfaitement conforme. \n   */\n  async checkEditedItem(): Promise<string | undefined> {\n    const item = this.editedItem;\n    const changeset = item.changeset;\n    const errors: string[] = [];\n\n    // V\u00E9rifications diverses et synchrones sur les donn\u00E9es\n    this.diverseChecks(item.changeset, errors);\n\n    // V\u00E9rification de l'existence des oeuvres dans la\n    // d\u00E9finition\n    if (changeset.definiition !== undefined) {\n      const unknownOeuvres: string[] = await this.checkExistenceOeuvres(changeset.definition);\n      if (unknownOeuvres.length) {\n        errors.push(`des \u0153uvres sont introuvables : ${unknownOeuvres.map(t => `\"${t}\"`).join(', ')}`);\n      }\n\n      // V\u00E9rification (complexe) de l'existence des exemples\n      // d\u00E9finis dans la d\u00E9finition de l'entr\u00E9e\n      const unknownEx: string[] = await this.checkExistenceExemples(changeset.definition);\n      if (unknownEx.length) {\n        errors.push(`des exemples sont introuvables: ${unknownEx.join(', ')}`);\n      }\n    }\n\n    // r\u00E9sultat final retourn\u00E9\n    if (errors.length) {\n      console.error(\"Donn\u00E9es invalides\", errors);\n      return errors.join(', ').toLowerCase();\n    }\n  }\n\n  async checkExistenceOeuvres(definition: string): Promise<string[]> {\n    const checkerOeuvres = new ComplexRpc({\n      call: this.searchUnknownOeuvresIn.bind(this, definition)\n    });\n    let resultat: unknown = await checkerOeuvres.run();\n    const res = (resultat as {known: string[], unknown: string[]});\n    console.log(\"Retour apr\u00E8s checkerOeuvres\", resultat);\n    return res.unknown;\n  }\n\n  diverseChecks(changeset: ChangeSetType, errors: string[]): string[] {\n    \n    if (changeset.entree !== undefined && changeset.entree === '') {\n      // L'entr\u00E9e ne doit pas \u00EAtre vide \n      if (changeset.entree === '') { errors.push(\"L'entr\u00E9e doit \u00EAtre d\u00E9finie\");}\n      // L'entr\u00E9e doit \u00EAtre unique (si elle a chang\u00E9e)\n      if ( Entry.doesEntreeExist(changeset.entree)) { errors.push(`L'entr\u00E9e \"${changeset.entree}\" existe d\u00E9j\u00E0\u2026`); }\n    }\n    if (changeset.id !== undefined) {\n      // L'identifiant ne doit pas \u00EAtre vide\n      if (changeset.id === '') { errors.push(\"L'identifiant doit absoluement \u00EAtre d\u00E9fini\"); }\n      // L'identifiant doit \u00EAtre unique (si nouveau)\n      if (Entry.doesIdExist(changeset.id)) { errors.push(`L'identifiant \"${changeset.id}\" existe d\u00E9j\u00E0. Je ne peux le r\u00E9attribuer`); }\n    }\n    const def: string = changeset.definition;\n    if (def !== undefined) {\n      // La d\u00E9finition ne doit pas \u00EAtre vide \n      def === '' && errors.push(\"La d\u00E9finition du mot doit \u00EAtre donn\u00E9e\");\n      // D\u00E9finition trop courte, sans justifications\n      if (def !== '' && def.length < 50 && null === def.match(EntryForm.REG_SHORT_DEF)) {\n        errors.push(\"La d\u00E9finition est courte, sans justification\u2026\");\n      }\n      const unknownEntries = this.searchUnknownEntriesIn(def);\n      if ( unknownEntries.length > 0) {\n        errors.push(`entr\u00E9es inconnues dans la d\u00E9fintion (${unknownEntries.join(', ')})`);\n      }\n    } else {\n      console.log(\"La d\u00E9finition n'a pas \u00E9t\u00E9 modifi\u00E9e.\");\n    }\n\n    if (changeset.genre !== undefined) {\n      // Le genre doit \u00EAtre donn\u00E9\n      changeset.genre !== '' || errors.push(\"Le genre de l'entr\u00E9e doit \u00EAtre donn\u00E9\");\n      // Le genre doit exister\n      if (Constants.genreNotExists(changeset.genre)) {\n        errors.push(`bizarrement, le genre \"${changeset.genre} est inconnu\u2026`);\n      }\n    }\n    \n    //  Si les cat\u00E9gories sont d\u00E9finies, il faut qu'elles existent\n    // Rappel : Une \"cat\u00E9gorie\", c'est simplement l'ID d'une entr\u00E9e\n    // (c'est la particularit\u00E9 du dictionnaire, mais \u00E7a tombe sous le\n    // sens) \n    if (changeset.categorie_id !== undefined && changeset.categorie_id !== '') {\n      const unknownCategorie = this.checkUnknownCategoriesIn(changeset.categorie_id);\n      if (unknownCategorie.length) {\n        errors.push(`des cat\u00E9gories sont inconnues : ${unknownCategorie.join(', ')}`);\n      }\n    }\n\n    return errors;\n  }\n\n\n  // Pour chercher les entr\u00E9es mentionn\u00E9es dans la d\u00E9finition\n  searchUnknownEntriesIn(str: string): string[] {\n    const founds: string[] = [];\n    const matches = str.matchAll(EntryForm.REGEX_APPELS_ENTRIES);\n    for (const match of matches) {\n      const foo = match[1];\n      let [entry, entryId] = foo.split('|');\n      entryId = (entryId || entry).trim();\n      /**\n       * L'entr\u00E9e peut \u00EAtre d\u00E9sign\u00E9e par de multiples formes :\n       * - son identifiant\n       * - son identifiant pluriel (rare)\n       * - son entr\u00E9e (minuscules)\n       * - son entr\u00E9e plurielle (minuscules)\n       */\n      if ( Entry.doesIdExist(entryId) ) {\n        // console.log(\"Id d'entr\u00E9e existante\", entryId);\n      } else if ( Entry.doesEntreeExist(entryId)) {\n        // console.log(\"Entr\u00E9e existante (par son nom)\", entryId);\n      } else if (entryId.endsWith('s')) {\n        const entryIdSing = entryId.substring(0, entryId.length-1);\n        if ( Entry.doesEntreeExist(entryIdSing)) {\n          // console.log(\"Entr\u00E9e existante (pas son nom singulier)\", entryId);\n        } else if (Entry.doesIdExist(entryIdSing)) {\n          // console.log(\"Id entr\u00E9e existante (dans sa forme singuli\u00E8re)\", entryId);\n        }\n      } else { \n        founds.push(entryId);\n      }\n    }\n    return founds;\n  }\n  \n\n  /**\n   * V\u00E9rifie que les \u0153uvres d\u00E9sign\u00E9es dans les balises oeuvre(...) existent\n   * bel et bien.\n   *\n   * Cette fonction s'int\u00E8gre dans une requ\u00EAte Rpc complexe (ComplexRpc)\n   * \n   * Pour ce faire, on a besoin de passer par l'extension car on n'a pas \n   * acc\u00E8s aux oeuvres depuis ici.\n   * \n   * @param str Dans la phase 1, La d\u00E9finition, dans la phase 2, le json revenant du check\n   * @param phase Pour savoir si on remonte de la v\u00E9rifiation (phase 2)\n   * @returns La liste des \u0153uvres qui n'ont pas \u00E9t\u00E9 trouv\u00E9es\n   */\n  searchUnknownOeuvresIn(str: string, CRId: string): void {\n    // 1. On rel\u00E8ve les oeuvres\n    const matches = str.matchAll(EntryForm.REG_OEUVRES);\n    const oeuvres: string[] = [];\n    for (let match of matches) { oeuvres.push(match[1]); }\n    console.log(\"Oeuvres \u00E0 checker\", oeuvres);\n    // 2. On les envoie \u00E0 la v\u00E9rification\n    RpcEntry.notify('check-oeuvres', { CRId, oeuvres });\n  }\n\n  /**\n   * Fonction principale pour checker les exemples dans la d\u00E9finition\n   * C'est elle qui initie la requ\u00EAte Rpc complexe. \n   */\n  async checkExistenceExemples(definition: string): Promise<string[]> {\n    const comp = new ComplexRpc({\n      call: this.searchUnknownExemplesIn.bind(this, definition)\n    });\n    const resultat = await comp.run();\n    const res = resultat as {known: string[], unknown: string[]};\n    return res.unknown;\n  }\n  /**\n   * Fonction v\u00E9rifiant l'existence des exemples\n   * \n   * Elle s'int\u00E8gre dans la requ\u00EAte Rpc complexe inaugur\u00E9e par la\n   * fonction checkExistenceExemples.\n   * \n   * Rappel : les exemples, dans les d\u00E9finitions, sont d\u00E9finis par\n   * EXEMPLES[<ID oeuvre>:<indice exemple>, <ID oeuvre>:<indice>, etc.]\n   * Il peut y en avoir plusieurs par d\u00E9finition, comme pour la d\u00E9finition des genres.\n   *  \n   * @param str Le texte de la d\u00E9finition\n   * @param CRId L'identifiant de la ComplexRpc qui g\u00E8re toute la communication\n   * \n   * @return Rien, c'est la m\u00E9thode message en bout de chaine qui r\u00E9solvera \n   * la requ\u00EAte Rpc complexe pour poursuivre.\n   */\n  searchUnknownExemplesIn(str: string, CRId: string): void {\n    let matches = str.matchAll(/EXEMPLES\\[([^\\]]+)\\]/g);\n    const exemples: string[][] = [];\n    for (var match of matches) {\n      match[1]\n        .split(',')\n        .map(s => s.trim())\n        .forEach(paire => {\n          const [oeuvreId, exIndice] = paire.split(':');\n          exemples.push([oeuvreId, exIndice]);\n        });\n    }\n    RpcEntry.notify('check-exemples', {CRId, exemples});\n  }\n  \n  // @return la liste des cat\u00E9gories inconnues\n  checkUnknownCategoriesIn(str: string): string[] {\n    const cats = str.split(',').map(s => s.trim());\n    // return cats.filter(Entry.doesIdExist.bind(Entry));\n    return cats.filter(cat => false === Entry.doesIdExist(cat));\n  }\n\n  /**\n   * ENREGISTREMENT DE L'ENTR\u00C9E\n   * -------------------------- \n   * Proc\u00E9dure complexe (ComplexRpc)\n   */\n  async onSaveEditedItem(data2save: DBEntryType): Promise<boolean> {\n    // console.info(\"Item \u00E0 sauvegarder\", this.editedItem);\n    // console.info(\"Donn\u00E9es \u00E0 sauvegarder\", data2save);\n    const itemSaver = new ComplexRpc({\n      call: Entry.saveItem.bind(Entry, data2save)\n    });\n    const res = await itemSaver.run() as {ok: boolean, errors: any, item: DBEntryType, itemPrepared: EntryType};\n    // console.log(\"res dans onSave\", res);\n    if (res.ok) {\n      Entry.panel.flash(\"Entr\u00E9e enregistr\u00E9e avec succ\u00E8s en DB.\", 'notice');\n      let item: AnyItemType, nextItem: AnyItemType | undefined;\n      [item, nextItem] = Entry.accessTable.upsert(res.itemPrepared);\n      if (nextItem /* Cr\u00E9ation d'un nouvel item */) {\n        Entry.panel.insertInDom(item, nextItem);\n      } else {\n        Entry.panel.updateInDom(item);\n      }\n    } else {\n      console.error(\"ERREURS LORS DE L'ENREGISTREMENT DE L'ITEM\", res.errors);\n      Entry.panel.flash('Erreur (enregistrement de l\u2019entr\u00E9e (voir la console', 'error');\n      return false;\n    }\n    return true; // quand \u00E7a a \u00E9t\u00E9 bien enregistr\u00E9\n  }\n\n  /**\n   * Observation propre du formulaire des Entr\u00E9es\n   * \n   */\n  observeForm(): void {\n    // Le bouton pour changer l'ID\n    this.btnLockId.addEventListener('click', this.onLockId.bind(this));\n    // Pour attacher l'autocompl\u00E9tion\n    // this.attachAutocompletion();\n  }\n\n  /*\n  private attachAutocompletion(){\n    // Premi\u00E8re liste de mots\n    const wordset = this.panel.accessTable.getListMotsForAutocomplete();\n    const tribute = new Tribute({\n      trigger: \"tt(\",\n      values: wordset,\n      selectTemplate: function(item: {[x: string]: any}){\n        let mark = item.original.value;\n        if (item.original.value !== item.original.key) { mark += `|${item.original.key}`;}\n        return 'tt(' + mark + ')'; \n      },\n      menuItemTemplate: ((item: any) => {\n        return `${item.original.value} (${item.original.key})`;\n      }),\n      lookup: 'value',\n      fillAttr: 'value',\n      menuItemsLimit: 15,\n      menuShowMinLength: 1,\n      spaceSelectsMatch: true,\n    } as any);\n    \n    tribute.attach(this.field('definition'));\n  }\n  //*/ \n  get btnLockId() { return this.obj.querySelector('button.btn-lock-id') as HTMLButtonElement; }\n\n  onLockId() {\n    this.toggleIdLock(); // m\u00E9thode g\u00E9n\u00E9rique de FormManager\n  }\n}", "import { StringNormalizer } from \"../../bothside/StringUtils\";\nimport { FlashMessageType, PanelClient } from \"../PanelClient\";\n\nexport class TextFormater {\n\n  public static formate(\n    panel: PanelClient<any>,\n    obj: HTMLElement,\n    as: 'definition' | 'exemple'\n  ){\n    const Formater = new TextFormater({panel, obj, as});\n    Formater.formate();\n  }\n  private panel: PanelClient<any>;\n  private obj: HTMLElement;\n  private as: string;\n  constructor(params: {panel: PanelClient<any>, obj: HTMLElement, as: string}){\n      this.panel = params.panel;\n      this.obj = params.obj;\n      this.as = params.as;\n  }\n  // Raccourci\n  private flash(msg: string, type: FlashMessageType){ this.panel.flash(msg, type);}\n\n  public formate(){\n    const rawContent = this.obj.innerText;\n    if ( rawContent.startsWith('<formated>')){\n      this.flash('Ce contenu a d\u00E9j\u00E0 \u00E9t\u00E9 mis en forme\u2026', 'warn');\n      return ;\n    }\n    const formater = this.formaterPerType(this.as) as Function;\n    const formatedText = '<formated>' + formater(this.obj.innerText);\n    this.obj.innerHTML = formatedText;\n\n    // On place les observateurs sur les liens\n    this.obj.querySelectorAll('a').forEach((alink: HTMLElement) => {\n      alink.addEventListener('click', this.panel.onClickALink.bind(this.panel, alink) as any);\n    });\n    this.flash('Contenu mis en forme.', 'notice');\n  }\n\n  private formaterPerType(as: string) {\n    switch(as){\n      case 'definition': return this.formateDefinition.bind(this);\n      case 'exemple': return this.formateExemple.bind(this);\n    }\n  }\n  \n  private REG_EXEMPLES: RegExp = /EXEMPLES\\[([^\\]]+)\\]/g;\n\n  private formateDefinition(content: string): string {\n    return content\n      // Tous les liens vers les d\u00E9finitions\n      .replace(/ttp\\(([^)|]+)(?:\\|([^)]+))?\\)/g, this.replacerEntryLinkWithPage.bind(this, 'tt'))\n      .replace(/tt\\(([^)|]+)(?:\\|([^)]+))?\\)/g, this.replacerEntryLink.bind(this, 'tt'))\n      .replace(/ttw\\(([^)|]+)(?:\\|([^)]+))?\\)/g, this.replacerEntryLink.bind(this, 'no-style'))\n      .replace(/\\-\\>\\(([^)|]+)(?:\\|([^)]+))?\\)/g, this.replacerEntryLink.bind(this, 'arrowed'))\n      // Les diminutifs\n      .replace(/dim\\(([^)]+)\\)/g, this.formateDiminutif.bind(this))\n      // Les exemples\n      .replace(this.REG_EXEMPLES, this.replacerExemples.bind(this))\n      ;\n  }\n  private formateExemple(content: string): string {\n    return content;\n  }\n\n\n  /**\n   * \n   * === M\u00C9THODES DE FORMATAGE ===\n   * \n   * \n   */\n\n  private TABLE_DIMS: Map<string, string> = new Map(); \n\n  private formateDiminutif(_tout:string, term: string): string {\n    term = term.trim();\n    if (this.TABLE_DIMS.has(term)) {\n      return this.TABLE_DIMS.get(term) as string;\n    }\n    const dimi: string = '<em>' + term\n      .split(/([ \\-\u2019])/)\n      .map( (mot: string) => {\n        switch(mot) {\n          case ' ': return ' ';\n          case '-': return '-';\n          case 'de': case 'du': case 'des': case 'la': case 'le': case 'd':\n            return mot;\n          default: \n            return mot.replace(/^(.)[^\u0153aeiouy\u00E9\u00E8\u00EA\u00EB\u00EE\u00EF\u00E0\u00E2\u00F4\u00F9\u00FB\u00FC]*/i, '$1.'); \n        }\n      })\n      .join('') + '</em>';\n      this.TABLE_DIMS.set(term, dimi);\n\n    return dimi;\n  }\n\n  private replacerExemples(_tout: string, exemples_marks: string): string {\n    return 'EXEMPLES\u00A0: ' + exemples_marks\n      .split(',')\n      .map((ex: string) => {\n        let [oeuvreId, exIndice] = ex.trim().split(':');\n        return `<a data-type=\"exemple\" data-id=\"${ex}\" data-method=\"goToExemple\">Exemple n\u00B0${exIndice} de l\u2019\u0153uvre ${oeuvreId}</a>`;\n      })\n      .join(', ');\n  }\n  \n  private replacerEntryLinkWithPage(type: string, tout: string, idOrText: string, id: string|undefined): string {\n    return this.replacerEntryLink(type, tout, idOrText, id) + ' (p. xxx)';\n  }\n\n  private replacerEntryLink(type: string, _tout: string, idOrText: string, id: string | undefined){\n    let defId: string = StringNormalizer.rationalize(String(id || idOrText));\n    // V\u00E9rification de l'existence de la d\u00E9finition\n    if( false === this.idExists(defId)) {\n      if (defId.endsWith('s')){ defId = defId.substring(0, defId.length - 1) as string; }\n    }\n    if (false === this.idExists(defId)){\n      this.flash(\"Identifiant inconnu : \" + defId, 'error');\n      return `[Unknown ID ${idOrText}]` ;\n    }\n\n    const text: string = String(idOrText);\n    return `<a class=\"${type}\" data-id=\"${defId}\" data-method=\"goToDef\">${text}</a>`;\n  }\n\n  idExists(itemId: string): boolean{\n    return this.panel.accessTable.exists(itemId);\n  }\n}", "import { stopEvent } from \"./DomUtils\";\n\n\nexport class AutoComplete {\n  private static autocomp: AutoComplete | undefined ;\n\n  public static start(params: {\n    target: HTMLElement,\n    accessTable: any,\n    balIn: string, balOut: string\n  }){\n    this.autocomp = new AutoComplete(params);\n    this.autocomp.run();\n  }\n  public static removeCurrent() {\n    this.autocomp = undefined;\n  }\n\n  /**\n   * \n   * \n   * ================= INSTANCE ===============\n   * \n   * \n   * \n   */\n\n  private target: HTMLElement;\n  private accessTable: any;\n  private balIn: string;\n  private balOut: string;\n  private finalValue: string = '';\n  private obj!: HTMLDivElement; // le widget\n  private input!: HTMLInputElement; // le champ pour \u00E9crire\n  private menu!: HTMLSelectElement; // La liste pour mettre le filtrage\n  private candidats: {[x: string]: any}[] = [];\n  private candidatsCount: number = 0;\n\n  constructor(\n    params: {\n      target: HTMLElement,\n      accessTable: any,\n      balIn: string,\n      balOut: string\n    }\n  ){\n\n    this.target = params.target;\n    this.accessTable = params.accessTable;\n    this.balIn = params.balIn;\n    this.balOut = params.balOut;\n  }\n\n  run(){\n    // On construit le widget et on l'affiche\n    this.build();\n    // On met les observateurs d'\u00E9v\u00E8nement\n    this.observe();\n    // Et on affiche le d\u00E9part\n    this.initList();\n  }\n  \n  finish(){\n    this.obj.remove();\n    const cible = this.target as HTMLTextAreaElement;\n    console.log(\"cible\", cible);\n    cible.focus();\n    cible.setRangeText(\n      this.balIn + this.finalValue + this.balOut, \n      cible.selectionStart, \n      cible.selectionEnd, \n      'end'\n    );\n    AutoComplete.removeCurrent();\n  }\n\n  private initList() {\n    this.peuple(this.accessTable.filterWithText(''));\n  }\n\n  /**\n   * Fonction pour choisir finalement l'item\n   */\n  private select(){\n    const indice = Number(this.menu.dataset.indice);\n    if (isNaN(indice)) {\n      console.warn(\"Aucun mot n'a \u00E9t\u00E9 s\u00E9lectionn\u00E9.\");\n      return;\n    }\n    const item = this.candidats[indice];\n    const key: string = item.key ;\n    const value: string = item.value.toLowerCase() ; \n    if (key === value) {\n      this.finalValue = key;\n    } else {\n      this.finalValue = `${value}|${key}`;\n    }\n    console.log(\"S\u00E9lection\", key, value);\n    this.finish();\n  }\n  \n  private selectNext(){\n    this.lowlightSelected();\n    let indice = Number(this.menu.dataset.indice || -1);\n    console.log(\"Indice = %i\", indice);\n    indice ++;\n    if (indice > this.candidatsCount) { indice = this.candidatsCount - 1;}\n    this.menu.dataset.indice = String(indice);\n    this.highlightSelected();\n  }\n  private selectPrev(){\n    this.lowlightSelected();\n    let indice = Number(this.menu.dataset.indice || 1) - 1; \n    console.log(\"Indice = %i\", indice);\n    if (indice < 0) { indice = 0; } \n    this.menu.dataset.indice = String(indice);\n    this.highlightSelected();\n  }\n\n  private highlightSelected(){\n    const indice = Number(this.menu.dataset.indice);\n    this.menu.options[indice]?.classList.add('selected');\n  }\n  private lowlightSelected(){\n    const indice = Number(this.menu.dataset.indice);\n    this.menu.options[indice]?.classList.remove('selected');\n  }\n  private selectFirst(){\n    this.menu.dataset.indice = '0';\n    this.highlightSelected();\n  }\n\n  private onInput(ev: KeyboardEvent){\n    ev.stopPropagation();\n    switch(ev.key) {\n      case 'ArrowDown':\n        this.selectNext(); return stopEvent(ev);\n      case 'ArrowUp':\n        this.selectPrev(); return stopEvent(ev);\n      case 'Enter':\n        this.select(); return stopEvent(ev);\n      case 'ArrowLeft':\n      case 'ArrowRight':\n      case 'Tab':\n      case 'Shift':\n        return stopEvent(ev);\n    }\n    const candidats = this.accessTable.filterWithText(this.input.value + ev.key);\n    this.candidats = candidats;\n    this.candidatsCount = candidats.length;\n    this.peuple(candidats);\n    return true;\n  }\n\n  private peuple(candidats: {[x: string]: string}[]) {\n    this.menu.innerHTML = '';\n    candidats.forEach( (candidat: any) => {\n      const option = document.createElement('option');\n      option.value = candidat.key;\n      option.innerHTML = candidat.value;\n      this.menu.appendChild(option);\n    });\n    this.selectFirst();\n  }\n  \n  private observe(){\n    this.input.focus();\n    this.input.addEventListener('keydown', this.onInput.bind(this));\n  }\n\n  private build(){\n    const o = document.createElement('div');\n    this.obj = o;\n    o.className = 'autocompleter';\n    const input = document.createElement('input');\n    o.appendChild(input);\n    input.type = 'text';\n    this.input = input;\n    \n    // Pour mettre la liste des filtr\u00E9s\n    const menu = document.createElement('select');\n    o.appendChild(menu);\n    menu.size = 15;\n    this.menu = menu;\n    \n    document.body.appendChild(o);\n  }\n}", "/**\n * Module pour les Entr\u00E9es\n * \n * Chaque module Entr\u00E9e, Oeuvres et Exemples est compos\u00E9 de trois\n * parties interactives :\n * \n *  1) Le mod\u00E8le, g\u00E9rant les \u00E9l\u00E9ments en tant que tels, les Entry par exemple\n *  2) Le panneau, qui interagit avec le Dom (DOMEntry ou EntryPanel)\n *  3) La section Rpc (RpcEntry) qui permet de communiquer avec l'extension,\n *     pour enregistrer des informations ou obtenir des donn\u00E9es des autres\n *     panneaux.\n */\nimport { StringNormalizer } from '../../bothside/StringUtils';\nimport { ClientItem } from '../ClientItem';\nimport { createRpcClient } from '../RpcClient';\nimport { PanelClient } from '../PanelClient';\nimport { AccessTable } from '../services/AccessTable';\nimport { EntryForm } from './EntryForm';\nimport { ComplexRpc } from '../services/ComplexRpc';\nimport { DBEntryType, EntryType, AnyItemType } from '../../bothside/types';\nimport { stopEvent } from '../services/DomUtils';\nimport { TextFormater } from '../services/TextFormater';\nimport { AutoComplete } from '../services/AutoCompletion';\n\n\nexport class Entry extends ClientItem<EntryType> {\n  readonly type = 'entry';\n  static readonly minName = 'entry';\n  static readonly klass = Entry;\n  static currentItem: Entry;\n  \n  // Constructor and data access\n  constructor(item: EntryType) {\n    super(item);\n  }\n  \n  // Getters pour acc\u00E8s direct aux propri\u00E9t\u00E9s courantes\n  get entree(): string { return this.item.dbData.entree; }\n  get genre(): string { return this.item.dbData.genre; }\n  get categorie_id(): string | undefined { return this.item.dbData.categorie_id; }\n  get definition(): string { return this.item.dbData.definition; }\n\n  static setAccessTableWithItems(items: EntryType[]) {\n    this._accessTable = new AccessTable<EntryType>(this.panel, items);\n  }\n  public static _accessTable: AccessTable<EntryType>;\n\n  /*\n      === M\u00C9THODES DE CHECK ===\n   */\n  // @return true si l'entr\u00E9e +entree+ existe d\u00E9j\u00E0\n  public static doesEntreeExist(entree: string): boolean {\n    entree = entree.toLowerCase();\n    return this.accessTable.find((item: EntryType) => item.cachedData.entree_min === entree) !== undefined ;\n  }\n  // @return true si l'identifiant +id+ existe d\u00E9j\u00E0\n  public static doesIdExist(id: string): boolean { return this.accessTable.exists(id); }\n\n  /**\n   * M\u00E9thode pour enregistrer l'item dans la table\n   * \n   * \n   */\n  public static saveItem(item: DBEntryType, compRpcId: string) {\n    RpcEntry.notify('save-item', {CRId: compRpcId, item: item});\n  }\n\n  public static autoCompleteBaliseTerm(trigger: string, ev: KeyboardEvent): false {\n    //*\n    stopEvent(ev);\n    AutoComplete.start({\n      target: ev.target as HTMLElement,\n      accessTable: this.accessTable,\n      balIn: '(',\n      balOut: ')',\n    });\n    //*/\n    return false;\n  }\n  public static autocompleteDim(ev: KeyboardEvent): false {\n    \n    const entree = this.accessTable\n      .get((this.panel.form.getEditedItem().original as DBEntryType).id)\n      .cachedData.entree_min;\n    const target = ev.target as HTMLTextAreaElement;\n    target.setRangeText(\n      '(' + entree + ')',\n      target.selectionStart,\n      target.selectionEnd,\n      'end'\n    );\n    return stopEvent(ev);\n  }\n\n}// class Entry\n\n\n\n\n/**\n * \n * ============== PANNEAUX DES ENTR\u00C9ES ===============\n */\n\n\n\nclass EntryPanelClass extends PanelClient<EntryType> {\n\n  // Raccourcis\n  public get accessTable(){ return Entry.accessTable ; }\n  private get selection(){return this.accessTable.getSelection();}\n\n  /**\n   * Raccourcis clavier propre au panneau\n   */\n  public tableKeys = {\n    C: {lab: 'choisir pour l\u2019exemple', fn: this.chooseSelectedItemForExemple.bind(this)},\n    E: {lab: 'exemple pour s\u00E9lection', fn: this.createExempleForSelectedItem.bind(this)},\n    m: {lab: 'mettre en forme', fn: this.miseEnFormSelection.bind(this)},\n  };\n\n  miseEnFormSelection(ev: Event){\n    if (this.selection) {\n      TextFormater.formate(\n        this, \n        this.accessTable.getObj(this.selection).querySelector('div.entry-definition'), \n        'definition'\n      );\n    } else {\n      this.flash('Il faut s\u00E9lectionner (f/k) l\u2019entr\u00E9e \u00E0 mettre en forme.', 'warn');\n    }\n    return ev && stopEvent(ev);\n  }\n\n  chooseSelectedItemForExemple(confirmed: boolean | undefined) {\n    if (confirmed === true) {\n      // on y va\n      const entryId: string = this.getSelection() as string;\n      RpcEntry.notify('entry-for-exemple', {entryId: entryId, entryEntree: this.accessTable.get(entryId).dbData.entree});\n    } else if (confirmed === false) {\n      this.flash(\"Ok, on renonce.\", 'notice');\n    } else {\n      // On demande confirmation\n      const selected: string | undefined = this.getSelection();\n      if (selected) {\n        // On demande confirmation\n        const boutons: Map<string, any> = new Map();\n        boutons.set('o', ['Oui', this.chooseSelectedItemForExemple.bind(this, true)]);\n        boutons.set('n', ['Renoncer', this.chooseSelectedItemForExemple.bind(this, false)]);\n        this.flashAction(\"Veux-tu choisir cette entr\u00E9e pour l'exemple \u00E9dit\u00E9 ?\", boutons);\n      } else {\n        this.flash(\"Il faut s\u00E9lectionner l'entr\u00E9e voulue\u00A0!\", 'warn');\n      }\n    }\n\n\n  }\n  createExempleForSelectedItem(){\n    this.flash(\"Je dois cr\u00E9er un exemple pour l'entr\u00E9e courante.\", 'notice');\n  }\n\n  /**\n   * M\u00E9thode de filtrage propre aux Entr\u00E9es (Entry)\n   * \n   * @param searched Texte \u00E0 trouver\n   * @returns Liste des items trouv\u00E9s\n   */\n  // M\u00E9thode de filtrage des entr\u00E9es\n  // Retourne celles qui commencent par +searched+\n  searchMatchingItems(searched: string): EntryType[] {\n    const prefixLower = StringNormalizer.toLower(searched);\n    const prefixRa = StringNormalizer.rationalize(searched);\n    return this.filter(Entry.accessTable, (item: AnyItemType) => {\n      item = item as EntryType;\n      return item.cachedData.entree_min.startsWith(prefixLower) || \n             item.cachedData.entree_min_ra.startsWith(prefixRa);\n    }) as EntryType[];\n  }\n  \n  // M\u00E9thode jou\u00E9e quand on clique sur un lien dans une d\u00E9finition\n  goToDef(id:string): void {\n    console.log(\"Le goToDef du panneau ave l'identifiant :\", id);\n    this.scrollToAndSelect(id);\n    this.flash('Utiliser la touche <shortcut>b</shortcut> (comme \u00AB\u00A0back\u00A0\u00BB) pour revenir \u00E0 la d\u00E9finition.', 'notice');\n  }\n  goToExemple(id: string) {\n    RpcEntry.notify('show-exemple', {exId: id});\n  }\n}\n\nconst EntryPanel = new EntryPanelClass({\n  minName: 'entry',\n  titName: 'Entries',\n  klass: Entry,\n  form: new EntryForm(),\n});\nEntryPanel.form.setPanel(EntryPanel);\nEntry.panel = EntryPanel;\n\n\n/**\n * \n * ================= R P C  ENTRY  ====================\n * \n */\n\nexport const RpcEntry = createRpcClient();\n\n/**\n * M\u00E9thode g\u00E9n\u00E9rique pour envoyer un message depuis l'extension avec\n * CanalEntry.notify('flash', {message: \"Le message \u00E0 \u00E9crire\"})\n * note : utilisable par les trois panneaux/classes\n */\nRpcEntry.on('flash', (params) => {\n  EntryPanel.flash(params.message, params.type || 'notice');\n});\n\n// Ev\u00E8nement re\u00E7u de l'extension \u00E0 l'ouverture (apr\u00E8s l'installation \n// compl\u00E8te) permettant essentiellement d'afficher la premi\u00E8re aide.\nRpcEntry.on('start', () => {\n  // Pour activer le panneau d'aide \u00E0 l'ouverture\n  // setTimeout(EntryPanel.activateContextualHelp.bind(EntryPanel), 1000);\n});\n\nRpcEntry.on('activate', () => {\n  if ( EntryPanel.isActif ) { return ; }\n  // console.log(\"[CLIENT ENTRY] Je dois marquer le panneau Entry actif\");\n  EntryPanel.activate();\n});\nRpcEntry.on('desactivate', () => {\n  if ( EntryPanel.isInactif ) { return ; } \n  // console.log(\"[CLIENT ENTRY] Je dois marquer le panneau Entry comme inactif.\");\n  EntryPanel.desactivate();\n});\n\nRpcEntry.on('populate', (params) => {\n  Entry.deserializeItems(params.data);\n  EntryPanel.populate(Entry.accessTable);\n  EntryPanel.initKeyManager();\n});\n\nRpcEntry.on('display-entry', (params) => {\n  console.log(\"[CLIENT] Je dois afficher l'entr\u00E9e '%s'\", params.entry_id);\n  EntryPanel.scrollToAndSelect(params.entry_id);\n});\n\nRpcEntry.on('check-oeuvres-resultat', (params: {CRId: string, resultat: {[x: string]: any}}) => {\n  // console.log(\"[CLIENT ENTRY] Je re\u00E7ois le r\u00E9sultat du check des oeuvres\", params );\n  ComplexRpc.resolveRequest(params.CRId, params.resultat);\n});\n\nRpcEntry.on('check-exemples-resultat', (params: {CRId: string, resultat: {known: string[], unknown: string[]}}) => {\n  // console.log(\"[CLIENT ENTRY] R\u00E9ception du r\u00E9sultat du check des exemples : \", params);\n  ComplexRpc.resolveRequest(params.CRId, params.resultat);\n});\n\nRpcEntry.on('after-saved-item', (params) => {\n  // console.log(\"[CLIENT Entry] R\u00E9ception du after-saved-item\", params);\n  // Entry.onSavedItem(params);\n  ComplexRpc.resolveRequest(params.CRId, params);\n\n});\n\n// Pour exposer globalement\n(window as any).Entry = Entry ;\n\n// Pour \u00E9viter les imports circulaires\n(window as any).RpcEntry = RpcEntry;\n"],
  "mappings": "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",
  "names": []
}
