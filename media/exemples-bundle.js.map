{
  "version": 3,
  "sources": ["../src/webviews/services/App.ts", "../src/webviews/ConsoleManager.ts", "../src/bothside/StringUtils.ts", "../src/webviews/services/SelectionManager.ts", "../src/webviews/ClientItem.ts", "../src/bothside/RpcChannel.ts", "../src/webviews/RpcClient.ts", "../src/webviews/services/AccessTable.ts", "../src/webviews/services/HelpManager.ts", "../src/webviews/services/DomUtils.ts", "../src/webviews/services/VimLikeManager.ts", "../src/bothside/class_extensions.ts", "../src/webviews/services/ClipboardManager.ts", "../src/webviews/PanelClient.ts", "../src/webviews/services/ComplexRpc.ts", "../src/webviews/services/FormManager.ts", "../src/webviews/models/ExempleForm.ts", "../src/webviews/models/Exemple.ts"],
  "sourcesContent": ["import { RpcChannel } from \"../../bothside/RpcChannel\";\n\nexport class App {\n  /**\n   * Les m\u00E9thodes suivantes peuvent s'appeler en tapant simplement leur\n   * nom en console (bas des panneaux \u2014 'c' pour rejoindre la console)\n   */\n\n  private static async exportAntidote() {\n    App.rpc.notify('export-antidote-relecture');\n    return \"Export pour Antidote et relecture\";\n  }\n  private static async exportLecture(){ return this.exportAntidote(); }\n\n  private static async exportPFB() {\n    App.rpc.notify('export-pfb');\n    return \"Export pour Prawn-for-book\";\n  }\n\n  private static async openSupport() {\n    console.log(\"-> openSupport\");\n    App.rpc.notify('open-support-folder');\n    return \"Ouverture du dossier Support\";\n  }\n\n  private static async exportAllData(){\n    console.log(\"-> exportAllData\");\n    App.rpc.notify('export-all-data');\n    return \"Exportation des donn\u00E9es demand\u00E9e.\";\n  }\n\n  private static get rpc(): RpcChannel {return (window as any).RpcEntry; }\n\n  /**\n   * \n   * M\u00E9thode fonctionnelles\n   * \n   * @param code Code \u00E0 \u00E9valuer\n   * @returns True si tout s'est bien pass\u00E9 (le code \u00E0 pu \u00EAtre \u00E9valu\u00E9), False sinon\n   * \n   */\n  static eval(code: string){\n    const ok = this.tryEval(code) || this.tryEval('this.' + code) || this.tryEval(code + '()') || this.tryEval('this.' + code + '()') || console.warn(\"Code non \u00E9valuable dans App : %s\", code)\n      ;\n    if ( ok ) { return true ; }\n    else { return false; }\n  }\n  private static tryEval(code: string){\n    console.log(\"Code \u00E0 \u00E9valuer dans App.tryEval\", code);\n    try {\n      // eval(code);\n      const result = new Function('return ' + code).call(this);\n      if (undefined === result) { throw new Error(\"Code qui ne renvoie rien\");}\n      if ( 'function' === typeof result) { result(); }\n      return true;\n    } catch(erreur) {\n      // console.warn(erreur);\n      return false;\n    }\n  }\n\n}", "import { PanelClient } from \"./PanelClient\";\nimport { App } from \"./services/App\";\n\n/**\n * Pour g\u00E9rer les consoles de chaque panneau\n */\nexport class ConsoleManager {\n  private console: HTMLInputElement;\n  private history: string[] = [];\n  private ihistory: number = 0;\n\n  constructor(private panel: PanelClient<any>) {\n    this.console = panel.consoleInput as HTMLInputElement;\n  }\n  runCode() {\n    // Il vaut \u00E9valuer l'expression\n    const code = this.console.value;\n    try {\n      const result = (0, eval)(code);\n      this.history.push(code);\n      this.ihistory = this.history.length; // oui, vraiment\n      this.console.value = '';\n    } catch (error) {\n      if ( false === App.eval(code)) {\n        this.panel.flash(\"Ce code produit une erreur\u2026\", 'error');\n        console.error(code, error);\n      }\n    }\n  }\n  setCode(){\n    console.log(\"Console.setCode. History. iHistory\", this.history, this.ihistory);\n    this.console.value = this.history[this.ihistory];\n  }\n  backHistory(){\n    if ( this.ihistory === 0) {\n      console.log(\"Fin de l'historique\");\n      this.console.value = '';\n      return;\n    }\n    this.ihistory --;\n    this.setCode();\n  }\n  forwardHistory(){\n    if ( this.ihistory === this.history.length - 1) {\n      console.log(\"Bout de l'historique\");\n      return;\n    }\n    this.ihistory ++;\n    this.setCode();\n  }\n}", "/**\n * Utilitaire pour normaliser les cha\u00EEnes de caract\u00E8res\n * (suppression des accents, minuscules, etc.)\n */\nexport class StringNormalizer {\n  /**\n   * Normalise une cha\u00EEne en minuscules\n   */\n  static toLower(text: string): string {\n    return text.toLowerCase();\n  }\n\n  /**\n   * Normalise une cha\u00EEne en supprimant les accents et diacritiques\n   * TODO: \u00C0 am\u00E9liorer avec une vraie fonction de normalisation\n   */\n  static rationalize(text: string): string {\n    return text\n      .toLowerCase()\n      .normalize('NFD') // D\u00E9compose les caract\u00E8res accentu\u00E9s\n      .replace(/[\\u0300-\\u036f]/g, '') // Supprime les marques diacritiques\n      .replace(/[^a-zA-Z0-9]/g, '');  // note : si c'\u00E9tait avant la ligne pr\u00E9c\u00E9dente, il n'y aurait pas besoin de la ligne pr\u00E9c\u00E9dente\u2026\n  }\n}\n", "import { AnyItemType } from \"../../bothside/types\";\nimport { PanelClient } from \"../PanelClient\";\nimport { AccessTable } from \"./AccessTable\";\n\nconst DEBUGIT = false;\n/**\n * Class principal de la gestion des s\u00E9lections dans les panneaux.\n * Chaque panneau poss\u00E8de son propre manager de s\u00E9lection puisque les\n * panneaux sont totalement ind\u00E9pendants.\n * \n * ATTENTION : Ce n'est pas cette classe qui g\u00E8re l'aspect des\n * \u00E9l\u00E9ments s\u00E9lectionn\u00E9s, c'est l'accessTable (jusqu'\u00E0 nouvel ordre\n * en tout cas...)\n * \n * C'est l'AccessTable de chaque panneau qui poss\u00E8de une instance de cette\n * classe appel\u00E9 selectionManager. Donc <panel>.accessTable.selectionManager.\n * \n * Pour le moment, on part du principe qu'il y a une seule s\u00E9lection \u00E0 la fois et\n * qu'il y a toujours une s\u00E9lection (la pr\u00E9c\u00E9dente ou la premi\u00E8re).\n * \n * On m\u00E9morise l'historique des s\u00E9lections afin de pouvoir y revenir.\n * \n * On ne manipule ici que des identifiants d'item, donc des strings courts.\n */\n\nexport class SelectionManager {\n  // La panneau associ\u00E9 au manager de s\u00E9lection\n  private panel: PanelClient<AnyItemType>;\n\n  private current: string | undefined = undefined;\n  public getCurrent(): string | undefined { return this.current; }\n  private icursor: number = 0;\n  private historique: string[] = [];\n \n  constructor(\n    private accessTable: AccessTable<AnyItemType>,\n  ) {\n    this.panel = accessTable.panel;\n  }\n\n  /**\n   * @api\n   * \n   * S\u00E9lection du prochain item (ou le premier)\n   * \n   */\n  public selectNextVisibleItem(){\n    let nextId: string | undefined = undefined;\n    if (this.current) {\n      nextId = (this.accessTable.getNextVisible(this.current) as AnyItemType)?.id;\n    }\n    nextId = nextId || (this.accessTable.getFirstVisible() as AnyItemType).id;\n    \n    this.debugit('Affectation de l\u2019item', nextId);\n\n    // On s\u00E9lectionne l'item suivant (ou le premier)\n    this.setAsCurrentSelected(nextId);\n\n    // On l'ajoute \u00E0 l'historique\n    this.add(nextId);\n  }\n\n  /**\n   * @papi\n   * \n   * S\u00E9lection de l'item visible pr\u00E9c\u00E9dent.\n   * \n   */\n  public selectPreviousVisibleItem(){\n    let prevId: string | undefined = undefined;\n    if (this.current){\n      prevId = (this.accessTable.getPrevVisible(this.current) as AnyItemType)?.id;\n    }\n    prevId = prevId || (this.accessTable.getLastVisible() as AnyItemType).id;\n    // Et on s\u00E9lectionne l'item pr\u00E9c\u00E9dent (ou le premier)\n    this.setAsCurrentSelected(prevId);\n    \n    // On l'ajoute \u00E0 l'historique\n    this.add(prevId);\n\n  }\n  /**\n   * @api\n   * \n   * M\u00E9thode pour d\u00E9selectionner la s\u00E9lection courante.\n   * \n   * Elle doit \u00EAtre publique car elle sert par exemple en cas de\n   * filtrage de la liste.\n   * \n   */\n  public deselectCurrent(){\n    this.current && this.accessTable.setSelectState(this.current, false);\n    this.current = undefined; \n  }\n \n  /**\n   * @api\n   * \n   * (Re)s\u00E9lectionne l'item pr\u00E9c\u00E9dent.\n   * \n   * Le \"re\" de \"reselectionne\" n'est l\u00E0 que pour indiquer qu'on fait\n   * cette op\u00E9ration est par une s\u00E9lection \"classique\". Elle est\n   * utilis\u00E9e en cas de filtrage de liste, quand l'itemp qui \u00E9t\u00E9 s\u00E9-\n   * lectionn\u00E9 et encore visible. Mais this.current a \u00E9t\u00E9 mis \u00E0 rien\n   * au d\u00E9but du filtrage.\n   * \n   * Note : on ne l'ajoute pas \u00E0 l'historique puisqu'il s'y trouve \n   * d\u00E9j\u00E0.\n   */\n  reselectItem(itemId: string){\n    this.setAsCurrentSelected(itemId);\n  }\n\n  /**\n   * @api Par exemple s\u00E9lection demand\u00E9e depuis un autre panneau\n   * \n   * @param itemId Identifiant de l'item \u00E0 s\u00E9lectionner\n   */\n  selectItem(itemId: string){\n    this.setAsCurrentSelected(itemId);\n    this.add(itemId);\n  }\n\n  /**\n    * Pour revenir \u00E0 l'item pr\u00E9c\u00E9dent\n    */\n  public historyBack() {\n    this.debugit('back');\n    this.ensurePrevCursor();\n    this.setAsCurrentSelected(this.historique[this.icursor]);\n  }\n  /**\n   * Pour passer \u00E0 l'\u00E9l\u00E9ment suivant\n   */\n  public historyNext() {\n    this.debugit('next');\n    this.ensureNextCursor();\n    this.setAsCurrentSelected(this.historique[this.icursor]);\n  }\n\n  /**\n   * Pour retirer l'item courant de l'historique des s\u00E9lections\n   */\n  public removeCurrentFromHistory() {\n    if (this.size === 1) {\n      this.panel.flash(\"On ne peut pas retirer le dernier item d\u2019historique s\u00E9lectionn\u00E9.\", 'warn');\n    } else {\n      this.historique.splice(this.icursor);\n      this.historyBack();\n    }\n  }\n\n\n\n  /**\n   * M\u00E9thode qui s'occupe de mettre l'\u00E9l\u00E9ment +itemId+ en item \n   * courant en s'assurant de s\u00E9lectionner l'item qui serait\n   * actuellement s\u00E9lectionn\u00E9.\n   * \n   * @param itemId Identifiant de l'\u00E9l\u00E9ment \u00E0 mettre en courant\n   */\n  private setAsCurrentSelected(itemId: string){\n     // S'il y avait un s\u00E9lectionn\u00E9, on le d\u00E9selectionne\n    this.current && this.deselectCurrent();\n    // On met le nouveau courant\n    this.current = String(itemId);\n    // On s\u00E9lectionne l'item\n    this.select();\n    // Et on scrolle jusqu'\u00E0 lui\n    this.panel.scrollTo(this.current);\n  }\n  \n\n  private select() {\n    this.current && this.accessTable.setSelectState(this.current, true);\n  }\n\n  private add(itemId: string) {\n    this.debugit('add');\n    this.historique.push(itemId);\n    this.icursor = this.lastIndex;\n  }\n  private ensurePrevCursor() {\n    this.icursor--;\n    if (this.icursor < 0) { this.icursor = this.lastIndex; }\n  }\n  private ensureNextCursor() {\n    this.icursor++;\n    if (this.icursor > this.lastIndex) { this.icursor = 0; }\n  }\n\n  private get lastIndex() { return this.size - 1; }\n  private get size() { return this.historique.length; }\n\n  // Pour d\u00E9bugger la classe\n  private debugit(where: string, id: string | undefined = undefined) {\n    if (!DEBUGIT) { return; }\n    console.log(`\n      [${where}]\n      icursor = %i\n      current = '%s'\n      id fourni = '%s'\n      `, this.icursor, (this.current ? `'${this.current}'` : 'undefined'), id, this.historique);\n  }\n\n\n}\n", "import { EntryType, OeuvreType, ExempleType, AnyItemType } from \"../bothside/types\";\nimport { SelectionManager } from \"./services/SelectionManager\";\nimport { PanelClient } from \"./PanelClient\";\n\ntype ItemDataType = EntryType | OeuvreType | ExempleType;\n\n/**\n * Class abstraite pour tous les Items (Entry, Oeuvre, Exemple)\n */\nexport abstract class ClientItem<Tdt extends ItemDataType> {\n  static klass: any;\n  public static get accessTable(){ return this.klass._accessTable;}\n  public static panel: PanelClient<any>;\n\n  // protected static _accessTable: AccessTable<any>;\n  private static _selector: SelectionManager;\n  public static get Selector(){ \n    return this._selector || (this._selector = new SelectionManager(this.klass));\n  }\n\n  // Raccourcis vers l'accessTable, pour obtenir des informations\n  // sur les items ou les items eux-m\u00EAme\n  static get(itemId: string): AnyItemType | undefined {\n    return this.accessTable.get(itemId);\n  } \n  static getObj(itemId: string): HTMLDivElement {\n    return this.accessTable.getObj(itemId);\n  }\n  static each(method:(item: AnyItemType) => void){ this.accessTable.each(method);}\n\n  static isVisible(id: string): boolean { return this.accessTable.isVisible(id); }\n  static setVisible(id: string) { this.accessTable.setVisibility(id, true); }\n  static setInvisible(id: string) { this.accessTable.setVisibility(id, false); }\n\n  static selectFirstItem() { this.panel.select(this.accessTable.firstItem);}\n\n  static editItem(itemId: string): void { this.panel.form.editItem(this.get(itemId)); }\n  static createNewItem(){ \n    // Cr\u00E9er un objet DB vide pour nouveau item\n    const emptyDbData = { id: '' }; // Les autres champs seront initialis\u00E9s dans le formulaire\n    this.panel.form.editItem(new this.klass(emptyDbData)); \n  }\n\n  // toRow(){ return {};}\n  /**\n   * M\u00E9thode qui re\u00E7oit les items s\u00E9rialis\u00E9s depuis l'extension et va les\n   * consigner dans le panneau, dans une AccessTable qui permettra de \n   * parcourrir les \u00E9l\u00E9ments. \n   */\n  static deserializeItems(items: string[]): void {\n    const allItems: AnyItemType[] = items.map( (item: string) => JSON.parse(item) as AnyItemType);\n    // console.log(\"Tous les items\", allItems);\n    this.setAccessTableWithItems(allItems);\n  }\n  /* Surclass\u00E9e */ static setAccessTableWithItems(items: any){};\n\n  public get id(): string {return this.item.id;}\n\n  constructor(\n    public item: Tdt\n  ){ } \n\n  // Pour obtenir l'AccKey (ak) de l'item\n  static getAccKey(id: string) { return this.accessTable.getAccKey(id) ; }\n}", "/**\n * Canal RPC pour communiquer entre extension et webview.\n * Les deux c\u00F4t\u00E9s chargent ce module.\n */\ntype Request = {\n  id: number;\n  method: string;\n  params: any;\n};\n\ntype Response = {\n  id: number;\n  result: any;\n};\n\ntype Notification = {\n  method: string;\n  params: any;\n};\n\nexport class RpcChannel {\n  private counter = 0;\n  private pending = new Map<number, (value: any) => void>();\n  private handlers = new Map<string, (params: any) => any>();\n\n  constructor(\n    private sender: (msg: any) => void,\n    private receiver: (cb: (msg: any) => void) => void\n  ) {\n    this.receiver(this.handleMessage.bind(this));\n  }\n\n  private handleMessage(msg: any) {\n    if (\"id\" in msg && \"method\" in msg) {\n      // C\u2019est une requ\u00EAte (ask c\u00F4t\u00E9 oppos\u00E9)\n      const handler = this.handlers.get(msg.method);\n      if (handler) {\n        Promise.resolve(handler(msg.params)).then((result) => {\n          this.sender({ id: msg.id, result });\n        });\n      }\n    } else if (\"id\" in msg && \"result\" in msg) {\n      // R\u00E9ponse\n      const cb = this.pending.get(msg.id);\n      if (cb) {\n        cb(msg.result);\n        this.pending.delete(msg.id);\n      }\n    } else if (\"method\" in msg) {\n      // Notification (notify c\u00F4t\u00E9 oppos\u00E9)\n      const handler = this.handlers.get(msg.method);\n      if (handler) {\n        handler(msg.params);\n      }\n    }\n  }\n\n  ask(method: string, params?: any): Promise<any> {\n    const id = this.counter++;\n    const req: Request = { id, method, params };\n    this.sender(req);\n    return new Promise((resolve) => {\n      this.pending.set(id, resolve);\n    });\n  }\n\n  notify(method: string, params?: any) {\n    // console.log(\"Message re\u00E7u dans le 'notify' du RpcChannel\", method, params);\n    const notif: Notification = { method, params };\n    this.sender(notif);\n  }\n\n  on(method: string, handler: (params: any) => any) {\n    // console.log(\"Message re\u00E7u dans le 'on' du RpcChannel\", method, handler);\n    this.handlers.set(method, handler);\n  }\n}\n", "import { RpcChannel } from \"../bothside/RpcChannel\";\n\ndeclare function acquireVsCodeApi(): {\n  postMessage: (msg: any) => void;\n};\n\nexport function createRpcClient() {\n  const vscode = acquireVsCodeApi();\n\n  return new RpcChannel(\n    // sender : envoie vers l'extension\n    (msg) => vscode.postMessage(msg),\n    // receiver : re\u00E7oit les messages de l'extension\n    (cb) => window.addEventListener(\"message\", (event) => cb(event.data))\n  );\n}", "/**\n * Grande classe qui permet de parcourir tr\u00E8s vite les \u00E9l\u00E9ments en\n * sachant s'ils sont visibles, s\u00E9lectionn\u00E9s, etc.\n */\nimport { StringNormalizer } from \"../../bothside/StringUtils\";\nimport { EntryType, OeuvreType, ExempleType, AnyItemType } from \"../../bothside/types\";\nimport { PanelClient } from \"../PanelClient\";\nimport { SelectionManager } from \"./SelectionManager\";\n\n/**\n * Le type propre aux donn\u00E9es enregistr\u00E9es dans les AccessTables de chaque \u00E9l\u00E9ment.\n */\nexport interface AccedableItem {\n  readonly type: 'accedable-item';\n  id: string;         // Identifiant absolu de l'\u00E9l\u00E9ment, quel qu'il soit\n  index: number;      // Index pr\u00E9cis dans l'Array\n  obj: HTMLDivElement | undefined ;        // L'objet HTML de l'\u00E9l\u00E9ment, dans le listing\n  next:  string | undefined ;      // Id de l'\u00E9l\u00E9ment suivant dans l'Array (pas forc\u00E9ment contigu)\n  prev:  string | undefined ;      // Id de l'\u00E9l\u00E9ment pr\u00E9c\u00E9dent dans l'Array (idem)\n  visible: boolean;   // Pour savoir si l'\u00E9l\u00E9ment est visible\n  display: 'block' | 'none';  // Le display actuel de l'\u00E9l\u00E9ment\n  selected: boolean;  // Pour savoir si l'\u00E9l\u00E9ment est s\u00E9lectionn\u00E9\n  modified: boolean;  // Pour savoir si l'item a \u00E9t\u00E9 modifi\u00E9\n  lastSelectedLink?: number | undefined; // L'indice 1-start du dernier lien s\u00E9lectionn\u00E9 dans la d\u00E9finition ou le content de l'exemple (pour s\u00E9lection avec Tab)\n // On pourra ajouter ici d'autres donn\u00E9es volatiles\n}\n\nexport class AccessTable<T extends EntryType | OeuvreType | ExempleType> {\n  // Table des pointeurs de donn\u00E9es\n  keysMap: Map<string, AccedableItem> = new Map();\n  // Table de toutes les donn\u00E9es des items, dans un ordre\n  // d'arriv\u00E9e jamais chang\u00E9.\n  arrayItems: T[] = [];\n  // Table de la table (pour v\u00E9rification)\n  _size!: number | null ;\n  // Le premier item, qui doit forc\u00E9ment \u00EAtre le premier charg\u00E9\n  _firstItem!: T;\n  public get firstItem(){ return this._firstItem || (this._firstItem = this.arrayItems[0]); }\n  _lastItem!: T;\n  public get lastItem(){return this._lastItem || (this._lastItem = this.arrayItems[this.arrayItems.length - 1]);}\n\n  getSelection() { return this.selectionManager.getCurrent(); }\n \n  constructor(\n    public panel: PanelClient<T>,\n    items: T[]\n  ) {\n    this.populateInTable(items);\n  }\n\n  public get selectionManager(){\n    return this._selmanager || (this._selmanager = new SelectionManager(this));\n  }\n  private _selmanager!: SelectionManager;\n  \n  // apr\u00E8s un ajout ou une suppression, par exemple\n  reset(){\n    this._size = null;\n  }\n\n  /**\n   * La fonction g\u00E8re l'\u00E9tat DOM de l'\u00E9l\u00E9ment s\u00E9lectionn\u00E9 ou d\u00E9selectionn\u00E9,\n   * \u00E0 savoir :\n   * - la classe 'selected' de son objet DOM\n   * - la propri\u00E9t\u00E9 @selected de son accKey\n   * \n   * @param id Identifiant de l'\u00E9l\u00E9ment (AnyItemType)\n   * @param state Son nouvel \u00E9tat (true = s\u00E9lectionn\u00E9, false = d\u00E9s\u00E9lectionn\u00E9)\n   */\n  setSelectState(id: string, state: boolean) {\n    // console.log(\"[setSelectState\u00B0 Mettre l'\u00E9tat de l'item '%s' \u00E0 %s\", id, state ? 'true' :'false');\n    const itemAK = this.getAccKey(id);\n    const obj = itemAK.obj || this.getObj(id); // Le d\u00E9finit s'il n'existe pas\n    itemAK.selected = state;\n    obj.classList[state?'add':'remove']('selected');\n  }\n\n  get size(){ return this._size || (this._size = this.keysMap.size);}\n\n  isVisible(id: string) { return this.getAccKey(id).visible === true ;}\n  setVisibility(id: string, state: boolean) {\n    const ak = this.getAccKey(id);\n    if ( ak.visible !== state ) {\n      // <= L'\u00E9tat change => Il faut le changer dans la donn\u00E9e et le DOM\n      ak.visible = state;\n      if ( ak.obj === undefined ) { ak.obj = this.DOMElementOf(id) ; }\n      const display = state ? 'block' : 'none';\n      ak.display = display ;\n      ak.obj.style.display = display ;\n    }\n  }\n\n  // Retourne le premier \u00E9l\u00E9ment visible\n  getFirstVisible(): T | undefined {\n    return this.find((item: T) => this.getAccKey(item.id).visible === true);\n  }\n  // Retourne le dernier \u00E9l\u00E9ment visible\n  getLastVisible(): T | undefined {\n    return this.findLast((item: T) => this.getAccKey(item.id).visible === true);\n  }\n\n  getNextVisible(refId: string | undefined): T | undefined {\n    let ak: AccedableItem | undefined;\n    let icrashLoop = 0;\n    while (refId && (ak = this.getNextAccKey(refId))) {\n      if (ak.visible) {\n        return this.get(ak.id);\n      } else {\n        refId = ak.next;\n      }\n      ++icrashLoop;\n      if (icrashLoop > 100_000){\n        // Normalement, ne devrait pas arriver, mais bon\u2026\n        this.panel.flash('Sortie de boucle sans fin.', 'error');\n        return undefined;\n      }\n    }\n  }\n  getPrevVisible(refId: string | undefined): AnyItemType | undefined {\n    let ak: AccedableItem | undefined;\n    let icrashLoop = 0;\n    while (refId && (ak = this.getPrevAccKey(refId))) {\n      if (ak.visible) {\n        return this.get(ak.id);\n      } else {\n        refId = ak.prev;\n      }\n      ++icrashLoop;\n      if ( icrashLoop > 100_000){\n        // Normalement, ne devrait jamais arriver\n        this.panel.flash('Sortie forc\u00E9e de boucle sans fin.', 'error');\n        return undefined;\n      }\n    }\n  }\n  \n  // @return true si l'\u00E9l\u00E9ment d'identifiant +id+ existe.\n  exists(id: string): boolean { return this.keysMap.has(id); }\n\n  get(id: string): T { return this.arrayItems[(this.keysMap.get(id) as AccedableItem).index]; }\n  getByAccKey(ak: AccedableItem): T { return this.get(ak.id); }\n\n  /**\n   * Retourne l'objet DOM de l'item en s'assurant qu'il est d\u00E9fini\n   * dans l'AccKey (ce qui n'est pas fait par d\u00E9faut)\n   */\n  getObj(id: string): HTMLDivElement {\n    const ak = this.getAccKey(id);\n    if ( ! ak ) {\n      console.error(\"Impossible d'obtenir l'AK de l'id '%s'\u2026\", id, this.arrayItems);\n    }\n    ak.obj || Object.assign(ak, { obj: this.DOMElementOf(id)});\n    if ( ! ak.obj ) {\n      console.error(\"Impossible d'obtenir l'objet de l'item '%'\u2026\", id);\n    }\n    return ak.obj as HTMLDivElement;\n  }\n  \n  getAccKey(itemId: string): AccedableItem { return this.keysMap.get(itemId) as AccedableItem ; }\n\n  /**\n   * Actualise ou Cr\u00E9e le nouvel item Item apr\u00E8s son enregistrement\n   * dans la base de donn\u00E9es.\n   * \n   * Pour savoir si c'est une cr\u00E9ation ou une actualisation, il\n   * suffit de voir si l'identifiant est connu de la table (noter\n   * que pour les exemples, il n'y a pas d'identifiant autre que\n   * volatile).\n   * \n   * Noter que ce sont toujours les donn\u00E9es compl\u00E8tes qui sont\n   * remont\u00E9es, m\u00EAme pour une actualisation. Car l'actualisation\n   * a pu modifier des donn\u00E9es qui servent pour le tri, le formatage,\n   * etc.\n   * \n   * @returns [<item>, <next item>] Pour soit updater les donn\u00E9es pour une\n   * update soit ins\u00E9rer le nouvel \u00E9l\u00E9ment dans le DOM pour une cr\u00E9ation\n   * Note : c'est le panneau qui s'en charge.\n   */\n  public upsert(item: AnyItemType): [T, T | undefined] {\n    // console.log(\"Item re\u00E7u par upsert\", item);\n    const checkedId: string = item.id; \n    let cachedItem;\n    if ( this.exists(checkedId)) {\n      // Update\n      const accKey: AccedableItem = this.getAccKey(checkedId);\n      // console.log(\"Ancienne valeur de l'\u0153uvre\", structuredClone(this.arrayItems[accKey.index]));\n      this.arrayItems[accKey.index] = item as T;\n      // console.log(\"Nouvelle valeur de l'\u0153uvre\", this.arrayItems[accKey.index]);\n      // Pour l'update dans le DOM\n      return [item as T, undefined];\n    } else {\n      // Create\n      // (retour) Pour l'affichage des informations\n      return this.createNewAccedableItem(item as T);\n    }\n  }\n\n  private createNewAccedableItem(newItem: T): [T, T | undefined] {\n    // On cherche sa place en fonction de son identifiant\n    let nextItem: T | undefined = this.find((compItem: T) => { return compItem.id > newItem.id; });\n    // console.log(\"Item apr\u00E8s\", nextItem);\n    let nextItemId: string | undefined, prevItemId: string | undefined, prevItem: T | undefined;\n    let nextAccKey: AccedableItem | undefined;\n    if (nextItem)  {\n      nextItemId = nextItem.id;\n      nextAccKey = this.getAccKey(nextItemId);\n      const prevAccKey: AccedableItem = this.getAccKey(nextAccKey.prev as string);\n      prevItemId = nextAccKey.prev;\n      if (prevItemId) {\n        // Un \u00E9l\u00E9ment pr\u00E9c\u00E9dent existait, il faut d\u00E9crocher le pr\u00E9c\u00E9dent\n        // et le suivant pour ins\u00E9rer le nouvel item\n        Object.assign(prevAccKey, {next: newItem.id});\n        Object.assign(nextAccKey, {prev: newItem.id});\n        // console.log(\"Item avant le nouveau\", this.get(prevItemId), prevAccKey);\n      }\n    } else {\n      // Si le nouvel item n'a pas d'item suivant, c'est qu'il est \n      // le dernier nouvel item. il faut red\u00E9finir this.lastItem\n      this._lastItem = newItem;\n    }\n    const arrayIndex = this.arrayItems.length; // car l'item n'a pas encore \u00E9t\u00E9 ins\u00E9r\u00E9\n    const newAccKey: AccedableItem = this.addInTable(newItem, arrayIndex, nextItemId, prevItemId); \n    // console.log(\"Item nouveau\", newItem, newAccKey);\n    // console.log(\"Item apr\u00E8s le nouveau\", nextItem, nextAccKey);\n    return [newItem, nextItem];\n  }\n  \n  getNextItem(id: string): T | undefined {\n    const nextAK = this.getNextAccKey(id);\n    return nextAK ? this.get(nextAK.id) : undefined ;\n  }\n  \n  getNextItemByAccKey(ak: AccedableItem) : T | undefined {\n    return ak.next ? this.get(ak.next) : undefined ;\n  }\n\n getPrevItem(id: string): T | undefined {\n    const prevAK = this.getPrevAccKey(id);\n    return prevAK ? this.get(prevAK.id) : undefined ;\n  }\n  getPrevItemByAccKey(ak: AccedableItem) : T | undefined {\n    return ak.prev ? this.get(ak.prev) : undefined ;\n  }\n  \n getNextAccKey(id: string): AccedableItem | undefined {\n    const ak = this.getAccKey(id);\n    return ak.next ? this.getAccKey(ak.next) : undefined;\n  }\n getNextAccKeyByAccKey(ak: AccedableItem): AccedableItem | undefined {\n    return ak.next ? this.getNextAccKey(ak.next) : undefined ;\n  }\n \n getPrevAccKey(id: string): AccedableItem | undefined {\n    const ak = this.getAccKey(id);\n    return ak.prev ? this.getAccKey(ak.prev) : undefined;\n  }\n getPrevAccKeyByAccKey(ak: AccedableItem): AccedableItem | undefined {\n    return ak.prev ? this.getPrevAccKey(ak.prev) : undefined ;\n  }\n\n\n  // Boucle sur tous les \u00E9l\u00E9ments (sans retour)\n  each(traverseMethod: (item: T) => void){\n    this.eachSince(traverseMethod, this.firstItem.id);\n  }\n\n  // Boucle depuis l'\u00E9l\u00E9ment d'identifiant +id+\n  eachSince(\n    traverseMethod: (item: T) => any,\n    id: string \n  ){\n    let item: T | undefined = this.get(id);\n    do {\n      if ( item ) {\n        traverseMethod(item);\n        item = this.getNextItem(item.id);\n      } else { break ;}\n    } while ( item ); \n  }\n\n  /**\n   * Boucle sur toutes les AcceedableItem (AccKey/ak)\n   */\n  eachAccKey(fnEach: (ak: AccedableItem) => void ) {\n    this.keysMap.forEach(fnEach);\n  }\n\n  /**\n   * Boucle sur tous les items \u00E0 partir de l'item d'id +id+ en\n   * collectant une donn\u00E9e quelconque.\n   */\n  mapSince(\n    traverseMethod: (item: T) => any,\n    id: string \n  ): any[] {\n    const collected = [];\n    let item: T | undefined = this.get(id);\n    do {\n      if ( item ) {\n        let retour: any = traverseMethod(item);\n        collected.push(retour);\n        item = this.getNextItem(item.id);\n      } else { break ;}\n    } while ( item );\n    return collected;\n  }\n  // Boucle sur TOUTES les donn\u00E9es en collectant une donn\u00E9e\n  map(\n    traverseMethod: (item: T) => any\n  ): any[] {\n    return this.mapSince(traverseMethod, this.firstItem.id);\n  }\n\n  /**\n   * M\u00E9thode qui boucle sur tous les \u00E9l\u00E9ments depuis l'\u00E9l\u00E9ment d'id\n   * +itemId+ et retourne une Map avec en cl\u00E9 l'identifiant de\n   * l'item et en valeur la valeur retourn\u00E9e par la m\u00E9thode\n   * +traverseMethod+\n   */\n  collectSince(\n    traverseMethod: (item: T) => any,\n    itemId: string \n  ): Map<string, any> {\n    const collected: Map<string, any> = new Map() ;\n    let item: T | undefined = this.get(itemId);\n    do {\n      if ( item ) {\n        let retour: any = traverseMethod(item);\n        collected.set(item.id, retour);\n        item = this.getNextItem(item.id);\n      } else { break ;}\n    } while ( item );\n    return collected;\n  }\n  // Boucle sur tous les \u00E9l\u00E9ments en r\u00E9coltant une valeur qu'on met\n  // dans une Map qui a en cl\u00E9 l'identifiant de l'item\n  collect(traverseMethod: (item: T) => any): Map<string, any> {\n    return this.collectSince(traverseMethod, this.firstItem.id);\n  }\n \n /**\n  * Boucle sur les items, depuis l'item d'identifiant +id+ ou depuis le premier et \n  * retourne le premier qui r\u00E9pond \u00E0 la condition +condition+\n  */ \n  find(\n    condition: (item: T) => boolean, \n  ): T | undefined {\n    return this.findAfter(condition, undefined);\n  }\n  findLast(\n    condition: (item: T) => boolean\n  ): T | undefined {\n    return this.findLastBefore(condition, undefined);\n  }\n  \n  findLastBefore(\n    condition: (item: T) => boolean,\n    id: string | undefined\n  ): T | undefined {\n    let item: T | undefined;\n    if ( id === undefined) {\n      item = this.lastItem;\n    } else {\n      item = this.getPrevItem(id);\n    }\n\n    let found: T | undefined = undefined;\n    do {\n      if (item) {\n        if (condition(item) === true) {\n          found = item;\n          break;\n        }\n        // Sinon, on prend l'item pr\u00E9c\u00E9dent\n        item = this.getPrevItem(item.id);\n      }\n\n    } while (item);\n    return found;\n  }\n\n  findAfter(\n    condition: (item: T) => boolean,\n    id: string | undefined\n  ): T | undefined {\n    let item: T | undefined ;\n    if ( id === undefined ) {\n      item = this.firstItem ;\n    } else {\n      item = this.getNextItem(id);\n    }\n    let found: T | undefined ;\n    do {\n      if ( item ) {\n        if (condition(item) === true ) { \n          found = item;\n          break ;\n        }\n        item = this.getNextItem(item.id);\n      }\n    } while ( item ); \n    return found ; \n  }\n  \n  /**\n   * Recherche dans l'ordre tous les \u00E9l\u00E9ments r\u00E9pondant \u00E0 la condition +condition+\n   * \n   * @param condition Methode qui doit retourner true pour que l'item soit retenu\n   * @param options   Table d'options {count: nombre attendu} \n   * @returns \n   */\n  findAll(condition: (item: T) => boolean, options: {[k:string]: any}){\n    return this.findAllAfter(condition, undefined, options);\n  }\n\n  // Idem que pr\u00E9c\u00E9dente mais permet de sp\u00E9cifier le premier \u00E9l\u00E9ment\n  findAllAfter(\n    condition: (item: T) => boolean,\n    id: string | undefined,\n    options: {[k:string]: any}\n  ) {\n    const collected: T[] = [];\n    let collected_count = 0;\n\n    let item: T | undefined ;\n    if ( id === undefined ) {\n      item = this.firstItem;\n    } else {\n      item = this.getNextItem(id);\n    }\n    do {\n      if ( item ) {\n        if (condition(item) === true ) { \n          collected.push(item);\n          collected_count ++ ;\n          if ( options.count && collected_count === options.count) { break ;}\n        }\n        item = this.getNextItem(item.id);\n      }\n    } while ( item ); \n    return collected ; \n  }\n\n  /**\n   * Peuplement de la table d'acc\u00E8s avec cr\u00E9ation des 'chainedItem'\n   * \n   * @param items Les \u00E9l\u00E9ments transmis, tels que relev\u00E9s dans les tables (Entry, Oeuvre, Exemple);\n   */\n  // M\u00E9thode qui \"initie\" la table d'acc\u00E8s en transformant chaque\n  // item (Entry, Oeuvre, Exemple) en un AccedableItem, en prenant\n  // son index et son index suivant pour les mettres dans la Map\n  // qui consignes les valeurs d'acc\u00E8s\n  populateInTable(items: T[]) {\n    this.keysMap = new Map();\n    this.arrayItems = [];\n    for (let i: number = 0, len = items.length; i < len; ++i) {\n      const item = items[i];\n      const nextItemId: string | undefined = items[i + 1]?.id || undefined;\n      const prevItemId: string | undefined = items[i - 1]?.id || undefined;\n      this.addInTable(item, i, nextItemId, prevItemId);\n    }\n  }\n\n  // Insertion s\u00E9par\u00E9e pour pouvoir ajouter en cours de travail\n  addInTable(\n    item: T, \n    arrayIndex:number, \n    nextItemId: string | undefined, \n    prevItemId: string | undefined\n  ): AccedableItem {\n    const chained: AccedableItem = {\n      type: 'accedable-item',\n      id: item.id,\n      obj: undefined,\n      index: arrayIndex,\n      next: nextItemId,\n      prev: prevItemId,\n      visible: true,\n      display: 'block',\n      selected: false,\n      modified: false\n    };\n     // console.log(\"[POPULATE ACCESSTABLE] ak = \", chained);\n    this.keysMap.set(item.id, chained);\n    this.arrayItems.push(item);\n    return chained;\n  }\n\n  DOMElementOf(id: string) {\n    return document.querySelector(`main#items > div[data-id=\"${id}\"]`) as HTMLDivElement;\n  }\n\n\n  /**\n   * \n   * \n   * ========== FONCTIONS SP\u00C9CIALIS\u00C9ES ==========\n   * \n   * \n   * \n   */\n  private get wordset(){\n    return this._wordset || (this._wordset = this.getListMotsForAutocomplete());\n  }\n  private _wordset?: {key: string, value: string, min: string}[];\n\n  /**\n   * @api\n   * \n   * M\u00E9thode filtrage des mots, pour l'autocompletion\n   * \n   * @param text Le texte recherch\u00E9 dans les entr\u00E9es\n   */\n  public filterWithText(text: string){\n    text = StringNormalizer.rationalize(text);\n    return this.wordset.filter((item: any) => item.min.startsWith(text));\n  }\n\n  /**\n   * Pour l'autocompl\u00E9tion dans le champ d\u00E9finition (et peut-\u00EAtre\n   * exemple, mais plus compliqu\u00E9) on a besoin de la liste des mots\n   * pr\u00E9par\u00E9es\n   * \n   */\n  getListMotsForAutocomplete(){\n    if ( this.firstItem.cachedData.itemType !== 'entry' ) { return [];}\n    /*\n    // Pour des essais simples\n    return [\n      {key: 'abandon', value: 'Abandon'},\n      {key: 'abime', value: 'Ab\u00EEme'},\n      {key: '\u00E7a', value: 'le \u00C7a'},\n      {key: '\u00E9t\u00E9', value: 'L\u2019\u00E9t\u00E9'}, \n      {key: 'eternel', value: \"\u00C9ternel\"}\n    ];\n    //*/\n    return this.map((item) => { \n      return {\n        key: item.id, \n        value: (item as EntryType).dbData.entree,\n        min: (item as EntryType).cachedData.entree_min_ra\n      } ;\n    });\n  }\n}", "import { PanelClient } from \"../PanelClient\";\nimport { App } from \"./App\";\n\nexport class Help {\n  /**\n   * D\u00E9finitions des aides contextuelles.\n   * Soit un simple string (si pas de raccourcis clavier)\n   * Soit un array [aide, {lettre: methode-string}] \n   */\n  static get(keyHelp: string): string |undefined {\n    switch(keyHelp){\n\n      // FEN\u00CATRE DE D\u00C9MARRAGE\n      case 'start': return `\n      ## D\u00E9marrage de l'extension\n\n      Pour commencer, activer le premier panneau (entr\u00E9es) avec \u23181.\n\n      \u00C0 tout moment, vous pouvez obtenir de l'aide contextuelle en tapant \"?\" (donc \"\u21E7,\").\n      \n      Les raccourcis de base, utilisable dans les trois panneaux, sont les suivants :\n\n      ${this.buildShortcutsTable([\n        {s: 's', m: 'NORMAL', d: 'Pour se placer dans le champ de filtre et filtrer la liste.'},\n        {s: 'n', m: 'NORMAL', d:'Pour cr\u00E9er un nouvel \u00E9l\u00E9ment.'},\n        {s: 'j', m: 'NORMAL', d: 'Pour s\u00E9lectionner l\u2019\u00E9l\u00E9ment suivant ou le premier.'},\n        {s: 'k', m: 'NORMAL', d: 'Pour remonter \u00E0 l\u2019\u00E9l\u00E9ment pr\u00E9c\u00E9dent'},\n        {s: 'b', m: 'NORMAL', d: '(comme \u00AB\u00A0back\u00A0\u00BB) Pour s\u00E9lectionner l\u2019\u00E9l\u00E9ment pr\u00E9c\u00E9demment s\u00E9lectionn\u00E9'},\n        {s: 'f', m: 'NORMAL', d: 'Pour repasser \u00E0 l\u2019\u00E9l\u00E9ment suivant de l\u2019historique des s\u00E9lections'},\n        {s: 'r', m: 'NORMAL', d: 'Pour retirer la s\u00E9lection de l\u2019historique des s\u00E9lections'},\n        {s: 'e', m: 'NORMAL', d: 'Pour mettre en \u00E9dition l\u2019\u00E9l\u00E9ment s\u00E9lectionn\u00E9.'},\n        {s: 'm', m: 'NORMAL', d: '(comme \u00AB mise en forme\u00A0\u00BB) pour mettre en forme le texte.'},\n        {s: 'Tab', m: 'NORMAL', d: 'pour passer de lien en lien (d\u00E9finition et exemple)'},\n        {s: '\u21E7Tab', m: 'NORMAL', d: 'Passer de lien en lien en remontant'},\n        {s: 'g', m: 'NORMAL', d: 'Rejoindre la cible du lien'},\n        {s: 'c', m: 'NORMAL', d: 'Pour se placer dans la console et jouer une commande.'},\n        {s: 'C (\u21E7c)', m: 'NORMAL', d: 'Choisir l\u2019entr\u00E9e s\u00E9lectionn\u00E9e pour le nouvel exemple d\u00E9j\u00E0 en \u00E9dition.'},\n        {s: 'E (\u21E7e)', m: 'NORMAL', d: 'Cr\u00E9er un nouvel exemple pour l\u2019entr\u00E9e.'},\n      ])}\n      \n      \u00C0 tout moment, taper **?** pour afficher l'aide contextuelle.\n      \n      ## Commandes\n\n      ${this.buildCommandsTable([\n        {c: 'openSupport', d:'\u2026 pour ouvrir le dossier support dans le Finder, qui contient la base et tous les backups.' },\n        {c: 'exportAllData', d: '\u2026 pour faire un export des donn\u00E9es dans quatre formats, JSON, YAML, CSV et Simple Text.'},\n        {c: 'exportAntidote', d: '\u2026 pour faire une sortie du texte sans aucun balisage, pour correction Antidote'},\n        {c: 'exportLecture', d: '\u2026 pour une sortie du texte sans balisage, pour simple relecture (= exportAntidote)'},\n        {c: 'exportPFB', d: '\u2026 pour une sortie compl\u00E8te pour Prawn-for-book'},\n      ])}\n\n      ## \u00C9dition de la d\u00E9finition\n\n      ### Autocompl\u00E9tion\n\n\n      ${this.buildShortcutsTable([\n        {s: 'tt\u21E5', m:'EDIT', d: 'Mot technique format\u00E9 et index\u00E9'},\n        {s: '->(\u21E5', m:'EDIT', d: 'Mot technique format\u00E9, index\u00E9 avec num. de page'},\n        {s: 'idx\u21E5', m:'EDIT', d: 'Mot technique index\u00E9, non format\u00E9'},\n        {s: 'erm(\u21E5', m:'EDIT', d: 'Mot technique format\u00E9, non index\u00E9'},\n      ])}\n\n\n      ### Insertion d'un exemple (existant)\n\n\n      Avec l'item en \u00E9dition et le curseur plac\u00E9 au bon endroit, rejoindre le panneau des exemples (\u23183), filtrer pour n'afficher que le film (<shortcut>s</shortcut> puis 1res lettres), s\u00E9lectionner l'exemple voulu (<shortcut>j</shortcut>/<shortcut>k</shortcut>) et enfin tapez <shortcut>i</shortcut> (comme \u00AB\u00A0identifiant\u00A0\u00BB ou \u00AB\u00A0ins\u00E9rer\u00A0\u00BB).\n\n      Automatiquement, l'identifiant de l'exemple sera ins\u00E9r\u00E9 dans l'entr\u00E9e \u00E9dit\u00E9e.\n      `\n      ;\n\n      // CR\u00C9ATION D'UN \u00C9L\u00C9MENT QUELCONQUE\n      case 'create-element': return `\n      ## Cr\u00E9ation d'un \u00E9l\u00E9ment\n      \n      Vous pouvez vous placer de champ en champ avec les touches \n      <shortcut>a</shortcut>, <shortcut>b</shortcut>, etc. ou la touche \n      tabulation.`;\n\n      // CR\u00C9ATION D'UNE OEUVRE\n      case 'create-oeuvre': return `\n      ## Cr\u00E9ation d'une \u0153uvre\n\n      Jouer la touche <shortcut>n</shortcut> pour cr\u00E9er le nouvel \u00E9l\u00E9ment.\n\n      Une fois le titre rentr\u00E9, gr\u00E2ce \u00E0 la touche <shortcut>i</shortcut>, vous \n      pouvez obtenir les infos qu'on peut trouver sur le net. En pr\u00E9cisant l'ann\u00E9e \n      (approximative), la langue et/ou le pays, vous pouvez \u00EAtre presque certain \n      de trouver l'\u0153uvre du premier coup.\n\n      L'ann\u00E9e (approximative \u00E0 10 ans pr\u00E8s) se met dans le champs d\u00E9die, la langue \n      et le pays peuvent s'indiquer dans le champs 'notes' sous la forme JSON. Par \n      exemple <code>{\"langue\": \"en\", \"pays\": \"us\"}</code>.\n\n      Ensuite, TMDB renvoie la liste de toutes les \u0153uvres correspondantes qu'il a \n      trouv\u00E9 et les passe en revue pour choisir laquelle garder. \u00C7a se fait en deux \n      temps\u00A0:\n\n      - rel\u00E8ve de toutes les \u0153uvres, d'un coup, avec infos minimales,\n      - on fait un tri par rapport \u00E0 celles-ci,\n      - TMDB rel\u00E8ve les informations compl\u00E8tes (principalement les cr\u00E9dits),\n      - On choisit celle qui correspond vraiment.\n      `;\n\n      // \u00C9DITION D'UN \u00C9L\u00C9MENT\n      case 'edit-element': return `\n      ## \u00C9dition d'un \u00E9l\u00E9ment\n      \n      Vous pouvez aller de champ en champ avec les touches-raccourcis indiqu\u00E9es en regard de chaque champ.\n      `;\n\n      // \u00C9DITION D'UNE OEUVRE\n      case 'edit-oeuvre': return `\n      ## \u00C9dition d'une \u0153uvre\n\n      D\u00E9placez-vous de champ en champ avec la touche tabulation ou en jouant \n      les lettres en regard des champs.\n      `;\n    }\n  }\n  /**\n   * Pour construire une table de commande \n   * \n   * @param shortcuts D\u00E9finition des commandes\n   * @returns  La table HTML\n   */\n  private static buildCommandsTable(commands: {c: string, d: string}[]): string{\n    const rows: string[] = [];\n    rows.push('<tr><td>Commande</td><td>Effet</td></tr>');\n    commands.forEach(sc => rows.push(`<tr><td>${sc.c}</td><td>${sc.d}</td></tr>`));\n    return '<table class=\"commands\">' + rows.join('') + '</table>';\n  }\n\n  /**\n   * Pour construire une table de raccourcis-clavier\n   * \n   * @param shortcuts D\u00E9finition des raccourcis\n   * @returns  La table HTML\n   */\n  private static buildShortcutsTable(shortcuts: {s: string, m: string, d: string}[]): string{\n    const rows: string[] = [];\n    rows.push('<tr><td>Racc.</td><td>MODE</td><td>Effet</td></tr>');\n    shortcuts.forEach(sc => rows.push(`<tr><td><shortcut>${sc.s}</shortcut></td><td>${sc.m}</td><td>${sc.d}</td></tr>`));\n    return '<table class=\"shortcuts\">' + rows.join('') + '</table>';\n  }\n\n\n  constructor(private panel: PanelClient<any>) {\n  }\n  /**\n   * API\n   * M\u00E9thode activant l'aide circonstantielle.\n   * (voir le manuel)\n   */\n  public activateContextualHelp(){\n    const context = this.panel.context;\n    const extraParams = this.affineContexte(context);\n    const [content, KbBypass] = this.defineCHelp(context, extraParams);\n    this.showCHelp(content);\n    this.panel.keyManager.keyboardBypass = KbBypass;\n  }\n\n  private affineContexte(context: string): Record<string, any> | undefined {\n    switch(context) {\n      case 'create-new-element': \n        // il faut voir si l'user est au d\u00E9but ou \u00E0 la fin\n        return {};\n      default: return;\n    }\n  }\n\n  private defineCHelp(context:string, params: Record<string, any> | undefined): [string, Map<string, any>] {\n    const kbb = new Map();\n    kbb.set('q', this.closeCHelp.bind(this));\n    let bypass: {[x:string]: any};\n    let content: string | undefined = Help.get(context);\n    if (content) {\n      return [this.formate(content) as string, kbb];\n    } else { return ['', kbb]; }\n  }\n\n  formate(str: string): string {\n    // console.log(\"-> formate (formatage du texte d'aide\", str);\n   return str\n      // Pour \"compacter\" les codes HTML de paragraphe, table, etc.\n      .trim()\n      .replace(/^\\s+/gm, '')\n      .replace(/>\\n+/g, '>')\n      .replace(/\\n+<\\//g, '</')\n      .replace(/\\*\\*(.+?)\\*\\*/g, '<b>$1</b>')\n      .replace(/\\*(.+?)\\*/g, '<em>$1</em>')\n      .replace(/^### (.+)$/mg, '<h3>$1</h3>')\n      .replace(/^## (.+)$/mg, '<h2>$1</h2>')\n      .replace(/^# (.+)$/mg, '<h1>$1</h1>')\n      .split(\"\\n\\n\")\n      .map(s => {\n        // console.log(\"Segment: \", s);\n        if (s.startsWith('<')){return s;}\n        else {return `<p>${s}</p>`;}\n      })\n      .join('');\n  }\n  /**\n   * Affichage du texte d'aide contextuelle et mise en attente\n   * \n   * (note : le \"C\" de \"Chelp\" pour \"contextual\")\n   * \n   * @param content Le contenu textuel \u00E0 afficher\n   */\n  private showCHelp(content: string) {\n    this.CHbuilt || this.CHbuild();\n    this.CHObj.classList.remove('hidden');\n    const divCont = (this.CHObj.querySelector('.content') as HTMLElement);\n    divCont.innerHTML = content;\n  }\n  private CHObj!: HTMLDivElement;\n  private CHbuilt: boolean = false;\n\n  public closeCHelp(){\n    this.CHObj.classList.add('hidden');\n  }\n  \n  // Construction du div de l'aide contextuelle\n  CHbuild(){\n    let o = document.createElement('div');\n    o.className = \"aide-contextuelle hidden\";\n    let cont = document.createElement('div');\n    cont.className = 'content';\n    o.appendChild(cont);\n    let btns = document.createElement('div');\n    btns.className = 'buttons';\n    btns.innerHTML = 'q: quitter l\u2019aide';\n    o.appendChild(btns);\n    document.body.appendChild(o);\n    this.CHObj = o;\n    this.CHbuilt = true;\n  }\n}", "export const listen = function(element: HTMLElement, evType: keyof HTMLElementEventMap, method: (this: HTMLElement, ev: HTMLElementEventMap[typeof evType]) => any): void {\n element.addEventListener(evType, method); \n};\n\nexport const stopEvent = function(ev: any): false {\n  ev.preventDefault();\n  ev.stopImmediatePropagation();\n  return false;\n};", "import { AnyDbType, AnyItemType } from \"../../bothside/types\";\nimport { Entry } from \"../models/Entry\";\nimport { EntryForm } from \"../models/EntryForm\";\nimport { PanelClient } from \"../PanelClient\";\nimport { AccessTable } from \"./AccessTable\";\nimport { stopEvent } from \"./DomUtils\";\nimport { FormManager } from \"./FormManager\";\nimport { SelectionManager } from \"./SelectionManager\";\n\ntype MODES = 'normal' | 'edit' | 'null' | 'form' | 'console' ;\n\nexport class VimLikeManager {\n  // \n  /**\n   * MODE DU PANNEAU\n   * \n   * Pour le moment, le panneau peut \u00EAtre dans deux \u00E9tats, en\n   * fonction du fait que le curseur se trouve dans un champ\n   * \u00E9ditable ou non.\n   */\n  protected _keylistener: (ev: KeyboardEvent) => true | false | undefined | void;\n  protected _mode: MODES = 'normal' ; \n  protected get mode() { return this._mode ; }\n  private form: FormManager<AnyItemType, AnyDbType>;\n  public setMode(mode: MODES) { this.mode = mode; }\n  protected set mode(mode: MODES) { // de l'ext\u00E9rieur, utiliser la m\u00E9thode setMode \n    // console.info(\"[VimLikeManager mode] Mise du mode \u00E0 '%s')\", mode);\n    this._mode = mode ;\n    // Le mode d\u00E9termine le capteur d'\u00E9v\u00E8nement\n    switch(mode) {\n      case 'console':\n        this._keylistener = this.onKeyDownModeConsole.bind(this);\n        break;\n      case 'edit':\n        // console.log(\"[VimLikeManager.mode] Passage du mode clavier au mode edit\");\n        this._keylistener = this.onKeyDownModeEdit.bind(this);\n        break;\n      case 'normal':\n        // console.log(\"[VimLikeManager.mode] Passer le mode clavier en mode NORMAL\");\n        this._keylistener = this.onKeyDownModeNormal.bind(this);\n        break;\n      case 'null':\n        // console.log('Le panneau est en mode NULL (sans action');\n        this._keylistener = this.onKeyDownModeNull.bind(this);\n        break;\n      case 'form':\n        // console.log(\"Panneau en mode FORMulaire\");\n        this._keylistener = this.onKeyDownModeForm.bind(this);\n        break;\n    }\n    // Indiquer dans l'interface le mode\n    this.root.dataset.mode = `mode-${mode}` ;\n    \n    if (this.root.querySelector('span#mode-name')){\n      const spanName = this.root.querySelector('span#mode-name') as HTMLSpanElement;\n      spanName.innerHTML = mode.toLocaleUpperCase();\n    } else {\n      console.warn(\"Bizarrement, le span #mode-name affichant le mode du panneau est introuvable.\");\n    }\n  }\n\n  readonly searchInput: HTMLInputElement;\n  readonly consoleInput: HTMLInputElement;\n\n  constructor(\n    private root: HTMLBodyElement, \n    private panel: PanelClient<AnyItemType>, \n    private klass: any,\n  ) {\n    this.mode = 'null';\n    this.loadConsoleManager(); // Promise\n    // @DEPRECATED Il faut \u00EAtre plus pr\u00E9cis. Si on fait \u00E7a, dans le formulaire\n    // le mode est toujours remis au mode normal et edit\n    // this.root.addEventListener('focusin', this.onFocusIn.bind(this));\n    // this.root.addEventListener('focusout', this.onFocusOut.bind(this));\n\n    this.form = this.panel.form; // cached\n\n    // Pour placer une capture \"universelle\", c'est-\u00E0-dire qui capture les keydown\n    // quel que soit le mode courant\n    this.root.addEventListener('keydown', this.universelKeyboardCapture.bind(this), true);\n    // La m\u00E9thode qui capture les touches et les renvoie vers la m\u00E9thode appropri\u00E9e\n    // en fonction du mode.\n    this.root.addEventListener('keydown', this.onKeyDown.bind(this));\n    this._keylistener = this.onKeyDownModeNull.bind(this);\n    this.searchInput = this.root.querySelector('input#search-input') as HTMLInputElement;\n    this.consoleInput = this.root.querySelector('input#panel-console') as HTMLInputElement;\n    this.searchInput.addEventListener('focus', this.onFocusEditField.bind(this, this.searchInput));\n    this.searchInput.addEventListener('blur', this.onBlurEditField.bind(this, this.searchInput));\n    this.consoleInput.addEventListener('focus', this.onFocusConsole.bind(this, this.consoleInput));\n    this.consoleInput.addEventListener('blur', this.onBlurConsole.bind(this, this.consoleInput));\n  }\n\n  onFocusConsole(field: HTMLInputElement, ev: FocusEvent) {\n    this.setMode('console');\n  }\n  onBlurConsole(field: HTMLInputElement, ev: FocusEvent){\n    this.setMode('normal');\n  }\n  onFocusEditField(field: HTMLInputElement, ev: FocusEvent) {\n    this.setMode('edit');\n  }\n  onBlurEditField(field: HTMLInputElement, ev: FocusEvent ) {\n    // console.log(\"-> onBlurEditField\");\n    this.setMode('normal');\n    // console.log(\"<- onBlurEditField\");\n  }\n  keyboardBypass:Map<string, Function> | undefined;\n  // La m\u00E9thode qui choppe normalement toutes les touches, quel que soit le mode\n  /**\n   * Capteur Universel de Touche clavier\n   * \n   * Quel que soit le mode, cette m\u00E9thode re\u00E7oit les touches clavier\n   * avant tout le monde.\n\n   * Cela permet : \n   *    - d'impl\u00E9menter un syst\u00E8me de \"coupe-circuit\" qui est\n   *      utilis\u00E9 par exemple pour les messages de type \"action \n   *      demand\u00E9e\". (voir le manuel pour le d\u00E9tail). \n   *    - d'impl\u00E9menter la gestion de touche \"?\" qui permet, quelle\n   *      que soit la situation, d'obtenir de l'aide.\n   */\n  universelKeyboardCapture(ev: KeyboardEvent) {\n    // Pour voir toutes les touches qui sont press\u00E9es, toutes\n    // console.log(\"[universel capture (mode %s)] Key up = \", this.mode, ev.key, ev);\n\n    if ( ev.key === '?' ) {\n      // <= L'user a tap\u00E9 la touche '?'\n      // => On doit afficher l'aide circonstantielle (voir le manuel)\n      //    (m\u00EAme quand on est dans l'ide circonstantielle)\n      this.panel.activateContextualHelp();\n      return stopEvent(ev); \n    } else if ((ev.target as HTMLElement).tagName.toLowerCase() === 'select') {\n      const select = ev.target as HTMLSelectElement;\n      switch(ev.key) {\n        case 'j':\n        case 'ArrowDown': // Sur les menus <select>\n          select.selectedIndex += 1;\n          break;\n        case 'k':\n        case 'ArrowUp': // Sur les menus <select>\n          select.selectedIndex -= 1;\n          break;\n      }\n      return true;\n    } else if (this.keyboardBypass) {\n      // <= Un bypass existe (bloquant toutes les touches)\n      // => Il faut voir si la touche est connue\n      if (this.keyboardBypass.has(ev.key)) {\n        /* Ici, c'est un peu compliqu\u00E9, car il faut d\u00E9truire le bypass\n         * avant de jouer la m\u00E9thode car cette m\u00E9thode pourrait\n         * red\u00E9finir un autre coupe-circuit \u00E0 prendre en compte\n         */\n        const methodBypass = (this.keyboardBypass as Map<string, any>).get(ev.key);\n        // console.log('methodBypass dans VimLike', methodBypass);\n        delete this.keyboardBypass;\n        // Attention, ci-dessous, j'ai peut-\u00EAtre un souci de niveau\n        // du \"effacer avant de jouer la m\u00E9thode bypass ou effacer\n        // apr\u00E8s ?\" Si j'ai plusieurs flashAction qui se suivent, il\n        // faut effacer avant. V\u00E9rifier si dans d'autres cas, c'est\n        // le contraire et voir comment on peut faire.\n        this.panel.cleanFlash();\n        this.panel.cleanFooterShortcuts(); // Les raccourcis ont pu y \u00EAtre affich\u00E9s\n        methodBypass(); \n      }\n      // Dans tous les cas on bloque la touche et on supprime le\n      // coupe-circuit clavier\n      return ev && stopEvent(ev);\n    }\n    return true;\n  }\n\n  /**\n   * API\n   * M\u00E9thode de discrimination dans l'objet +obj+. Tous les champs qu'il contient\n   * qui sont des champs d'\u00E9dition textuels vont faire basculer dans le mode :editMode\n   * quand ils sont focusser et le mode :normalMode (souvent 'normal') quand on va\n   * les blurer \n   * \n   * @param obj {HTMLElement} Bloc contenant les champs d'\u00E9dition\n   * @param modes {Hash} Table d\u00E9finisssant :edit et :normal pour savoir le nom des\n   * modes \u00E0 utiliser en \u00E9dition (dans un champ \u00E9ditable) et hors \u00E9dition.\n   */\n  discrimineFieldsForModeIn(obj: HTMLElement, modes: {edit: MODES, normal: MODES}) {\n    const selectors = 'input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], textarea, [contenteditable]';\n    obj.querySelectorAll(selectors).forEach(field => {\n      // console.log(\"Discrimination du champ \", field);\n      field.addEventListener('focus', this.setMode.bind(this, modes.edit));\n      field.addEventListener('blur', this.setMode.bind(this, modes.normal));\n    });\n  }\n\n  // Sera remplac\u00E9 par la bonne m\u00E9thode suivant le mode.\n  onKeyDown(ev: KeyboardEvent) { \n    return this._keylistener(ev);\n  }\n\n  /**\n   * ============ TOUS LES MODES DE CLAVIER ================\n   */\n\n  // Quand la touche meta est press\u00E9e, on passe toujours par l\u00E0\n  onKeyDownWithMeta(ev: KeyboardEvent) {\n    switch(ev.key) {\n      case 'q': case 'Q':\n        stopEvent(ev);\n        console.log(\"On ne peut pas quitter comme \u00E7a\u2026\");\n        break;\n      case 's': case 'S':\n        stopEvent(ev);\n        console.log(\"Demande de sauvegarde forc\u00E9e.\");\n        break;\n    }\n  }\n  private get accessTable(): AccessTable<AnyItemType>{\n    return this._accesstable || (this._accesstable = this.klass.accessTable);\n  }\n  private get selectionManager(): SelectionManager {\n    return this._selmanager || (this._selmanager = this.accessTable.selectionManager);\n  } \n  private _accesstable!: AccessTable<AnyItemType>;\n  private _selmanager!: SelectionManager;\n  \n  onKeyDownModeNormal(ev: KeyboardEvent) {\n    // console.log(\"-> VimLikeManager.onKeyDownModeNormal\", ev.key, ev);\n    if (ev.metaKey) { return this.onKeyDownWithMeta(ev); }\n    stopEvent(ev);\n    switch (ev.key) {\n      case 's': // focus dans champ de filtre\n        this.searchInput.focus(); break;\n      case 'j': // S\u00E9lection item apr\u00E8s\n        this.selectionManager.selectNextVisibleItem(); break;\n      case 'k': // S\u00E9lection item avant\n        this.selectionManager.selectPreviousVisibleItem(); break;\n      case 'b': // back to s\u00E9lection pr\u00E9c\u00E9dente\n        this.selectionManager.historyBack(); break;\n      case 'f': // forward to s\u00E9lection pr\u00E9c\u00E9dentes\n        this.selectionManager.historyNext();break;\n      case 'i': // pour obtenir l'identifiant (surtout un exemple)\n        this.klass.sendIdCurrentToDefinition();break;\n      case 'r': // remove courante s\u00E9lection from historique s\u00E9lections\n      this.selectionManager.removeCurrentFromHistory();break;\n      case 'c': // focus dans console\n        this.consoleInput.focus(); break;\n      case 'e':\n        if ( this.panel.getSelection() ) {\n          this.klass.editItem(this.panel.getSelection() as string);\n        } else { console.log(\"Pas de s\u00E9lection \u00E0 \u00E9diter\");}\n        break;\n      case 'n':\n        this.klass.createNewItem();\n        break;\n      case 'Tab':\n        this.panel.nextLinkSelection(ev.shiftKey);\n        break;\n      case 'g': \n        this.panel.activeLinkSelection();\n        break;\n      default: \n         // Le panneau peut aussi d\u00E9finir sa propre table\n        if (this.panel.tableKeys[ev.key]) {this.panel.tableKeys[ev.key].fn.call(null);}\n        else {\n          console.log(\"Pour le moment, je ne fais rien de '%s'\", ev.key);\n        }\n    }\n    return false;\n  }\n\n  /**\n   * Gestionnaire des touches de clavier en mode EDIT (dans un\n   * champ d'\u00E9dition) \n   */\n  onKeyDownModeEdit(ev: KeyboardEvent) {\n    if ( ev.metaKey ) { return this.onKeyDownWithMeta(ev) ; }\n    switch(ev.key) {\n      case 'Tab':\n        const last3 = this.threelast.join('');\n        switch(last3){\n          case 'dim':\n            ev.stopPropagation();\n            return this.klass.autocompleteDim(ev);\n          case 'tt(': return this.autoCompleteBaliseTerm('tt(', ev);\n          case 'rm(': return this.autoCompleteBaliseTerm('tt(', ev);\n          case 'tp(':return this.autoCompleteBaliseTerm('tt(', ev);  \n\n          default: \n            if (last3.startsWith('xx')){\n              this.executeShortcutInEditField(last3.substring(2, 3), (ev.target) as HTMLTextAreaElement | HTMLInputElement);\n              return stopEvent(ev);\n            }\n        }\n        \n        switch(this.twolast.join('')){\n          case '>(': return this.autoCompleteBaliseTerm('->(', ev);\n          case 'tp': return this.autoCompleteBaliseTerm('ttp', ev);\n          case 'tt': return this.autoCompleteBaliseTerm('tt', ev);\n        }\n            //*/\n        (ev.target as HTMLElement).blur();\n        return stopEvent(ev);\n      default:\n        // console.log(\"Touche non trait\u00E9e : %s\", ev.key);\n    }\n    // Pour toujours conserver les trois derni\u00E8res lettres\n    this.threelast.shift();\n    this.threelast.push(ev.key);\n    // Pour toujours conserver les deux derni\u00E8res touches\n    this.twolast.shift();\n    this.twolast.push(ev.key);\n    // console.log(\"Deux derni\u00E8res lettres = '%s'\", this.twolast.join(''));\n    return true;\n\n  }\n\n  /**\n   * Fonction appel\u00E9e quand on table 'xx<lettre>' dans un champ de\n   * texte, avec <lettre> qui est un raccourci-clavier.\n   * \n   * @param lettre Le raccourci clavier (une lettre)\n   * @param target Le textarea dans lequel a \u00E9t\u00E9 jou\u00E9 le code xx<lettre>\n   */\n  private executeShortcutInEditField(lettre: string, target: HTMLTextAreaElement | HTMLInputElement){\n    switch(lettre){\n      case 'p':\n        // Il faut coller le texte du presse-papier au curseur\n        if ( target.id === 'entry-definition') {\n          (this.panel.form as EntryForm).insertInTextField('definition', this.panel.clipboard.paste(), 3);\n        } else {\n          console.error(\"Je ne sais pas paster dans le champ\", target);\n        }\n        break;\n      default:\n        console.warn('Je ne sais pas quoi faire du shortcut \"%s\"', lettre);\n    }\n  }\n\n  private autoCompleteBaliseTerm(balise: string, ev: Event){\n    ev.stopPropagation();\n    return this.klass.autoCompleteBaliseTerm('tt', ev);\n  }\n  private twolast: [string, string] = ['', ''];\n  private threelast: [string, string, string] = ['', '', ''];\n\n  // Mode clavier pour la console\n  private consoleManager!: any; // Instance ConsoleManager;\n  onKeyDownModeConsole(ev: KeyboardEvent){\n    switch(ev.key) {\n      case 'Enter':\n        this.consoleManager.runCode();\n        break;\n      case 'ArrowDown':\n        this.consoleManager.forwardHistory();\n        break;\n      case 'ArrowUp':\n        this.consoleManager.backHistory();\n        break;\n      default:\n        console.log(\"Console. Lettre %s\", ev.key);\n    }\n  }\n  async loadConsoleManager(){\n    const module = await import('../ConsoleManager');\n    this.consoleManager = new module.ConsoleManager(this.panel);\n  }\n\n  // Mode clavier pour le formulaire\n  onKeyDownModeForm(ev: KeyboardEvent) {\n    // console.log(\"-> onKeyDownModeForm\", ev);\n    // Pour emp\u00EAcher toute action pendant la sauvegarde\n    if ( this.form.saving === true ) { return; }\n    if (ev.metaKey) { return this.onKeyDownWithMeta(ev); }\n    switch (ev.key) {\n      case 'a': // focusser dans premier champ (avec shortcut)\n        this.form.focusField(1); break;\n      case 'b': // focusser dans le second champ\n        this.form.focusField(2); break;\n      case 'c': // focusser dans le 3e champ\n        this.form.focusField(3); break;\n      case 'd': // focusser dans le 4e champ\n        this.form.focusField(4); break;\n      case 'e': // focusser dans le 5e champ\n        this.form.focusField(5); break;\n       case 'f': // focusser dans le 6e champ\n        this.form.focusField(6); break;\n      case 'g':\n        this.form.focusField(7); break;\n      case 'l': // Bloquer/d\u00E9bloquer le verrouillage de l'id\n        this.form.toggleIdLock(); break;\n      case 's': // Sauvegarder\n        this.form.saveItem(false); break;\n      case 'w': // \n        this.form.saveItem(true); break;\n      case 'q': // Annuler\n        this.form.cancelEdit(); break;\n     default:\n        // Le formulaire peut d\u00E9finir une table `tableKeys' pour\n        // d\u00E9finir les fonctions \u00E0 appeler par touche\n        if (this.form.tableKeys[ev.key]) {this.form.tableKeys[ev.key].fn.call(null);}\n    }\n    // On annule l'\u00E9v\u00E8nement\n    return stopEvent(ev);\n  }\n  \n  onKeyDownModeNull(ev: KeyboardEvent) {\n    console.error(\"Il faut activer un mode de clavier\");\n    return stopEvent(ev);\n  }\n\n  // @return true si la cible de l'\u00E9v\u00E8nement +ev+ est un champ \u00E9ditable\n  targetEventIsEditable(ev: any) : boolean {\n    return (ev.target as HTMLElement).matches('input, textarea, [contenteditable]');\n  }\n}", "declare global {\n  interface Map<K, V> {\n    firstValue(): this,\n  }\n}\n\nMap.prototype.firstValue = function(){\n  for(var v of this.values()){ return v; }\n};\n\nexport {};", "import { AnyItemType } from \"../../bothside/types\";\nimport { PanelClient } from \"../PanelClient\";\n\nexport class ClipboardManager<T extends AnyItemType>{\n\n  // La liste qui contient tout ce qui a \u00E9t\u00E9 mis dans le\n  // presse-papier.\n  private container: string[] = [];\n  private size: number = 0;\n\n  constructor(\n    private panel: PanelClient<T>\n  ){\n    this.container = [];\n  }\n\n  add(foo: any) {\n    this.container.push(foo);\n    if (this.container.length > 100) { this.container.shift(); }\n    else { ++this.size; }\n  }\n  paste(){\n    // Pour le moment, on prend toujours le dernier\n    // \u00E0 l'avenir, il sera possible de choisir un \u00E9l\u00E9ment en particulier\n    return this.container[this.size - 1];\n  }\n}", "import { Entry } from \"./models/Entry\";\nimport { Exemple } from \"./models/Exemple\";\nimport { Oeuvre } from \"./models/Oeuvre\";\nimport { AccedableItem, AccessTable } from \"./services/AccessTable\";\nimport { FormManager } from \"./services/FormManager\";\nimport { Help } from \"./services/HelpManager\";\nimport { VimLikeManager } from \"./services/VimLikeManager\";\nimport \"../bothside/class_extensions\";\nimport { AnyItemType } from \"../bothside/types\";\nimport { stopEvent } from \"./services/DomUtils\";\nimport { ClipboardManager } from \"./services/ClipboardManager\";\n\n\nexport type FlashMessageType = 'notice' | 'warn' | 'error' | 'action';\n\ninterface PanelConstructorData {\n  minName: string;\n  titName: string;\n  klass: typeof Entry | typeof Oeuvre | typeof Exemple;\n  form: any; // gestionnaire de formulaire\n}\n\nexport class PanelClient<T extends AnyItemType> {\n  \n  // ========== A P I ================\n\n  public tableKeys: Record<string, {lab: string, fn: Function}> = {}; // shortcuts propres aux panneaux\n  public context: string = 'start';\n  public form!: FormManager<any, any>;\n  public get isActif(): boolean { return this._actif === true ; }\n  public get isInactif(): boolean { return this._actif === false ; }\n  public get keyManager(){ return this._keyManager; }\n  // Pour marquer le panneau actif ou inactif\n  public activate() { \n    this.setPanelFocus(true); \n    // Si un formulaire \u00E9tait actif, il faut repasser en mode 'form'\n    if (this.form.isActive()) {\n      this.form.__onFocusOnForm(undefined);\n      this.keyManager.setMode('form');\n    } else {\n      this.keyManager.setMode('normal');\n    }\n\n  }\n  public desactivate() { this.setPanelFocus(false); }\n\n  /**\n   * M\u00E9thode puissante permettant d'attendre une r\u00E9action de l'utilisateur en affichant un \n   * message. Typiquement, c'est le \"Pour faire \u00E7a, tapez 1, pour faire \u00E7a, tapez 2\".\n   * \n   * Noter que \u00E7a n'est pas une m\u00E9thode asynchrone. Si on l'utilise, c'est \u00E0 l'ancienne, en\n   * arr\u00EAtant le flux apr\u00E8s elle.\n   * \n   * @param msg Le message \u00E0 afficher\n   * @param buttons La table des raccourcis/fonctions qui doivent court-circuiter le fonctionnement\n   *    Ils peuvent avoir deux formes : \n   *    - seulement la fonction buttons.set('<touche>', this.<fonction>.bind(this))\n   *    - le message et la fonction : buttons.set('<touche>', ['le message', this.<fonction>.bind(this)])\n   *      Dans ce dernier cas, le message sera affich\u00E9 au-dessus et les boutons sous la console, dans la\n   *      partie des outils du panneau.\n   */\n  public flashAction(msg: string, buttons: Map<string, any>) {\n    let realButtons = buttons;\n    this.flash(msg, 'action');\n    if (Array.isArray(buttons.firstValue())) {\n      realButtons = new Map();\n      const outils: string[] = [];\n      buttons.forEach((ary: any, lettre: string ) => {\n        const [ordre, fonction] = ary;\n        outils.push(`<shortcut>${lettre}</shortcut> ${ordre}`);\n        realButtons.set(lettre, fonction);\n      });\n      // console.log(\"outils\", outils);\n      // On \u00E9crit les raccourcis dans le pied de page\n      const o = document.createElement('div');\n      o.id = 'footer-shortcuts';\n      o.innerHTML = outils.join('&nbsp;&nbsp;');\n      this.footer.appendChild(o); \n    } \n    // On donne les boutons au manager de clavier\n    this.keyManager.keyboardBypass = realButtons;\n  }\n\n\n  /**\n   * Affichage d'un message en haut du panneau.\n   * \n   * @param msg Le message\n   * @param type Le type de message\n   */\n  public flash(msg:string, type: FlashMessageType) {\n    const msgbox = this.messageBox;\n    const o = document.createElement('div');\n    o.className = type;\n    o.innerHTML = msg;\n    msgbox.appendChild(o);\n    msgbox.style.zIndex = '10';\n    msgbox.style.opacity = '1';\n    if ( type === 'notice' ) {\n      // Temporiser le message\n      setTimeout(() => { this.cleanFlash.call(this); }, 10 * 1000);\n    } else if ( type === 'action' ) {\n      // Bloquer le message avec quelques lettres possibles seulement\n    } else {\n      // Sinon, on clique le message pour le fermer\n      o.addEventListener('click', (ev: MouseEvent) => { this.cleanFlash(); });\n    }\n  }\n  public cleanFlash(){ \n    const msgbox = this.messageBox;\n    msgbox.innerHTML = '';\n    msgbox.style.zIndex = '-1';\n    msgbox.style.opacity = '0.6';\n  }\n  public cleanFooterShortcuts(){\n    if ( this.footer.querySelector('div#footer-shortcuts')){\n      (this.footer.querySelector('div#footer-shortcuts') as HTMLElement).remove();\n    }\n  }\n\n  public activateContextualHelp() {\n    this.help.activateContextualHelp();\n  }\n  \n  // ========== M\u00C9THODES D'\u00C9L\u00C9MENT =============\n\n  public getSelection(){ return this.accessTable.getSelection() ; }\n\n  /**\n   * Permet de s\u00E9lectionner avec les tabulations les liens se trouvant \n   * dans le texte (d\u00E9finition pour les entr\u00E9es et content pour les\n   * exemples). Pour permettre de faire Tab+Tab+Tab+Entr\u00E9e pour \n   * rejoindre un lien\n   * \n   * On tient \u00E0 jour une table qui permet de conserver l'indice du \n   * lien derni\u00E8rement s\u00E9lectionn\u00E9.\n   * \n   * @param withMaj Pour savoir si la touche est press\u00E9e (pour remonter les liens)\n   * \n   */\n  public nextLinkSelection(withMaj: boolean){\n    const itemId: string | undefined = this.getSelection();\n    if (itemId === undefined) { return ;}\n    const obj = this.accessTable.getObj(itemId);\n    const ak = this.accessTable.getAccKey(itemId);\n    const links = obj.querySelectorAll('a');\n    if (links.length === 0){ return this.flash('Aucun lien dans cet \u00E9l\u00E9ment\u2026', 'notice'); }\n    let nextSelLink = ak.lastSelectedLink || 0;\n    nextSelLink += withMaj ? -1 : +1;\n    if (nextSelLink === -1) { nextSelLink = links.length; } \n    else if (nextSelLink < 0){ nextSelLink = links.length;} // simple s\u00E9curit\u00E9\n    else if (nextSelLink > links.length) { nextSelLink = 1;}\n    // On d\u00E9selectionne \u00E9ventuellement le dernier lien s\u00E9lectionn\u00E9\n    if (ak.lastSelectedLink){ links[ak.lastSelectedLink -1].classList.remove('current');}\n    const link = links[nextSelLink -1]; \n    link.classList.add('current');\n    ak.lastSelectedLink = nextSelLink;\n    this.flash('Presser \"g\" (comme \"go\") pour rejoindre le lien s\u00E9lectionn\u00E9.', 'notice');\n  }\n  \n  /**\n   * Pour activer le lien s\u00E9lectionn\u00E9 (simuler donc un clique de souris)\n   * (note : \u00E7a se fait avec la touche 'g' comme 'go')\n   */\n  activeLinkSelection(){\n    const itemId: string | undefined = this.getSelection();\n    if (itemId === undefined) { return this.flash('Aucune s\u00E9lection => aucun lien \u00E0 activer\u2026', 'notice'); }\n    const obj = this.accessTable.getObj(itemId);\n    const ak = this.accessTable.getAccKey(itemId);\n    const links = obj.querySelectorAll('a');\n    if (links.length === 0){ return this.flash('Aucun lien dans cet \u00E9l\u00E9ment\u2026', 'notice'); }\n    if (!ak.lastSelectedLink){ return this.flash('Aucun lien n\u2019a \u00E9t\u00E9 s\u00E9lectionn\u00E9\u2026', 'warn');}\n    const selLink = ak.lastSelectedLink ;\n    const alink = links[selLink -1];\n    this.onClickALink(alink);\n  }\n\n  // Re\u00E7oit le click de souris sur un lien dans le texte ou peut \u00EAtre directement \n  // appel\u00E9e pour simuler ce clic.\n  public onClickALink(alink: HTMLElement, ev: KeyboardEvent | undefined = undefined) {\n    console.log(\"Link cliqu\u00E9 depuis texte format\u00E9\", ev);\n    const method: string = String(alink.dataset.method);\n    const id: string = String(alink.dataset.id);\n    (this as any)[method](id);\n\n    ev && stopEvent(ev);\n  }\n\n\n  /**\n   * \n   * M\u00E9thode s\u00E9lectionnant un \u00E9l\u00E9ment. L'op\u00E9ration est complexe car\n   * elle met non seulement en forme l'\u00E9l\u00E9ment dans le DOM, mais elle\n   * conserve en plus l'\u00E9tat de l'\u00E9l\u00E9ment dans l'accessTable et g\u00E8re\n   * la s\u00E9lection (s\u00E9lection qui le moment est simple).\n   */\n  select(itemId: string) {\n    this.accessTable.selectionManager.selectItem(itemId);\n  }\n\n  // Scroll jusqu'\u00E0 l'\u00E9l\u00E9ment et le s\u00E9lectionne\n  scrollToAndSelect(itemId: string){\n    const klass = this._klass;\n    const item = klass.get(itemId);\n    if ( ! item ) { return ; }\n    klass.isVisible(itemId) || klass.setVisible(itemId) ; \n    const ak = klass.getAccKey(itemId) ;\n    this.select(itemId);\n  }\n  public scrollTo(obj: HTMLElement | string) {\n    if ('string' === typeof obj){ obj = this._klass.getObj(obj); }\n    obj.scrollIntoView({behavior: 'auto', block: 'center'});\n  }\n\n  // Pour cr\u00E9er le nouvel \u00E9l\u00E9ment \n  public insertInDom(item: T, before: T | undefined) {\n    const clone = this.cloneItemTemplate() as DocumentFragment;\n    const mainElement = clone.querySelector('.' + this.minName);\n    if (mainElement) {\n      mainElement.setAttribute('data-id', item.id);\n    }\n    // Et on l'ajoute au conteneur\n    if (before) {\n      let beforeObj = this.accessTable.getObj(before.id);\n      if (this.minName === 'exemple') { beforeObj = (beforeObj.previousSibling as HTMLDivElement); }\n      this.container.insertBefore(clone, beforeObj);\n    } else {\n      this.container.appendChild(clone);\n    }\n    // On actualise ou on renseigne ses valeurs\n    this.updateInDom(item);\n  }\n\n  // Pour actualiser les valeurs dans le DOM\n  public updateInDom(item: T): boolean {\n    const obj = this.accessTable.getObj(item.id); // || throwError('item-obj-unfound');\n    if (!obj){\n      this.flash(`Impossible de trouver l'objet DOM de ${item.id}\u2026 Je ne peux pas actualiser l'affichage.`, 'error');\n      return false;\n    }\n    // R\u00E9gler les props\n    // (maintenant, elles peuvent se trouver dans dbData, qui \n    // contient les donn\u00E9es persistantes, ou dans cachedData, qui\n    // contient les donn\u00E9es format\u00E9es)\n    Object.keys(item.dbData).forEach((prop: string) => {\n      let value = ((item.dbData as unknown) as Record<string, string>)[prop] as string;\n      // console.log(\"Actualisation de prop '%s' avec valeur '%s'\", prop, value);\n      this.setPropValue(obj, item, prop, value);\n    });\n    Object.keys(item.cachedData).forEach((prop: string) => {\n      let value = ((item.cachedData as unknown) as Record<string, string>)[prop] as string;\n      this.setPropValue(obj, item, prop, value);\n    });\n    return true;\n  }\n\n  // Pour peupler le panneau\n  public populate(accessTable: AccessTable<any>): void {\n    const container = this.container;\n    container.innerHTML = '';\n    accessTable.each((item: AnyItemType) => { this.insertInDom(item as T, undefined); });\n\n    // Pour op\u00E9rer apr\u00E8s le peuplement du panneau. Par exemple, pour \n    // les exemples, on va ajouter les titres des \u0153uvres.\n    this.afterDisplayItems(accessTable);\n\n    // Pour observer le panneau (les boutons, le champ de filtre, etc.)\n    this.observePanel();\n  }\n\n  private setPropValue(obj: HTMLElement, item: Record<string, any>, prop: string, value: string | number) {\n    // value = String(value);\n    value = this.formateProp(item, prop, value);\n    obj\n      .querySelectorAll(`[data-prop=\"${prop}\"]`)\n      .forEach(element => {\n        if (value.startsWith('<')) {\n          element.innerHTML = value;\n        } else {\n          element.textContent = value;\n        }\n      });\n  }\n\n  // ========== PRIVATE METHODS ==============\n\n  // Pour conserver les s\u00E9lections pr\u00E9c\u00E9dentes et y revenir\n  private previousSelections: string[] = [];\n\n  // Pour la propri\u00E9t\u00E9 public keyManager\n  initKeyManager() {\n    this._keyManager = new VimLikeManager(document.body as HTMLBodyElement, this, this._klass);\n  }\n\n  private cloneItemTemplate(): DocumentFragment {\n    return this.itemTemplate.content.cloneNode(true) as DocumentFragment;\n  }\n  // M\u00E9thode \u00E0 surclasser pour traitement particulier de certaines valeurs\n  // \u00E0 afficher. Mais normalement, elles sont surtout trait\u00E9es lors de la\n  // mise en cache\n  /* surclassed */ protected formateProp(item: any, prop: string, value: string | number | boolean) { return String(value); }\n  /* surclassed */protected afterDisplayItems(accessTable: AccessTable<any>):void {}\n  /* surclassed */ protected searchMatchingItems(searched: string): T[] { return []; }\n  protected observePanel(): void {\n    // \u00C9couter le champ de filtre\n    const field = this.searchInput;\n    field.addEventListener('input', this.filterItems.bind(this));\n    field.addEventListener('keyup', this.filterItems.bind(this));\n    // \u00C9couter le bouton de panique\n    const btnPanic = document.querySelector('.btn-sos') as HTMLAnchorElement;\n    btnPanic.addEventListener('click', this.onClickPanicButton.bind(this));\n  };\n\n  /**\n   * M\u00E9thode appel\u00E9e quand on clique sur le bouton 'SOS' du panneau \n   * courant lorsqu'il est bloqu\u00E9. Pour tenter de d\u00E9bloquer la\n   * situation.\n   * \n   * @param ev \u00C9v\u00E8nement souris qui a g\u00E9n\u00E9r\u00E9 l'appel\n   */\n  onClickPanicButton(ev: MouseEvent){\n    console.log(\"[onClickPanicButton] Tentative de sortie de blocage\");\n    // Si un formulaire \u00E9tait ouvert, on le ferme\n    if (this.form.isActive()){ this.form.cancelEdit(); }\n    // On r\u00E9-initialise les shortcuts\n    this.keyManager.setMode('normal');\n    \n  }\n  /**\n   *  M\u00E9thode de filtrage des \u00E9l\u00E9ments affich\u00E9s.\n   */\n  private filterItems(ev: Event ) {\n    // On supprime toujours la s\u00E9lection courante pour\n    // pouvoir chercher \u00E0 partir du premier visible\n    const selectedItemId = this.getSelection();\n    this.accessTable.selectionManager.deselectCurrent();\n    const searched = this.searchInput.value.trim();\n    const matchingItems: T[] = this.searchMatchingItems(searched);\n    const matchingCount = matchingItems.length;\n    console.log('[CLIENT %s] Filtrage %s - %i founds / %i \u00E9l\u00E9ment', this.titName, searched, matchingCount, this.accessTable.size);\n    const matchingIds = new Set(matchingItems.map((item: T) => item.id));\n    // Avant, on bouclait sur les items (dans accessTable). Mais maintenant,\n    // l'\u00E9tat des \u00E9l\u00E9ments n'\u00E9tant pas consign\u00E9 dans leur item, on boucle\n    // sur leur 'accKey'\n    this.accessTable.eachAccKey((ak: AccedableItem) => {\n      const visible = matchingIds.has(ak.id);\n      const display = visible ? 'block' : 'none';\n      if ( ak.display !== display ) {\n        // Pour le moment, on prend le parti de ne d\u00E9finir l'obj qu'au besoin,\n        // plut\u00F4t que de faire une boucle pour tous les traiter.\n        if (ak.obj === undefined) { ak.obj = this.accessTable.DOMElementOf(ak.id); }\n        ak.obj.style.display = display;\n        ak.display = display ;\n        ak.visible = visible; \n      }\n    });\n    // Si l'item qui \u00E9tait s\u00E9lectionn\u00E9 est toujours visible, on le\n    // res\u00E9lectionne. \n    if (selectedItemId) {\n      const selectedAK: AccedableItem = this.accessTable.getAccKey(selectedItemId);\n      if ( selectedAK.visible === true ) {\n        this.accessTable.selectionManager.reselectItem(selectedItemId);\n      }\n    }\n  }\n\n  /**\n   *  M\u00E9thode fonctionnelle pour retourner une liste d'items filtr\u00E9s\n   * \n   * Note : Cette fonction n'a rien \u00E0 voir avec la m\u00E9thode qui filtre\n   * les items \u00E0 l'affichage (cf. ci-dessus).\n   */\n  filter(accessTable: AccessTable<any>, fnFiltre: (item: AnyItemType) => boolean): AnyItemType[] {\n    return accessTable.findAll(\n      (item: AnyItemType) => { return fnFiltre(item); },\n      {}\n    );\n  }\n\n  // ========== PRIVATE PROPERTIES ===========\n  protected get container(){ return this._container || (this._container = document.querySelector('main#items') as HTMLDivElement);}\n  private get itemTemplate(){ return this._itemTemplate || (this._itemTemplate = document.querySelector('template#item-template') as HTMLTemplateElement);}\n  private get searchInput(){ return this._searchInput || (this._searchInput = document.querySelector('input#search-input') as HTMLInputElement);}\n  public get consoleInput(){return this._consInput || (this._consInput = document.querySelector('input#panel-console') as HTMLInputElement);}\n  private get messageBox(){ return document.querySelector('div#flash-message') as HTMLDivElement;}\n  private get footer(){return document.querySelector('footer') as HTMLElement; }\n  private get help(){return this._help || (this._help = new Help(this));}\n\n  public minName:string;\n  public titName: string;\n  private _klass: typeof Entry | typeof Oeuvre | typeof Exemple;\n  public get accessTable(): AccessTable<any> { return {} as AccessTable<any>; };\n  private _actif: boolean = false;\n  private _container!: HTMLDivElement;\n  private _itemTemplate!: HTMLTemplateElement;\n  private _searchInput!: HTMLInputElement;\n  private _consInput!: HTMLInputElement;\n  protected _keyManager!: VimLikeManager;\n  protected _clipboardManager!: ClipboardManager<T>;\n  public get clipboard(){ return this._clipboardManager;}\n  private consoleManager!: any; // type ConsoleManager\n  private _help!: Help;\n  \n  constructor(data: PanelConstructorData) {\n    this.minName = data.minName;\n    this.titName = data.titName;\n    this._klass = data.klass;\n    this.form = data.form;\n    this._clipboardManager = new ClipboardManager<T>(this);\n  }\n\n  private setPanelFocus(actif: boolean) {\n    // console.log(\"[setPanelFocus] Focus mis sur le panneau %s\", this.titName);\n    document.body.classList[actif ?'add':'remove']('actif');\n    this._actif = actif ;\n    this.keyManager.setMode('normal');\n  }\n}", "/**\n * ComplexRpc\n * \n * Cette classe est amen\u00E9e \u00E0 g\u00E9rer des traitements complexes car :\n *  - asynchrone\n *  - en Rpc\n * \n * Il a \u00E9t\u00E9 inaugur\u00E9 pour faire \u00E7a : \n * Au cours du test de l'enregistrement d'une Entr\u00E9e, on doit v\u00E9rifier si toutes les\n * oeuvres cit\u00E9es existent et produire une erreur le cas \u00E9ch\u00E9ant. La m\u00E9thode de\n * check doit en m\u00EAme temps attendre et envoyer une chaine de notifications \n * panneau -> extension -> panneau complexe.\n * \n * Pour g\u00E9rer \u00E7a, on fait une Promise en gardant dans l'instance ComplexRpc (rep\u00E9r\u00E9e\n * par un identifiant)) le 'resolve' pour ne le jouer que lorsque tout est fini.\n * \n * Fonctionnement :\n * \n *    Dans le flux\n *    ------------\n *    const params = {...};\n *    const comp = new ComplexRpc({call: this.maFonctionInitiale.bind(this, params)});\n *    const res = await comp.run();\n * \n *    Quelque part\n *    ------------\n *    maFonctionInitiale(liste: string[], compRpcId: string): void {\n *      // Ici on fait l'appel qu'on doit faire, en transmettant l'identifiant\n *      // Par exemple :\n *      RpcEntry.notify('check-oeuvres', {CRId: compRpcId, oeuvres: liste})\n *    }\n * \n *    // Et dans la fonction finale qui re\u00E7oit le r\u00E9sultat du check\n *    RpcEntry.on('check-oeuvres-resultat', (params) => {\n *      ComplexRpc.resolveRequest(params.CRId, params.resultat);\n *      // Bien s\u00FBr, il faut s'assurer que CRId a bien \u00E9t\u00E9 transmis\n *      // partout, \u00E0 toutes les fonctions\n *    });\n * \n */\n\nexport class ComplexRpc {\n  static requestTable: Map<string, ComplexRpc> = new Map();\n  \n  static addRequest(req: ComplexRpc) {\n    this.requestTable.set(req.id, req);\n  }\n  \n  // \u00C0 appeler \u00E0 la fin, pour r\u00E9soudre\n  static resolveRequest(requestId: string, params: any) {\n    (this.requestTable.get(requestId) as ComplexRpc).resolve(params);\n  }\n\n  public id: string;\n  private call: Function; // Fonction qui va lancer l'appel (re\u00E7oit en DERNIER argument l'identifiant de cette instance \u2014 pour le transmettre)\n  private ok!: Function; // le 'resolve' de new Promise((resolve, reject) => {})\n  private ko!: Function; // le reject de new Promise((resolve,reject) => {})\n\n  constructor(param: {\n    call: Function,\n  }) {\n    this.id = crypto.randomUUID();\n    this.call = param.call;\n    ComplexRpc.addRequest(this);\n  }\n\n  run() { \n    return new Promise( (ok, ko) => {\n      this.ok = ok;\n      this.ko = ko;\n      setTimeout(this.ko.bind(this, 'timeout-20'), 10 * 10000);\n      this.call(this.id);\n    });\n  }\n\n  resolve(params: any){\n    this.ok(params);\n  }\n}", "import { PanelClient } from \"../PanelClient\";\nimport { EntryType, OeuvreType, ExempleType, AnyDbType, AnyItemType, DBEntryType, DBOeuvreType, DBExempleType } from \"../../bothside/types\";\n\n// Type pour la d\u00E9finition d'une propri\u00E9t\u00E9\nexport interface FormProperty {\n  propName: string;\n  type: typeof String | typeof Number | typeof Boolean;\n  required: boolean;\n  no_shortcut?: boolean;\n  fieldType: 'text' | 'select' | 'textarea' | 'checkbox' | 'radio';\n  field?: any; // renseign\u00E9 \u00E0 la v\u00E9rificatiaon\n  values?: string[][];\n  default?: any;\n  locked?: boolean; // si true, le champ est verrouill\u00E9\n  onChange?(): void; // la fonction optionnelle \u00E0 appeler en cas de changement de cette propri\u00E9t\u00E9\n}\n\ntype FieldType = HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n\nexport interface ChangeSetType {\n  [x: string]: any;\n  isNew: boolean;\n  size: number;\n}\n\ninterface EditedEntryType /* pour \"Type de l'item \u00E9dit\u00E9 */ extends DBEntryType {\n  // Pour mettre les changements effectu\u00E9s\n  changeset: ChangeSetType;\n  // Pour mettre les donn\u00E9es initiales de l'item\n  original: DBEntryType;\n  data2save?: DBEntryType;\n}\ninterface EditedOeuvreType extends DBOeuvreType {\n  changeset : ChangeSetType;\n  original: DBOeuvreType;\n  data2save?: DBOeuvreType;\n}\ninterface EditedExempleType extends DBExempleType {\n  changeset: ChangeSetType;\n  original: DBExempleType;\n  data2save?: DBExempleType;\n}\ntype EditedIType = EditedEntryType | EditedOeuvreType | EditedExempleType; \n\n/**\n * Classe pour \u00E9tendre le formulaire de chaque \u00E9l\u00E9ment\n */\n\nexport abstract class FormManager<T extends AnyItemType, Tdb extends AnyDbType> {\n\n  abstract formId: string; // Identifiant unique du formulaire\n  abstract prefix: string; // utilis\u00E9 pour nommer les champs\n  abstract properties: FormProperty[];\n  abstract tableKeys: Record<string, {lab: string, fn: Function}>; // table des raccourcis propres\n  private tablePropertiesByPropName!: Map<string, FormProperty>;\n  abstract afterEdit(): void; // \u00E0 faire apr\u00E8s l'\u00E9dition d'un \u00E9l\u00E9ment\n  abstract onSaveEditedItem(data: Tdb): Promise<boolean>; // Fonction pour sauver (appel\u00E9e quand on sauve la donn\u00E9e)\n  async checkEditedItem(): Promise<string | undefined> { return undefined ; }; // Pour checker les donn\u00E9es \n  onCancel?(): void; // Fonction appel\u00E9e en cas d'annulation\n  abstract observeForm(): void; // fonction d'observation propre du formulaire\n  onFocusForm?(ev: FocusEvent | undefined): any;\n  public panel!: PanelClient<AnyItemType>; // le panneau contenant le formulaire\n  public saving: boolean = false;\n  // Les propri\u00E9t\u00E9s \u00E0 retirer des donn\u00E9es \u00E0 finalement sauver.\n  // Note: les propri\u00E9t\u00E9s isNew et size sont d\u00E9j\u00E0 trait\u00E9es\n  /* surclasser (if any) */ propsToRemove(): string[] {return [];}\n\n  // Pour savoir si une \u00E9dition est en cours\n  // if this.form.isActive()\n  public isActive(){\n    return !this.obj.classList.contains('hidden');\n  }\n \n  // Maintenant c'est celui-ci\n  protected editedItem!: EditedIType | undefined;\n  public getEditedItem(){ return this.editedItem;}\n\n  private checked: boolean = false;\n\n  private _obj!: HTMLFormElement; // le formulaire complet\n  get obj(){\n    return this._obj || (this._obj = document.querySelector(`form#${this.formId}`) as HTMLFormElement);\n  }\n\n  // raccourci\n  private setMode(mode: 'form' | 'edit' | 'normal') {\n    this.panel.keyManager.setMode(mode);\n  }\n  /**\n   * @api\n   * Point d'entr\u00E9e de l'\u00E9dition, on envoi l'item \u00E0 \u00E9diter. La manager\n   * affiche ses donn\u00E9es et affiche le formulaire.\n   * \n   * @param item Objet Entry, Oeuvre ou Exemple \u00E0 \u00E9diter/cr\u00E9er\n   */\n  public editItem(item: T): void {\n    // console.log(\"\u00C9dition de l'item\", item);\n    const isNewItem = item.id === '';\n    this.panel.context = isNewItem ? 'create-element' : 'edit-element';\n    const originalData: Tdb = isNewItem ? {} as Tdb : structuredClone(item.dbData) as Tdb;\n    this.editedItem /* EditedIType */ = Object.assign(originalData, {\n      original: structuredClone(originalData),\n      changeset: {size: 0, isNew: isNewItem}\n    }) as any as EditedIType;\n    this.openForm();\n    this.dispatchValues(item);\n    if ( 'function' === typeof this.afterEdit ) { this.afterEdit.call(this); }\n    this.setMode('form');\n  }\n\n  public async saveItem(andQuit: boolean): Promise<void> {\n    const res = await this.itemIsNotSavable();\n    if (res) { return ;}\n    if ( this.editedItem){\n      let data2save = structuredClone(this.editedItem.changeset) as any as Tdb;\n      this.editedItem.data2save = data2save;\n    }\n    const map = new Map();\n    map.set('o', this.onConfirmSave.bind(this, andQuit));\n    map.set('n', this.cancelEdit.bind(this));\n    this.panel.flashAction(\n      \"<b>\uD83D\uDC4D Donn\u00E9e valid\u00E9e \uD83C\uDF89</b><br />Confirmes-tu la sauvegarde ? (o = oui, n = non)\", map\n    );\n  }\n\n  private async itemIsNotSavable(): Promise<boolean> {\n    this.panel.cleanFlash();\n    this.collectValues(); // maintenant les met dans this.editedItem\n    const item = this.editedItem as Record<string, any>;\n    this.properties.forEach(dproperty => {\n      const prop = dproperty.propName;\n      // console.log(\"Propri\u00E9t\u00E9 '%s' | Original: '%s' | New: '%s'\", prop, item.original[prop], item[prop]);\n      if ( item[prop] !== item.original[prop] && this.editedItem) {\n        Object.assign(this.editedItem.changeset, {\n          [prop]: item[prop],\n          size: ++item.changeset.size\n        });\n      }\n    });\n    // console.log(\"Item \u00E0 enregistrer\", this.editedItem);\n    if ( this.itemIsEmpty()) {\n      this.panel.flash(\"Aucune donn\u00E9e n'a \u00E9t\u00E9 founie\u2026\", 'error');\n      return true;\n    } \n    if (this.editedItem && this.editedItem.changeset.size === 0 ) {\n      this.panel.flash(\"Les donn\u00E9es n'ont pas chang\u00E9\u2026\", 'warn');\n      return true;\n    }\n    let invalidity: string | undefined = await this.checkEditedItem();\n    console.log(\"=== FIN DU CHECK DE L'ITEM ===\");\n    if (invalidity) {\n      this.panel.flash(\"Les donn\u00E9es sont invalides : \" + invalidity, 'error');\n      return true;\n    }\n    return false; // enregistrable\n  }\n\n  /**\n   * M\u00E9thode appel\u00E9e apr\u00E8s confirmation de la sauvegarde.\n   * \n   * Elle finalise la donn\u00E9e finale \u00E0 enregistrer, notamment en \n   * retirant les propri\u00E9t\u00E9s non persistantes.\n   */\n  public async onConfirmSave(andQuit: boolean): Promise<void> {\n    // console.log(\"Sauvegarde confirm\u00E9e\");\n    const fakeItem = this.collectValues();\n    // Donn\u00E9es persistantes\n    if (this.editedItem) {\n      const data2save: Tdb = structuredClone(this.editedItem.original) as Tdb;\n      Object.assign(data2save, this.editedItem.data2save);\n      // Donn\u00E9es particuli\u00E8res \u00E0 retirer\n      const removedProps = ['isNew', 'size'];\n      removedProps.push(...this.propsToRemove());\n      // console.log(\"Propri\u00E9t\u00E9s \u00E0 remover\", removedProps);\n      const data2saveEpured = {};\n      for (var k in data2save) {\n        if (removedProps.includes(k)) { continue; }\n        Object.assign(data2saveEpured, { [k]: data2save[k] });\n      }\n      console.log(\"Donn\u00E9es FINALES \u00E0 sauvegarder\", structuredClone(data2saveEpured));\n      await this.onSaveEditedItem(data2saveEpured as Tdb);\n    }\n    this.saving = false;\n    if (andQuit) { this.closeForm(); }\n  }\n\n  private itemIsEmpty(): boolean {\n    var isEmpty = true;\n    const item = this.editedItem as Record<string, any>;\n    this.properties.forEach(dprop => {\n      if (!isEmpty) { return ;}\n      if ( item[dprop.propName] !== '' ) { isEmpty = false; }\n    });\n    return isEmpty;\n  }\n\n  public cancelEdit(): void {\n    // console.log(\"Cancel \u00E9dition\");\n    this.saving = false;\n    this.__onCancel();\n  }\n\n  // Met les donn\u00E9es dans le formulaire\n  dispatchValues(item: T){\n    this.reset();\n    const itemVals = item as {[x: string]: any};\n    this.properties.forEach( dprop => {\n      const prop = dprop.propName;\n      const value = itemVals.dbData && (itemVals.dbData[prop] || itemVals.cachedData[prop]);\n      if ( value ) { \n        // console.log(\"Propri\u00E9t\u00E9 %s mise \u00E0 %s\", prop, data[prop]);\n        this.setValueOf(prop, String(value));\n        // Si le champ doit \u00EAtre verrouill\u00E9\n        if (dprop.locked) { dprop.field.disabled = true; }\n      } else {\n        console.log(\"La valeur de la propri\u00E9t\u00E9 %s n'est pas d\u00E9finie dans \", prop, item);\n      }\n    });\n  }\n\n  // Retourne le champ de la propri\u00E9t\u00E9 +prop+\n  // (note : ces champs ont \u00E9t\u00E9 v\u00E9rifi\u00E9s au d\u00E9but)\n  field(prop: string): FieldType {\n    if ( false === this.domCache.has(prop)) {\n      const sel = `#${this.prefix}-${prop}`;\n      const fld = this.obj.querySelector(sel) as FieldType;\n      fld || console.error(\"Bizarrement, le champ %s est introuvable (%s)\", sel, prop);\n      this.domCache.set(prop, fld);\n    }\n    return this.domCache.get(prop) as FieldType;\n  }\n  domCache: Map<string, HTMLElement> = new Map();\n\n  // R\u00E9cup\u00E8re les donn\u00E9es dans le formulaire et retourne l'item\n  // avec ses nouvelles donn\u00E9es.\n  collectValues() {\n    if (this.editedItem) {\n      this.properties.forEach(dprop => {\n        const prop = dprop.propName;\n        const value = this.getValueOf(dprop);\n        this.editedItem && Object.assign(this.editedItem, { [prop]: value });\n      });\n    }\n  }\n\n  /**\n   * Pendant de la pr\u00E9c\u00E9dente, donne la valeur +value+ \u00E0 la propri\u00E9t\u00E9\n   * +property+\n   */\n  setValueOf(property: string, value: any) {\n    const propData = this.tablePropertiesByPropName.get(property) as FormProperty;\n    switch (propData.fieldType) {\n      case 'checkbox':\n      case 'radio':\n        propData.field.checked = value;\n        break;\n      default:\n        propData.field.value = value;\n    }\n  }\n  /**\n   * Retourne la valeur de la propri\u00E9t\u00E9 +foo+\n   * \n   * @param foo Nom de la propri\u00E9t\u00E9 dont il faut retourne la valeur\n   * @returns Retourne la valeur de la propri\u00E9t\u00E9 en fonction de son type\n   */\n  getValueOf(foo: string | FormProperty): string | number | boolean | null {\n    if ( 'string' === typeof foo ) {\n      return this.getValueOfByPropName(foo);\n    } else {\n      return this.getValueOfByPropData(foo);\n    }\n  }\n\n  getValueOfByPropName(propName: string) {\n    const propData = this.tablePropertiesByPropName.get(propName) as FormProperty;\n    return this.getValueOfByPropData(propData);\n  }\n  getValueOfByPropData(property: FormProperty): string | number | boolean | null {\n    const prop = property.propName;\n    const field = this.field(prop);\n    // R\u00E9cup\u00E9rer la valeur dans le formulaire (en fonction du champ)\n    let value: any = ((ft) => {\n      switch (ft) {\n        case 'checkbox': return (field as HTMLInputElement).checked;\n        case 'radio': return (field as HTMLInputElement).checked;\n        default: return field.value;\n      }\n    })(property.fieldType);\n    // TODO Traiter la valeur en fonction de son type\n    return value ;\n  }\n\n  openForm(){\n    this.checked || this.checkFormManagerValidity();\n    if (this.checked === false) { return; }\n    this.obj.classList.remove('hidden'); \n  }\n  closeForm(){ \n    this.obj.classList.add('hidden'); \n    this.setMode('normal');\n    this.editedItem = undefined;\n  }\n\n \n  // Tout remettre \u00E0 rien (vider les champs)\n  reset(){\n    this.properties.forEach(dprop => {\n      switch(dprop.fieldType) {\n        case 'checkbox':\n          dprop.field.checked = dprop.default || false;\n          break;\n        case 'textarea':\n          dprop.field.value = '';\n          break;\n        case 'select':\n          dprop.field.selectedIndex = 0;\n          break;\n        default: \n          dprop.field.value = dprop.default || '';\n      }\n    });\n  }\n\n  async __onSaveEditedItem(){\n    return this.saveItem(false);\n  }\n  async __onSaveEditedItemAndQuit(): Promise<void>{\n    await this.saveItem(true);\n  }\n  __onCancel(){\n    this.closeForm();\n  }\n  __onFocusOnForm(ev: FocusEvent | undefined) {\n    if ('function' === typeof this.onFocusForm) { this.onFocusForm.call(this, ev); }\n    (this.panel as PanelClient<AnyItemType>).keyManager.setMode('form');\n  }\n\n  public setPanel(panel: PanelClient<AnyItemType>) {\n    this.panel = panel;\n  }\n  // === M\u00C9THODES DE VALIDATION DES DONN\u00C9ES D'IMPL\u00C9MENTATION ===\n  // (les donn\u00E9es suivantes s'assurent que le formulaire est\n  //  conforme aux attentes)\n  // La m\u00E9thode sert aussi \u00E0 observer les \u00E9l\u00E9ments\n  checkFormManagerValidity(){\n    if ( ! this.obj ) {\n      console.error('Le formulaire form#%s est introuvable.', this.formId);\n      return false;\n    }\n   /**\n     * Check de la conformit\u00E9 des boutons et leurs m\u00E9thodes\n     */\n    if (false === this.checkBoutonsValidity()) { return false; }\n    /**\n     * On inscrit les aides raccourcis clavier dans le footer\n     */\n    this.inscritAideInFooter();\n     /**\n     * Observation des boutons principaux\n     */\n    this.observeButtons();\n    /**\n     * Check de la conformit\u00E9 des propri\u00E9t\u00E9s, on en profite aussi\n     * pour d\u00E9finir des valeurs (container, erreur, etc.)\n     */\n    if ( false === this.checkPropertiesValidity() ) { return false ; }\n\n    // console.info(\"Formulaire %s valide.\", this.formId);\n\n    /**\n     * Observation propre de chaque formulaire (la fonction est \n     * imp\u00E9rativement impl\u00E9ment\u00E9)\n     */\n    this.__observeForm();\n    this.observeForm();\n\n    this.checked = true;\n  }\n  inscritAideInFooter(){\n    let aide = '<shortcut>q</shortcut><span>Renoncer</span><shortcut>s</shortcut><span>Enregistrer</span><shortcut>w</shortcut><span>Enregistrer et finir</span>';\n    (this.obj.querySelector('div#footer') as HTMLElement).innerHTML = aide;\n  }\n  checkBoutonsValidity(): boolean {\n    let ok = true;\n    // Note : les boutons g\u00E9n\u00E9raux (Save, Renoncer, etc. on \u00E9t\u00E9 supprim\u00E9s au profit des raccourcis clavier)\n    return ok;\n  }\n  // Observation du formulaire\n  __observeForm() { \n    // On s\u00E9lectionne toujours le contenu d'un champ (sauf textarea)\n    this.obj.querySelectorAll('text[type=\"text\"]').forEach(o => {\n      o.addEventListener('focus', (ev) => { (o as HTMLInputElement).select(); });\n    });\n\n    // On r\u00E8gle le changement de mode suivant qu'on focusse dans un\n    // champ \u00E9ditable ou qu'on en blure\n    (this.panel as PanelClient<AnyItemType>).keyManager.discrimineFieldsForModeIn(this.obj, {edit: 'edit', normal: 'form'});\n  }\n  \n  focusField(indice: number) {\n    const dproperty = this.properties[indice - 1];\n    let curIndice = 0;\n    let foundProp: FormProperty | undefined = undefined;\n    this.properties.forEach((dprop) => {\n      if (foundProp) {return; /* acc\u00E9l\u00E9rateur\u2026 */}\n      if (dprop.no_shortcut) { return; }\n      curIndice ++;\n      if ( curIndice === indice) { foundProp = dprop; }\n    });\n    if (foundProp) { (foundProp as FormProperty).field.focus(); }\n  }\n\n  // S'il y a un champ d'identifiant, cette fonction permet de le d\u00E9loquer\n  toggleIdLock() {\n    const idField = this.field('id');\n    if (!idField) { return; }\n    let isLocked = idField.dataset.state === 'locked';\n    this.setIdLock(!isLocked);\n  }\n  setIdLock(isLocked: boolean) {\n    const idField = this.field('id');\n    idField.dataset.state = isLocked ? 'locked' : 'unlocked';\n    idField.disabled = isLocked;\n    const btn = this.obj.querySelector('.btn-lock-id');\n    if (btn) { idField.innerHTML = isLocked ? '\uD83D\uDD12' : '\uD83D\uDD13'; }\n  }\n  // Observation des boutons principaux\n  observeButtons(){\n  }\n\n  checkPropertiesValidity(): boolean {\n    let ok = true ;\n    const lettres = 'abcdefghijkl'.split('').reverse();\n    // On va en profiter pour mettre les donn\u00E9es des propri\u00E9t\u00E9s dans\n    // une table pour les r\u00E9cup\u00E9rer facilement\n    this.tablePropertiesByPropName = new Map();\n\n    this.properties.forEach( (dproperty) => {\n      const prop = dproperty.propName;\n      this.tablePropertiesByPropName.set(prop, dproperty);\n      const prefix = this.prefix;\n      const prefprop = `${prefix}-${prop}`;\n      // Chaque propri\u00E9t\u00E9 doit avoir son conteneur de nom '<propName>-container'\n      const container = this.obj.querySelector(`#${prefprop}-container`);\n      if (container) {\n        const label = ((container as HTMLElement).querySelector('label') as HTMLElement);\n        let shortcut: string;\n        if (dproperty.no_shortcut) {\n          shortcut = '';\n        } else {\n          shortcut = '<shortcut>' + lettres.pop() + '</shortcut>\u00A0';\n        }\n        label.innerHTML = shortcut + label.innerHTML;\n        Object.assign(dproperty, { container: container });\n      } else {\n        console.error('La propri\u00E9t\u00E9 \"%s\" devrait \u00EAtre dans un conteneur d\u2019identifiant \"#%s-container\"', prop, prefprop);\n        ok = false;\n      }\n      // Est-ce que chaque propri\u00E9t\u00E9 est bien dans son champ ?\n      let propTag = String(dproperty.fieldType);\n      if ( ['text', 'checkbox', 'radio'].includes(propTag)) { propTag = 'input';}\n      const fieldSelector = `${propTag}#${prefprop}`;\n      let propField = this.obj.querySelector(fieldSelector);\n      if ( propField ) {\n        switch(dproperty.fieldType) {\n          case 'checkbox': propField = propField as HTMLInputElement; break;\n          case 'textarea': propField = propField as HTMLTextAreaElement; break;\n          default: propField = propField as HTMLInputElement;\n        }\n        Object.assign(dproperty, { field: propField });\n\n        /**\n         * S'il faut observer le champ (si par exemple onChange est d\u00E9fini), alors\n         * l'observer\n         */\n        if ( dproperty.onChange ) {\n          propField.addEventListener('change', dproperty.onChange);\n        }\n\n      } else {\n        console.error('Le champ %s pour la propri\u00E9t\u00E9 %s devrait exister.', fieldSelector, prop);\n        ok = false;\n      }\n      // Un champ select doit avoir des valeurs\n      // Et on en profite pour les mettre\n      if ( dproperty.fieldType === 'select' ) {\n        if ( dproperty.values ) {\n          const field = dproperty.field;\n          field.innerHTML = '';\n          dproperty.values.forEach( paire => {\n            let [value, title] = paire;\n            title = title || value;\n            const opt = document.createElement('option');\n            opt.value = value;\n            opt.innerHTML = title;\n            field.appendChild(opt);\n          });\n        } else {\n          console.error('Le champ %s, de type select, devrait d\u00E9finir ses valeurs (values)', prop);\n          ok = false;\n        }\n      }\n      \n\n    });\n    \n    return ok;\n  }\n}", "import { AnyItemType, DBExempleType, ExempleType } from \"../../bothside/types\";\nimport { ComplexRpc } from \"../services/ComplexRpc\";\nimport { FormManager, FormProperty } from \"../services/FormManager\";\nimport { Exemple } from \"./Exemple\";\n\n\nexport class ExempleForm extends FormManager<ExempleType, DBExempleType> {\n  formId = 'exemple-form';\n  prefix = 'exemple';\n  properties: FormProperty[] = [\n    {propName: 'id', type: String, required: true, fieldType: 'text', locked: true, no_shortcut: true},\n    {propName: 'entry_id', type: String, required: true, fieldType: 'text', no_shortcut: true},\n    {propName: 'oeuvre_id', type: String, required: true, fieldType: 'text', no_shortcut: true},\n    {propName: 'content', type: String, required: true, fieldType: 'textarea'},\n    {propName: 'notes', type: String, required: true, fieldType: 'textarea'},\n  ];\n  // Table des raccourcis 'one key' propre au formulaire\n  tableKeys = {\n    // <touche>: {lab: 'label pour info', fn: <fonction bind\u00E9e>}, par exemple\n    // 'i': {lab: 'obtenir des infos', fn: this.showInfo.bind(this)}\n  };\n\n  public propsToRemove(): string[] {\n    return ['id'];\n  }\n\n  /**\n   * Grand m\u00E9thode de check de l'item.\n   * \n   * Pour un exemple, il suffit de v\u00E9rifier que le contenu contienne\n   * ce qu'il faut. Car les autres valeurs sont des identifiants qui\n   * n'ont pas pu \u00EAtre forc\u00E9s.\n   * \n   * @returns undefined si la donn\u00E9e est valide ou le string du message d'erreur dans le cas contraire.\n   */\n  async checkEditedItem(): Promise<string | undefined> {\n    const item = this.editedItem;\n    const changeset = item.changeset;\n    const isNew = item.changeset.isNew;\n    const errors: string[] = [];\n\n    // L'identifiant de l'\u0153uvre doit \u00EAtre d\u00E9fini\n    if ( changeset.oeuvre_id !== undefined ) {\n      if (changeset.oeuvre_id === '') {errors.push(\"L\u2019\u0153uvre de l\u2019exemple doit \u00EAtre d\u00E9finie. (\u21E7?)\");} \n    }\n\n    // L'identifiant de l'entr\u00E9e doit \u00EAtre d\u00E9fini\n    if ( changeset.entry_id !== undefined) {\n      if (changeset.entry_id === '') {errors.push(\"L\u2019entr\u00E9e de l\u2019exemple doit \u00EAtre d\u00E9finie. (\u21E7?)\");}\n    }\n\n    // Le contenu doit avoir \u00E9t\u00E9 d\u00E9fini\n    if (changeset.content !== undefined) {\n      if (changeset.content === '') {errors.push(\"Il faut imp\u00E9rativement d\u00E9crire l'exemple\");}\n      else if (changeset.content.length < 30) {\n        errors.push(\"Cet description d\u2019exemple me parait trop courte\u2026 (ajouter &lt;!-- force content --&gt; pour forcer)\");\n      }\n    }\n\n    // L'exemple doit avoir un indice\n    if ( undefined === (item.original as DBExempleType).indice) {\n      if (isNew) {\n        // C'est normal, on doit d\u00E9finir l'indice en fonction des exemples que contient d\u00E9j\u00E0 l'oeuvre\n        const indice: number = Exemple.getNextIndiceForOeuvre(changeset.oeuvre_id);\n        Object.assign(changeset, {indice: indice});\n      } else {\n        this.panel.flash(\"GRAVE PROBL\u00C8ME : L'indice devrait \u00EAtre d\u00E9j\u00E0 d\u00E9fini, pour un exemple d\u00E9j\u00E0 sauvegard\u00E9\u2026\", 'error');\n      }\n    }\n\n    // r\u00E9sultat final retourn\u00E9\n    if (errors.length) {\n      console.error(\"Donn\u00E9es invalides\", errors);\n      return errors.join(', ').toLowerCase();\n    }\n  }\n\n  /**\n   * M\u00E9thode pour enregistrer les donn\u00E9es si elles ont \u00E9t\u00E9 modifi\u00E9es.\n   * \n   * @param data2save Les donn\u00E9es \u00E0 sauvegarder\n   * @returns True si tout s'est bien pass\u00E9\n   */\n  async onSaveEditedItem(data2save: DBExempleType): Promise<boolean> {\n    // console.log(\"Exemple \u00E0 sauvegarder (item complet)\", this.editedItem);\n    // console.log(\"Donn\u00E9es \u00E0 sauvegarder\", data2save);\n    const itemSaver = new ComplexRpc({\n      call: Exemple.saveItem.bind(Exemple, data2save)\n    });\n    const res = await itemSaver.run() as {ok: boolean, errors: any, item: DBExempleType, itemPrepared: ExempleType};\n    // console.log(\"res dans onSave de l'exemple\", res);\n    if (res.ok) {\n      this.panel.flash('Exemple enregistr\u00E9 avec succ\u00E8s en Db.', 'notice');\n      let item: AnyItemType, nextItem: AnyItemType | undefined;\n      [item, nextItem] = Exemple.accessTable.upsert(res.itemPrepared);\n      if (nextItem /* Quand cr\u00E9ation d'un nouvel exemple */) {\n        this.panel.insertInDom(item, nextItem);\n        // Note : La m\u00E9thode ajoutera aussi le titre si c'est le premier\n        // exemple\n      } else {\n        this.panel.updateInDom(item);\n      }\n    } else {\n      console.error(\"ERREURS \u00C0 L'ENREGISTREMENT DE L'EXEMPLE\", res.errors);\n      this.panel.flash('Erreur (\u00E0 l\u2019enregistre de l\u2019exemple \u2014 voir la console)', 'error');\n      return false;\n    }\n    return true;\n  }\n\n  // Pour observer le formulaire\n  observeForm(): void {\n    // TODO\n  }\n\n  // Ce qu'il faut faire juste apr\u00E8s l'\u00E9dition de l'exemple\n  afterEdit(): void {\n    // TODO\n  }\n\n  setEntry(entryId: string, entryEntree: string){\n    this.setValueOf('entry_id', entryId);\n    (this.obj.querySelector('span#exemple-entry-explicit') as HTMLElement).innerText = entryEntree;\n  }\n  setOeuvre(oeuvreId: string, oeuvreTitre: string){\n    this.setValueOf('oeuvre_id', oeuvreId);\n    (this.obj.querySelector('span#exemple-oeuvre-explicit') as HTMLElement).innerText = oeuvreTitre;\n  }\n}", "import { RpcChannel } from '../../bothside/RpcChannel';\nimport { AnyItemType, DBExempleType, ExempleType  } from '../../bothside/types';\nimport { StringNormalizer } from '../../bothside/StringUtils';\nimport { ClientItem } from '../ClientItem';\nimport { createRpcClient } from '../RpcClient';\nimport { AccessTable } from '../services/AccessTable';\nimport { PanelClient } from '../PanelClient';\nimport { ExempleForm } from './ExempleForm';\nimport { ComplexRpc } from '../services/ComplexRpc';\n\n\nexport class Exemple extends ClientItem<ExempleType> {\n  readonly type = 'exemple';\n  static readonly minName = 'exemple';\n  static readonly klass = Exemple;\n  static currentItem: Exemple;\n  \n  // Constructor and data access\n  // Mais bon\u2026 on s'en sert le moins possible\n  constructor(public data: ExempleType) {\n    super(data);\n  }\n  \n  // Getters pour acc\u00E8s direct aux propri\u00E9t\u00E9s courantes\n  get oeuvre_id(): string { return this.data.dbData.oeuvre_id; }\n  get indice(): number { return this.data.dbData.indice; }\n  get entry_id(): string { return this.data.dbData.entry_id; }\n  get content(): string { return this.data.dbData.content; }\n  get notes(): string | undefined { return this.data.dbData.notes; }\n\n  static setAccessTableWithItems(items: ExempleType[]) {\n    this._accessTable = new AccessTable<ExempleType>(this.panel, items);\n  }\n  public static _accessTable: AccessTable<ExempleType>;\n  \n  static doExemplesExist(exemples: string[][]): {known: string[], unknown: string[]} {\n    const resultat: {known: string[], unknown: string[]} = {known: [], unknown: []};\n    exemples.forEach(paire => {\n      const [oeuvreId, exIndice] = paire;\n      const paireStr = paire.join(':');\n      if ( this.exempleExists(oeuvreId, Number(exIndice))) {\n        resultat.known.push(paireStr);\n      } else {\n        resultat.unknown.push(paireStr);\n      }\n    });\n    return resultat;\n  }\n  static exempleExists(oeuvreId: string, exIndice: number) {\n    return !!this.accessTable.exists(`${oeuvreId}-${exIndice}`);\n  }\n  \n  /**\n   * M\u00E9thode pour enregistrer l'item dans la table\n   * \n   * \n   */\n  public static saveItem(item: DBExempleType, compRpcId: string) {\n    RpcEx.notify('save-item', {CRId: compRpcId, item: item});\n  }\n\n  /**\n   * Fonction qui retourne un indice libre pour un nouvel exemple.\n   * \n   * (note : cet indice est attribu\u00E9 \u00E0 la fin de l'\u00E9dition, au moment \n   * de la validation de l'exemple).\n   * \n   * @param oeuvreId Identifiant de l'oeuvre\n   * @returns L'indice pour le nouvel exemple.\n   */\n  static getNextIndiceForOeuvre(oeuvreId: string): number {\n    let indice = 0;\n    this.accessTable.each((item: ExempleType) => {\n      if (item.dbData.oeuvre_id === oeuvreId) {\n        if ( indice < item.dbData.indice) { indice = Number(item.dbData.indice);}\n      }\n    });\n    return indice + 1;\n  }\n  \n  public static autoCompleteBaliseTerm(triggre: string, ev: Event){\n    return this.panel.flash('Auto compl\u00E9tion seulement pour panneau des entr\u00E9es.', 'notice');\n  }\n\n  public static sendIdCurrentToDefinition(){\n    const exempleId = this.accessTable.getSelection();\n    if ( exempleId) {\n      // console.log(\"[Panneau Exemples] Envoi id '%s' pour entr\u00E9e\", exempleId);\n      RpcEx.notify('send-id-exemple-to-definition', {exempleId: exempleId});\n    } else {\n      this.panel.flash('Il faut choisir l\u2019exemple dont il faut envoyer l\u2019id\u00A0!', 'warn');\n    }\n  }\n\n}\n\n\ninterface OTitre {\n  id: string;\n  obj: HTMLDivElement;        // l'objet complet du titre\n  display: 'block' | 'none';  // pour savoir s'il est affich\u00E9 ou non\n  titre: string;              // le titre affich\u00E9\n}\n\n\n/**\n * \n * \n * ============== PANNEAU EXEMPLES =================\n * \n * \n * \n */\n\n\nclass ExemplePanelClass extends PanelClient<ExempleType> {\n  public get accessTable(){ return Exemple.accessTable ; }\n\n  modeFiltre = 'by-title';\n  BlockTitres: Map<string, OTitre> = new Map();\n\n  initialize(){\n    // On montre le menu qui permet de choisir le mode de filtrage de\n    // la liste.\n    (document.querySelector('#search-by-div') as HTMLDivElement)\n      .classList.remove('hidden');\n  }\n\n  // Certaines propri\u00E9t\u00E9s re\u00E7oivent un traitement particulier :\n  // - l'entr\u00E9e re\u00E7oit un lien pour rejoindre la d\u00E9finition dans le panneau des d\u00E9finitions\n  formateProp(ex: ExempleType, prop: string, value: string | number): string {\n\n    switch(prop) {\n      case 'entree_formated':\n        return `<a data-type=\"entry\" data-id=\"${ex.dbData.entry_id}\">${value}</a>`;\n      default: return String(value);\n    }\n  }\n  \n  /**\n   * Fonction faite pour montrer un exemple\n   * \n   * @param exId Identifiant de l'exemple (OeuvreId:Indice) ou seulement l'identifiant de l'\u0153uvre si indice est fourni\n   * @param indice Indice de l'exemple pour l'\u0152uvre\n   */\n  public showExemple(oeuvreId: string, indice: string | undefined = undefined){\n    if (indice === undefined) { [oeuvreId, indice] = oeuvreId.split(':'); }\n    const selector = `main#items div.exemple[data-id=\"${oeuvreId}-${indice}\"]`;\n    this.scrollTo(this.container.querySelector(selector) as HTMLElement);\n    this.accessTable.selectionManager.selectItem(`${oeuvreId}-${indice}`);\n  }\n\n  observePanel(): void {\n    super.observePanel();\n    this.menuModeFiltre.addEventListener('change', this.onChangeModeFiltre.bind(this));\n    // On place un observateur sur les <a data-type data-id> pour qu'ils appellent\n    // les messages voulus\n    // data-type=\"entry\" pour rejoindre les d\u00E9finitions (afficher la d\u00E9finition voulue)\n    // data-type=\"oeuvre\" pour rejoindre l'\u0153uvre voulue (l'afficher)\n    this.container.querySelectorAll('a[data-type][data-id]').forEach(link => {\n      link.addEventListener('click', this.onClickLinkToEntry.bind(this, link));\n    });\n  }\n  onClickLinkToEntry(link: Element, _ev: any){\n    const entryId = (link as HTMLElement).dataset.id;\n    console.log(\"[CLIENT] Demande d'affichage de l'entr\u00E9e '%s'\", entryId);\n    RpcEx.notify('display-entry', {entry_id: entryId});\n  }\n  onClickLinkToOeuvre(obj: HTMLElement, _ev: MouseEvent) {\n    const oeuvreId = obj.dataset.id ;\n    console.log(\"[CLIENT Exemple] Demande d'affichage de l'\u0153uvre %s\", oeuvreId);\n    RpcEx.notify('display-oeuvre', { oeuvreId });\n  }\n\n\n  onChangeModeFiltre(_ev: any){\n    this.modeFiltre = this.menuModeFiltre.value;\n    console.info(\"Le mode de filtrage a \u00E9t\u00E9 mis \u00E0 '%s'\", this.modeFiltre);\n  }\n  get menuModeFiltre(){return (document.querySelector('#search-by') as HTMLSelectElement);}\n  \n  /**\n   * Appel\u00E9e apr\u00E8s l'affichage des exemples, principalement pour\n   * afficher les titres des oeuvres dans le DOM.\n   */\n  protected afterDisplayItems(accessTable: AccessTable<ExempleType>){\n    // Principe : on boucle sur tous les \u00E9l\u00E9ments (qui sont forc\u00E9ment \n    // class\u00E9s par oeuvre) et d\u00E8s qu'on passe \u00E0 une autre oeuvre on\n    // cr\u00E9e un nouveau titre.\n    let currentOeuvreId: string = ''; // le titre couramment affich\u00E9\n    accessTable.each((item: ExempleType): undefined => {\n      const ditem = item;\n      // console.log(\"dbData.oeuvre_id = '%s' / currentOeuvreId = '%s'\", ditem.dbData.oeuvre_id, currentOeuvreId);\n      if ( ditem.dbData.oeuvre_id === currentOeuvreId ) { return ; }\n      // console.log(\"Nouveau titre pour %s \", ditem.cachedData.oeuvre_titre);\n      // --- NOUVEAU TITRE ---\n      this.insertTitleInDom(ditem);\n      currentOeuvreId = String(ditem.dbData.oeuvre_id);\n   });\n  }\n\n  public insertInDom(item: ExempleType, before: ExempleType | undefined) {\n    super.insertInDom(item, before);\n    if (before && item.dbData.indice === 1) {\n      this.insertTitleInDom(item);\n    }\n  }\n\n  /**\n   * Fonction pour ins\u00E9rer un titre d'\u0153uvre dans le DOM et dans la\n   * donn\u00E9e des titres this.BlockTitres.\n   * \n   * @param item Le premier exemple de l'oeuvre\n   */\n  private insertTitleInDom(item: ExempleType) {\n    const oeuvreId:string = item.dbData.oeuvre_id;\n    const obj = document.createElement('h2');\n    obj.dataset.id = oeuvreId;\n    obj.addEventListener('click', this.onClickLinkToOeuvre.bind(this, obj));\n    obj.className = 'titre-oeuvre';\n    const spanTit = document.createElement('span');\n    spanTit.className = 'titre';\n    spanTit.innerHTML = item.cachedData.oeuvre_titre;\n    obj.appendChild(spanTit);\n    const titre = {\n      id: oeuvreId,\n      obj: obj,\n      titre: item.cachedData.oeuvre_titre,\n      display: 'block'\n    } as OTitre;\n    // On consigne ce titre pour pouvoir le manipuler facilement\n    this.BlockTitres.set(titre.id, titre);\n    const firstEx = document.querySelector(`main#items > div[data-id=\"${item.id}\"]`);\n    this.container.insertBefore(obj, firstEx);\n  }\n  /**\n   * Filtrage des exemples \n   * M\u00E9thode sp\u00E9cifique Exemple\n   * \n   * En mode \"normal\"\n   * Le filtrage, sauf indication contraire, se fait par rapport aux\n   * titres de film. Le m\u00E9canisme est le suivant : l'user tape un\n   * d\u00E9but de titres de film. On en d\u00E9duit les titres gr\u00E2ce \u00E0 la\n   * m\u00E9thode de la classe Oeuvre. On prend l'identifiant et on \n   * affiche tous les exemples du film voulu.\n   * \n   * En mode \"Entr\u00E9e\", l'utilisateur tape une entr\u00E9e du dictionnaire\n   * et la m\u00E9thode renvoie tous les exemples concernant cette entr\u00E9e.\n   * \n   * En mode \"Contenu\", la recherche se fait sur le contenu, partout\n   * et sur toutes les entr\u00E9es.\n   * \n   */\n  searchMatchingItems(searched: string): ExempleType[] {\n    const searchLow = StringNormalizer.toLower(searched);\n    const searchRa = StringNormalizer.rationalize(searched); \n    let exemplesFound: ExempleType[];\n\n    switch (this.modeFiltre) {\n\n      case 'by-title':\n        // Filtrage par titre d'\u0153uvre (d\u00E9faut)\n        exemplesFound = this.filter(Exemple.accessTable, (ex: AnyItemType) => {\n          return (ex as ExempleType).cachedData.titresLookUp.some((titre: string) => {\n            return titre.substring(0, searchLow.length) === searchLow;\n          });\n        }) as ExempleType[];\n        break;\n      case 'by-entry':\n        // Filtrage pour entr\u00E9e\n        exemplesFound = this.filter(Exemple.accessTable, (ex: AnyItemType) => {\n          const seg = (ex as ExempleType).cachedData.entry4filter.substring(0, searchLow.length);\n          return seg === searchLow || seg === searchRa;\n        }) as ExempleType[];\n        break;\n      case 'by-content':\n         exemplesFound = this.filter(Exemple.accessTable, (ex: AnyItemType) => {\n          console.log(\"ex\", ex);\n          ex = ex as ExempleType;\n          return ex.cachedData.content_min.includes(searchLow) ||\n            ex.cachedData.content_min_ra.includes(searchRa);\n        }) as ExempleType[];\n        break;\n      default:\n        return [] ; // ne doit jamais \u00EAtre atteint, juste pour lint\n    }\n    // Traitement des titres\n    // On par du principe que les titres des exemples choisis doivent\n    // \u00EAtre affich\u00E9s (note : je pense que \u00E7a peut \u00EAtre une m\u00E9thode\n    // communes \u00E0 tous les filtrages)\n    \n    // Pour consigner les titres modifi\u00E9s\n    const titres2aff: Map<string, boolean> = new Map();\n\n    exemplesFound.forEach((ex: ExempleType) => {\n      // Si le titre a d\u00E9j\u00E0 \u00E9t\u00E9 trait\u00E9, on passe au suivant\n      if ( titres2aff.has(ex.dbData.oeuvre_id)) { return ; }\n      titres2aff.set(ex.dbData.oeuvre_id, true);\n    });\n    // Ici, on a dans titres2aff les titres \u00E0 afficher\n    this.BlockTitres.forEach((btitre:OTitre) => {\n      const dispWanted = titres2aff.has(btitre.id) ? 'block' : 'none';\n      if ( btitre.display === dispWanted) { return ; }\n      btitre.display = dispWanted ;\n      btitre.obj.style.display = dispWanted;\n    });\n\n    return exemplesFound;\n }\n\n} // class ExemplePanelClass\n\n\n// Instancier le panneau\nconst ExemplePanel = new ExemplePanelClass({\n  minName: 'exemple',\n  titName: 'Exemples',\n  klass: Exemple,\n  form: new ExempleForm() as ExempleForm,\n});\nExemplePanel.form = new ExempleForm() as ExempleForm;\nExemplePanel.form.setPanel(ExemplePanel);\nExemple.panel = ExemplePanel;\n\n\n/**\n * \n * \n * ============== RPC EXEMPLES ================\n * \n * \n * \n */\n\nexport const RpcEx: RpcChannel = createRpcClient();\n\nRpcEx.on('activate', () => {\n  if ( ExemplePanel.isActif ) { return ; }\n  // console.log(\"[CLIENT EXEMPLES] Je dois marquer le panneau Ex actif\");\n  ExemplePanel.activate();\n});\nRpcEx.on('desactivate', () => {\n  if ( ExemplePanel.isInactif ) { return ; }\n  // console.log(\"[CLIENT EXEMPLES] Je dois marquer le panneau Ex comme inactif.\");\n  ExemplePanel.desactivate();\n});\n\nRpcEx.on('populate', (params) => {\n  // console.log(\"[CLIENT-EXemples] Items remont\u00E9s :\", params.data);\n  Exemple.deserializeItems(params.data);\n  ExemplePanel.populate(Exemple.accessTable);\n  ExemplePanel.initialize();\n  ExemplePanel.initKeyManager();\n});\n\nRpcEx.on('show-exemple', (params: {exId: string}) => {\n  console.log(\"[PANNEAU EXEMPLE] Montrer l'exemple d'identifiant : \", params.exId);\n  ExemplePanel.showExemple(params.exId);\n});\n\n\nRpcEx.on('check-exemples', (params) => {\n  // console.log(\"[PANNEAU EXEMPLE] Demande de v\u00E9rification des exemples :\", params.exemples);\n  const resultat = Exemple.doExemplesExist(params.exemples);\n  RpcEx.notify('check-exemples-resultat', {CRId: params.CRId, resultat: resultat});\n});\n\nRpcEx.on('entry-for-exemple', (params: {entryId: string, entryEntree: string}) => {\n  // console.log(\"Je re\u00E7ois dans le panneau exemple l'entr\u00E9e '%s'\", params.entryId);\n  if ( ExemplePanel.form.isActive() ) {\n    (ExemplePanel.form as ExempleForm).setEntry(params.entryId, params.entryEntree);\n  } else {\n    ExemplePanel.flash('Aucun exemple n\u2019est en \u00E9dition\u2026', 'error');\n  }\n});\n\nRpcEx.on('oeuvre-for-exemple', (params: {oeuvreId: string, oeuvreTitre: string}) => {\n  // console.log(\"Je re\u00E7ois dans le panneau exemple l'oeuvre '%s'\", params.oeuvreId);\n  if ( ExemplePanel.form.isActive() ) {\n    (ExemplePanel.form as ExempleForm).setOeuvre(params.oeuvreId, params.oeuvreTitre);\n  } else {\n    ExemplePanel.flash('Aucun exemple n\u2019est en \u00E9dition\u2026', 'error');\n  }\n});\n\nRpcEx.on('after-saved-item', (params) => {\n  // console.log(\"[CLIENT Exemple] R\u00E9ception du after-saved-item\", params);\n  ComplexRpc.resolveRequest(params.CRId, params);\n});\n\n\n(window as any).Exemple = Exemple;"],
  "mappings": "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",
  "names": []
}
